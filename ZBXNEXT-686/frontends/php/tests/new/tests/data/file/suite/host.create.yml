# Create a host, link it to a template and verify the result using host.get.

steps:
  step1:
    request:
      method:  host.create
      params:
        host: "Linux server"
        interfaces:
          -
            type: 1
            main: 1
            useip: 1
            ip: "192.168.3.1"
            dns: ""
            port: "10050"
        groups:
          -
            groupid: "50"
        templates:
          -
            templateid: "20045"

    expect: result

    response:
      result:
        # possible shorter notation
        #_assert: { arrayOf: id, count: 1 }
        _assert: { type: array, count: 1 }
        _each:
          _assert: { type: id }

  step2:
    request:
      method: host.get
      params:
        hostids: [@step1.response.result@]
        selectInterfaces: extend
        selectParentTemplate: [templateid]

    expect: result

    response:
      result:
        -
          hostid: @step1.response.result[0]@
          host: @step1.response.result.host@
          name: @step1.response.result.name@
          proxy_hostid: "0"
          status: "0"
          disable_until: "0"
          error: ""
          available: "0"
          errors_from: "0"
          lastaccess: "0"
          ipmi_authtype: "0"
          ipmi_privilege: "2"
          ipmi_username: ""
          ipmi_password: ""
          ipmi_disable_until: "0"
          ipmi_available: "0"
          snmp_disable_until: "0"
          snmp_available: "0"
          maintenanceid: "0"
          maintenance_status: "0"
          maintenance_type: "0"
          maintenance_from: "0"
          ipmi_errors_from: "0"
          snmp_errors_from: "0"
          ipmi_error: ""
          snmp_error: ""
          jmx_disable_until: "0"
          jmx_available: "0"
          jmx_errors_from: "0"
          jmx_error: ""
          flags: "0"
          templateid: "0"
          description: ""
          groups:
            -
              groupid: @step1.request.params.groups[0].groupid@
          parentTemplates:
            -
              templateid: @step1.request.params.templates[0].templateid@
          interfaces:
            -
              interfaceid: { _assert: { type: id } }
              hostid: @step1.response.result[0]@
              main: @step1.request.params.interfaces[0].main@
              type: @step1.request.params.interfaces[0].type@
              useip: @step1.request.params.interfaces[0].useip@
              ip: @step1.request.params.interfaces[0].ip@
              dns: @step1.request.params.interfaces[0].dns@
              port: @step1.request.params.interfaces[0].useip@
              bulk: @step1.request.params.interfaces[0].port@
