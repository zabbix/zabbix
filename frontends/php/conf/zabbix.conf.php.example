<?php
// Zabbix GUI configuration file
global $DB;

$DB["TYPE"]				= 'MYSQL';
$DB["SERVER"]			= 'localhost';
$DB["PORT"]				= '0';
$DB["DATABASE"]			= 'zabbix';
$DB["USER"]				= 'zabbix';
$DB["PASSWORD"]			= 'zabbix_password';
// SCHEMA is relevant only for IBM_DB2 database
$DB["SCHEMA"]			= '';

$ZBX_SERVER				= 'localhost';
$ZBX_SERVER_PORT		= '10051';
$ZBX_SERVER_NAME		= '';

$IMAGE_FORMAT_DEFAULT	= IMAGE_FORMAT_PNG;

// // LLNW Super-admin role DB bypass
// // LLNW_RW_ROLE: Role number that grants read-write access.
// // LLNW_RO_ROLE: Role number for read-only access. (e.g. local-ug_read-only-users)
// global $LLNW_RW_ROLE, $LLNW_RO_ROLE;
// $LLNW_RO_ROLE='100100000000049';


/**
 * Use the global user details to check if the user is in a RW or RO group.
 * @return boolean
 */
function _llnw_is_user_rw() {
	global $USER_DETAILS;
	// Consider CWebUser::getType() in place of USER_DETAILS...
	global $LLNW_RW_ROLE, $LLNW_RO_ROLE; // Global configuration role information
	// Inititalize the config...
	if (empty($LLNW_RO_ROLE)) {
		$LLNW_RO_ROLE = -1; // Assume no default role assignment.
	}
	if (empty($LLNW_RW_ROLE)) {
		$LLNW_RW_ROLE = -1;
	}

	// Find/populate our user's ID
	$userid='';
	if (!empty($USER_DETAILS['userid'])) {
		$userid = $USER_DETAILS['userid'];
	}
	else if (!empty(CZBXAPI::$userData['userid'])) {
		$userid = CZBXAPI::$userData['userid'];
	}

	if (empty($userid)) {
		return true; // consider the lack of a userid as anonymous
	}
	else {
		static $groups; // cache the groups per request - we only need to call the API once.
		if (empty($groups)) {
			$groups = array();
			$apigroups = API::UserGroup()->get(array('userids' => $userid, 'output' => API_OUTPUT_EXTEND));
			foreach ($apigroups as $group) {
				$groups[] = $group['usrgrpid'];
			}
		}

		// Return status based on RO,RW Role config.
		if (in_array($LLNW_RO_ROLE, $groups)) {
			return false;
		}
		if (in_array($LLNW_RW_ROLE, $groups)) {
			return true;
		}
	}
	return false; // catchall
}
?>
