Zabbix proxy (probe) installation on CentOS 6

1. Add MariaDB 5.5 repository to target server. Add the next entry to /etc/yum.repos.d/MariaDB.repo file:
    # MariaDB 5.5 CentOS repository list - created 2013-10-02 18:40 UTC
    # http://mariadb.org/mariadb/repositories/
    [mariadb]
    name = MariaDB
    baseurl = http://yum.mariadb.org/5.5/centos6-amd64
    gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB
    gpgcheck=1

Actual information about repository can be founded on https://downloads.mariadb.org/mariadb/repositories/

2. Install MariaDB server and client:
    yum install MariaDB-server MariaDB-client MariaDB-devel MariaDB-common

3. Edit default MySQL configuration with recommended initial parameters server.cnf from ./config/ folder:
    cp /opt/zabbix/docs/config/mysql_server.cnf /etc/my.cnf.d/server.cnf

6. Install prerequisites for Zabbix proxy. Repository EPEL should be added early!
    yum install ldns ldns-devel openssl openssl-devel libcurl-devel

3. Add 'zabbix' user to the system:
    useradd zabbix

7. Checkout SVN repository (there is always actual source code) and go to the zbx-2.0 folder:
    svn co svn://svn.zabbix.com/branches/2.0.rsm/ ./zbx-2.0 && cd zbx-2.0

5. Edit default MySQL configuration with recommended initial parameters server.cnf from ./config/ folder:
    cp /opt/zabbix/docs/config/mysql_proxy.cnf /etc/my.cnf.d/server.cnf

8. Compile Zabbix proxy and agent for required platform with the next commands.
You can prepare/compile binaries on test platform or development server and then just place binaries and config files to destination server:
    make distclean
    ./bootstrap.sh
    LDFLAGS="$LDFLAGS -lssl" ./configure --enable-agent --enable-proxy --with-mysql --with-libcurl --enable-ipv6 \
            --sysconfdir=/opt/zabbix/etc/ \
            --prefix=/opt/zabbix/ \
            --datadir=/opt/zabbix/sbin/ \
            --sbindir=/opt/zabbix/sbin/ \
            --mandir=/opt/zabbix/usr/share/man/ \
            --datarootdir=/opt/zabbix/usr/share/
    make dbschema
    make install

8. Change Zabbix proxy config file with recommended initial parameters zabbix_proxy.conf from ./config/ folder:
    cp /opt/zabbix/docs/config/zabbix_proxy.conf /opt/zabbix/etc/zabbix_proxy.conf

9. Change Zabbix agent config file with recommended initial parameters zabbix_agentd.conf from ./config/ folder:
    cp /opt/zabbix/docs/config/zabbix_agentd.conf /opt/zabbix/etc/zabbix_agentd.conf

To set the hostname automatically, run:
    sed -i -e "s|Hostname=.*|Hostname=`hostname -s`|g" /opt/zabbix/etc/zabbix_agentd.conf

10. Create folders for PID files and log files. Change permissions for these folders to 'zabbix' user:
    mkdir -p /var/run/zabbix/ && mkdir -p /var/log/zabbix/
    chown -R zabbix:zabbix /var/run/zabbix && chown -R zabbix:zabbix /var/log/zabbix

11. Create /var/log/mysql folder and assign permission to 'mysql' user and group:
    mkdir -p /var/log/mysql && chown -R mysql:mysql /var/log/mysql

13. Start MySQL process. The first startup can be slow. Be patient.
    /etc/init.d/mysql start

14. Create Zabbix database:
    DROP DATABASE IF EXISTS zabbix;
    CREATE DATABASE zabbix CHARACTER SET utf8 COLLATE utf8_bin;

15. Create Zabbix database and fill the database with initial data (database schema can be found in repository from 7 step):
    cd <svn_root_folder>/database/mysql/
    cat schema.sql | mysql zabbix

You need specify -p argument to mysql command if you have configured permissions to MySQL.

24. Copy zabbix-proxy to /etc/init.d/zabbix-proxy from ./config/:
    cp /opt/zabbix/docs/config/zabbix-proxy /etc/init.d/zabbix-proxy && chmod +x /etc/init.d/zabbix-proxy

25. Copy zabbix-agent to /etc/init.d/zabbix-agent from ./config/:
    cp /opt/zabbix/docs/config/zabbix-agent /etc/init.d/zabbix-agent && chmod +x /etc/init.d/zabbix-agent

16. Add Zabbix proxy and Zabbix agent to autostart:
    chkconfig --add zabbix-proxy
    chkconfig zabbix-proxy on
    chkconfig zabbix-agent on

17. Start Zabbix server and Zabbix agent:
    service zabbix-agent start
    service zabbix-proxy start

18. Check log files to confirm successful startup:
    /var/log/zabbix/zabbix_proxy.log
    /var/log/zabbix/zabbix_agentd.log

19. Do not forget to add Zabbix proxy port (10051 TCP) to allow incoming packets from Zabbix server.

20. Do not forget to add Zabbix agent port (10050 TCP) to allow communication from Zabbix server to Zabbix agent.
