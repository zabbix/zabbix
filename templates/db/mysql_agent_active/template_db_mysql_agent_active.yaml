zabbix_export:
  version: '8.0'
  template_groups:
    - uuid: 748ad4d098d447d492bb935c907f652f
      name: Templates/Databases
  templates:
    - uuid: 1ae69b01417849b180717f62ad7819d6
      template: 'MySQL by Zabbix agent active'
      name: 'MySQL by Zabbix agent active'
      description: |
        Requirements for template operation:
        
        1. Install Zabbix agent and MySQL client. If necessary, add the path to the 'mysql' and 'mysqladmin' utilities to the global environment variable PATH.
        
        2. Copy the 'template_db_mysql.conf' file with user parameters into folder with Zabbix agent configuration (/etc/zabbix/zabbix_agentd.d/ by default). Don't forget to restart Zabbix agent.
        
        3. Create the MySQL user that will be used for monitoring ('<password>' at your discretion). For example:
        
        CREATE USER 'zbx_monitor'@'%' IDENTIFIED BY '<password>';
        GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO 'zbx_monitor'@'%';
        
        For more information, please see MySQL documentation (https://dev.mysql.com/doc/refman/8.0/en/grant.html).
        
        NOTE: In order to collect replication metrics, MariaDB Enterprise Server 10.5.8-5 and above and MariaDB Community Server 10.5.9 and above require the SLAVE MONITOR privilege to be set for the monitoring user:
        
        GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW,SLAVE MONITOR ON *.* TO 'zbx_monitor'@'%';
        
        For more information, please read the MariaDB documentation (https://mariadb.com/docs/server/ref/mdb/privileges/SLAVE_MONITOR/).
        
        4. Create '.my.cnf' configuration file in the home directory of Zabbix agent for Linux distributions (/var/lib/zabbix by default) or 'my.cnf' in c:\ for Windows. For example:
        
        [client]
        protocol=tcp
        user='zbx_monitor'
        password='<password>'
        
        For more information, please see MySQL documentation (https://dev.mysql.com/doc/refman/8.0/en/option-files.html).
        
        NOTE: Linux distributions that use SELinux may require additional steps for access configuration.
        
        You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/384189-discussion-thread-for-official-zabbix-template-db-mysql
        
        Generated by official Zabbix template tool "Templator"
      wizard_ready: 'YES'
      readme: |
        ## Setup
        
        1. Install MySQL client. If necessary, add the path to the `mysql` and `mysqladmin` utilities to the global environment variable PATH.
        2. Copy the `template_db_mysql.conf` file with user parameters into folder with Zabbix agent configuration (/etc/zabbix/zabbix_agentd.d/ by default). Don't forget to restart Zabbix agent.
        3. Create the MySQL user that will be used for monitoring (`<password>` at your discretion). For example:
        
        ```text
        CREATE USER 'zbx_monitor'@'%' IDENTIFIED BY '<password>';
        GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW ON *.* TO 'zbx_monitor'@'%';
        ```
        
        For more information, please see [`MySQL documentation`](https://dev.mysql.com/doc/refman/8.0/en/grant.html).
        
        4. Create `.my.cnf` configuration file in the home directory of Zabbix agent for Linux distributions (/var/lib/zabbix by default) or `my.cnf` in c:\ for Windows. For example:
        
        ```text
        [client]
        protocol=tcp
        user='zbx_monitor'
        password='<password>'
        ```
        
        For more information, please see [`MySQL documentation`](https://dev.mysql.com/doc/refman/8.0/en/option-files.html).
        
        **NOTE:** In order to collect replication metrics, MariaDB Enterprise Server 10.5.8-5 and above and MariaDB Community Server 10.5.9 and above require the `SLAVE MONITOR` privilege to be set for the monitoring user:
        
        ```text
        GRANT REPLICATION CLIENT,PROCESS,SHOW DATABASES,SHOW VIEW,SLAVE MONITOR ON *.* TO 'zbx_monitor'@'%';
        ```
        
        For more information, please read the [`MariaDB documentation`](https://mariadb.com/docs/server/ref/mdb/privileges/SLAVE_MONITOR/).
        
        NOTE: Linux distributions that use SELinux may require additional steps for access configuration.
        
        For example, the following rule could be added to the SELinux policy:
        
        ```text
        # cat <<EOF > zabbix_home.te
        module zabbix_home 1.0;
        
        require {
                type zabbix_agent_t;
                type zabbix_var_lib_t;
                type mysqld_etc_t;
                type mysqld_port_t;
                type mysqld_var_run_t;
                class file { open read };
                class tcp_socket name_connect;
                class sock_file write;
        }
        
        #============= zabbix_agent_t ==============
        
        allow zabbix_agent_t zabbix_var_lib_t:file read;
        allow zabbix_agent_t zabbix_var_lib_t:file open;
        allow zabbix_agent_t mysqld_etc_t:file read;
        allow zabbix_agent_t mysqld_port_t:tcp_socket name_connect;
        allow zabbix_agent_t mysqld_var_run_t:sock_file write;
        EOF
        # checkmodule -M -m -o zabbix_home.mod zabbix_home.te
        # semodule_package -o zabbix_home.pp -m zabbix_home.mod
        # semodule -i zabbix_home.pp
        # restorecon -R /var/lib/zabbix
        ```
      vendor:
        name: Zabbix
        version: 8.0-3
      groups:
        - name: Templates/Databases
      items:
        - uuid: 92637d299d254e83b41df8f9893ecc37
          name: 'Aborted clients per second'
          type: DEPENDENT
          key: mysql.aborted_clients.rate
          value_type: FLOAT
          description: 'Number of connections that were aborted because the client died without closing the connection properly.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Aborted_clients'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
        - uuid: 7ae8f8a1572346d38abe38491f8f5800
          name: 'Aborted connections per second'
          type: DEPENDENT
          key: mysql.aborted_connects.rate
          value_type: FLOAT
          description: 'Number of failed attempts to connect to the MySQL server.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Aborted_connects'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
          triggers:
            - uuid: f49998d4098348378c661927155cd6bf
              expression: 'min(/MySQL by Zabbix agent active/mysql.aborted_connects.rate,5m)>{$MYSQL.ABORTED_CONN.MAX.WARN}'
              name: 'MySQL: Server has aborted connections'
              event_name: 'MySQL: Server has aborted connections (over {$MYSQL.ABORTED_CONN.MAX.WARN} for 5m)'
              priority: AVERAGE
              description: 'The number of failed attempts to connect to the MySQL server is more than `{$MYSQL.ABORTED_CONN.MAX.WARN}` in the last 5 minutes.'
              dependencies:
                - name: 'MySQL: Refused connections'
                  expression: 'last(/MySQL by Zabbix agent active/mysql.connection_errors_max_connections.rate)>0'
              tags:
                - tag: scope
                  value: availability
        - uuid: 2265406d17394c4a835d209d53d6c259
          name: 'Binlog cache disk use'
          type: DEPENDENT
          key: mysql.binlog_cache_disk_use
          value_type: FLOAT
          description: 'Number of transactions that used a temporary disk cache because they could not fit in the regular binary log cache, being larger than `binlog_cache_size`.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Binlog_cache_disk_use'']/field[@name=''Value'']/text()'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 6h
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: cache
        - uuid: 6179105b341e41e892398649eec227bb
          name: 'Buffer pool efficiency'
          type: CALCULATED
          key: mysql.buffer_pool_efficiency
          value_type: FLOAT
          units: '%'
          params: |
            100 - (last(//mysql.innodb_buffer_pool_reads) / 
            ( last(//mysql.innodb_buffer_pool_read_requests) + 
            ( last(//mysql.innodb_buffer_pool_read_requests) = 0 ) ) * 100 * 
            ( last(//mysql.innodb_buffer_pool_read_requests) > 0 ))
          description: 'The item shows how effectively the buffer pool is serving reads.'
          tags:
            - tag: component
              value: memory
        - uuid: 427ee34312ca4fb595b71db9a350b1fc
          name: 'Buffer pool utilization'
          type: CALCULATED
          key: mysql.buffer_pool_utilization
          value_type: FLOAT
          units: '%'
          params: |
            ( last(//mysql.innodb_buffer_pool_pages_total) - 
            last(//mysql.innodb_buffer_pool_pages_free) ) / 
            ( last(//mysql.innodb_buffer_pool_pages_total) + 
            ( last(//mysql.innodb_buffer_pool_pages_total) = 0 ) ) * 100 * 
            ( last(//mysql.innodb_buffer_pool_pages_total) > 0 )
          description: 'Ratio of used to total pages in the buffer pool.'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: 254756ed1bcb4ae3b342d34b86e1b6fc
              expression: 'max(/MySQL by Zabbix agent active/mysql.buffer_pool_utilization,5m)<{$MYSQL.BUFF_UTIL.MIN.WARN}'
              name: 'MySQL: Buffer pool utilization is too low'
              event_name: 'MySQL: Buffer pool utilization is too low (less than {$MYSQL.BUFF_UTIL.MIN.WARN}% for 5m)'
              priority: WARNING
              description: 'The buffer pool utilization is less than `{$MYSQL.BUFF_UTIL.MIN.WARN}`% in the last 5 minutes. This means that there is a lot of unused RAM allocated for the buffer pool, which you can easily reallocate at the moment.'
              tags:
                - tag: scope
                  value: notice
        - uuid: e22c542460114c7a8877d6a4c56be2f2
          name: 'Bytes received'
          type: DEPENDENT
          key: mysql.bytes_received.rate
          value_type: FLOAT
          units: Bps
          description: 'Number of bytes received from all clients.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Bytes_received'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: network
        - uuid: 2b202ebdc9a546eaa794d61418783e8e
          name: 'Bytes sent'
          type: DEPENDENT
          key: mysql.bytes_sent.rate
          value_type: FLOAT
          units: Bps
          description: 'Number of bytes sent to all clients.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Bytes_sent'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: network
        - uuid: 776e1baca7eb43c693dc8b64552b76b4
          name: 'Command Delete per second'
          type: DEPENDENT
          key: mysql.com_delete.rate
          value_type: FLOAT
          description: 'The `Com_delete` counter variable indicates the number of times the `DELETE` statement has been executed.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Com_delete'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: operations
        - uuid: d8cda6ee6a5340739b65c0fb74986358
          name: 'Command Insert per second'
          type: DEPENDENT
          key: mysql.com_insert.rate
          value_type: FLOAT
          description: 'The `Com_insert` counter variable indicates the number of times the `INSERT` statement has been executed.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Com_insert'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: operations
        - uuid: 1782572b896c43bba77872f2d535dd1f
          name: 'Command Select per second'
          type: DEPENDENT
          key: mysql.com_select.rate
          value_type: FLOAT
          description: 'The `Com_select` counter variable indicates the number of times the `SELECT` statement has been executed.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Com_select'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: operations
        - uuid: 6a53476ac7b548098986dca948ab5395
          name: 'Command Update per second'
          type: DEPENDENT
          key: mysql.com_update.rate
          value_type: FLOAT
          description: 'The `Com_update` counter variable indicates the number of times the `UPDATE` statement has been executed.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Com_update'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: operations
        - uuid: 216667bd998a49b2b4edef82e3bdaa8b
          name: 'Connections per second'
          type: DEPENDENT
          key: mysql.connections.rate
          value_type: FLOAT
          description: 'Number of connection attempts (successful or not) to the MySQL server.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Connections'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
        - uuid: 259c94b73afe486284dae1b15998b305
          name: 'Connection errors accept per second'
          type: DEPENDENT
          key: mysql.connection_errors_accept.rate
          value_type: FLOAT
          description: 'Number of errors that occurred during calls to `accept()` on the listening port.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Connection_errors_accept'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
        - uuid: 7213544faa5d4f0984646ebc2a596dba
          name: 'Connection errors internal per second'
          type: DEPENDENT
          key: mysql.connection_errors_internal.rate
          value_type: FLOAT
          description: 'Number of refused connections due to internal server errors, for example, out of memory errors, or failed thread starts.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Connection_errors_internal'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
        - uuid: b6af884a95e34404b4356a6cad0ea838
          name: 'Connection errors max connections per second'
          type: DEPENDENT
          key: mysql.connection_errors_max_connections.rate
          value_type: FLOAT
          description: 'Number of refused connections due to the `max_connections` limit being reached.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Connection_errors_max_connections'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
          triggers:
            - uuid: 8ce8e2bd4713435e83ccd036e84e1120
              expression: 'last(/MySQL by Zabbix agent active/mysql.connection_errors_max_connections.rate)>0'
              name: 'MySQL: Refused connections'
              event_name: 'MySQL: Refused connections (max_connections limit reached)'
              priority: AVERAGE
              description: 'Number of refused connections due to the `max_connections` limit being reached.'
              tags:
                - tag: scope
                  value: availability
        - uuid: 05e63d8964814d808bfa2833bcdd446e
          name: 'Connection errors peer address per second'
          type: DEPENDENT
          key: mysql.connection_errors_peer_address.rate
          value_type: FLOAT
          description: 'Number of errors while searching for the connecting client''s IP address.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Connection_errors_peer_address'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
        - uuid: f43fd1f1c836446bb543b8f04e6ef564
          name: 'Connection errors select per second'
          type: DEPENDENT
          key: mysql.connection_errors_select.rate
          value_type: FLOAT
          description: 'Number of errors during calls to `select()` or `poll()` on the listening port. The client would not necessarily have been rejected in these cases.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Connection_errors_select'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
        - uuid: e1af6725de7e4fb0b3ec97fa1339e099
          name: 'Connection errors tcpwrap per second'
          type: DEPENDENT
          key: mysql.connection_errors_tcpwrap.rate
          value_type: FLOAT
          description: 'Number of connections the libwrap library has refused.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Connection_errors_tcpwrap'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
        - uuid: 98f0e26ea13946ab9a1f277d22feece7
          name: 'Created tmp tables on disk per second'
          type: DEPENDENT
          key: mysql.created_tmp_disk_tables.rate
          value_type: FLOAT
          description: 'Number of internal on-disk temporary tables created by the server while executing statements.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Created_tmp_disk_tables'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: storage
            - tag: component
              value: tables
          triggers:
            - uuid: 5b6d0d6c7fee4fefb1ed58017818f223
              expression: 'min(/MySQL by Zabbix agent active/mysql.created_tmp_disk_tables.rate,5m)>{$MYSQL.CREATED_TMP_DISK_TABLES.MAX.WARN}'
              name: 'MySQL: Number of on-disk temporary tables created per second is high'
              event_name: 'MySQL: Number of on-disk temporary tables created per second is high (over {$MYSQL.CREATED_TMP_DISK_TABLES.MAX.WARN} for 5m)'
              priority: WARNING
              description: 'The application using the database may be in need of query optimization.'
              tags:
                - tag: scope
                  value: performance
        - uuid: 2c330fcdea6b4993997db65ff0127e95
          name: 'Created tmp files on disk per second'
          type: DEPENDENT
          key: mysql.created_tmp_files.rate
          value_type: FLOAT
          description: 'How many temporary files `mysqld` has created.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Created_tmp_files'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: storage
          triggers:
            - uuid: 3c49bcc1e3e34d1ca6f1d1b5eeeeba9e
              expression: 'min(/MySQL by Zabbix agent active/mysql.created_tmp_files.rate,5m)>{$MYSQL.CREATED_TMP_FILES.MAX.WARN}'
              name: 'MySQL: Number of temporary files created per second is high'
              event_name: 'MySQL: Number of temporary files created per second is high (over {$MYSQL.CREATED_TMP_FILES.MAX.WARN} for 5m)'
              priority: WARNING
              description: 'The application using the database may be in need of query optimization.'
              tags:
                - tag: scope
                  value: performance
        - uuid: e324565c8aef4acba33f1ccc65a1c087
          name: 'Created tmp tables on memory per second'
          type: DEPENDENT
          key: mysql.created_tmp_tables.rate
          value_type: FLOAT
          description: 'Number of internal temporary tables created by the server while executing statements.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Created_tmp_tables'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: memory
            - tag: component
              value: tables
          triggers:
            - uuid: ef985e5db11a49139b0022aaf80cb2d5
              expression: 'min(/MySQL by Zabbix agent active/mysql.created_tmp_tables.rate,5m)>{$MYSQL.CREATED_TMP_TABLES.MAX.WARN}'
              name: 'MySQL: Number of internal temporary tables created per second is high'
              event_name: 'MySQL: Number of internal temporary tables created per second is high (over {$MYSQL.CREATED_TMP_TABLES.MAX.WARN} for 5m)'
              priority: WARNING
              description: 'The application using the database may be in need of query optimization.'
              tags:
                - tag: scope
                  value: performance
        - uuid: 202cc1174b7f4b63a8c90bdc54ec2bb2
          name: 'Get status variables'
          type: ZABBIX_ACTIVE
          key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          history: '0'
          value_type: TEXT
          description: 'Gets server global status information.'
          tags:
            - tag: component
              value: raw
        - uuid: 5551d764b45c4d33a91701aa8b2b5d4f
          name: 'InnoDB buffer pool pages free'
          type: DEPENDENT
          key: mysql.innodb_buffer_pool_pages_free
          description: 'The total size of the InnoDB buffer pool, in pages.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_buffer_pool_pages_free'']/field[@name=''Value'']/text()'
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: c7b4fc71c5d14e0f802e6a4c97c0a98b
          name: 'InnoDB buffer pool pages total'
          type: DEPENDENT
          key: mysql.innodb_buffer_pool_pages_total
          description: 'The total size of the InnoDB buffer pool, in pages.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_buffer_pool_pages_total'']/field[@name=''Value'']/text()'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: 2f05d6a246844924a5e03a615bf20373
          name: 'InnoDB buffer pool reads'
          type: DEPENDENT
          key: mysql.innodb_buffer_pool_reads
          description: 'Number of logical reads that InnoDB could not satisfy from the buffer pool and had to read directly from the disk.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_buffer_pool_reads'']/field[@name=''Value'']/text()'
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: 1655258df96645eea062c66bee146292
          name: 'InnoDB buffer pool reads per second'
          type: DEPENDENT
          key: mysql.innodb_buffer_pool_reads.rate
          value_type: FLOAT
          description: 'Number of logical reads per second that InnoDB could not satisfy from the buffer pool and had to read directly from the disk.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_buffer_pool_reads'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: a266591327664cddb056d9dc2e8de2c7
          name: 'InnoDB buffer pool read requests'
          type: DEPENDENT
          key: mysql.innodb_buffer_pool_read_requests
          description: 'Number of logical read requests.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_buffer_pool_read_requests'']/field[@name=''Value'']/text()'
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: a6b3a633cc0448859ef8b61763ccca1a
          name: 'InnoDB buffer pool read requests per second'
          type: DEPENDENT
          key: mysql.innodb_buffer_pool_read_requests.rate
          value_type: FLOAT
          description: 'Number of logical read requests per second.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_buffer_pool_read_requests'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: ebbeed7d36604713b98677c3fc46a260
          name: 'Innodb buffer pool wait free'
          type: DEPENDENT
          key: mysql.innodb_buffer_pool_wait_free
          value_type: FLOAT
          description: 'Number of times InnoDB waited for a free page before reading or creating a page. Normally, writes to the InnoDB buffer pool happen in the background. When no clean pages are available, dirty pages are flushed first in order to free some up. This counts the numbers of wait for this operation to finish. If this value is not small, look at the increasing `innodb_buffer_pool_size`.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_buffer_pool_wait_free'']/field[@name=''Value'']/text()'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 6h
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: memory
        - uuid: 8ce62d571e854df187d201bd4a7ccce1
          name: 'Calculated value of innodb_log_file_size'
          type: CALCULATED
          key: mysql.innodb_log_file_size
          value_type: FLOAT
          params: '(last(//mysql.innodb_os_log_written) - last(//mysql.innodb_os_log_written,#1:now-1h)) / {$MYSQL.INNODB_LOG_FILES}'
          description: '`Innodb_log_file_size` is calculated as: (`innodb_os_log_written`-`innodb_os_log_written`(time shift -1h))/`{$MYSQL.INNODB_LOG_FILES}`. `Innodb_log_file_size` is the size in bytes of the each InnoDB redo log file in the log group. The combined size can be no more than 512 GB. Larger values mean less disk I/O due to less flushing checkpoint activity, but also slower recovery from a crash.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 6h
          tags:
            - tag: component
              value: system
        - uuid: 323775cd92a04a2a81aa0f6db16ea103
          name: 'Innodb number open files'
          type: DEPENDENT
          key: mysql.innodb_num_open_files
          value_type: FLOAT
          description: 'Number of open files held by InnoDB. InnoDB only.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_num_open_files'']/field[@name=''Value'']/text()'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 6h
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: system
        - uuid: 75d8c835dd7340c2ba31063364a412df
          name: 'Innodb log written'
          type: DEPENDENT
          key: mysql.innodb_os_log_written
          value_type: FLOAT
          units: B
          description: 'Number of bytes written to the InnoDB log.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_os_log_written'']/field[@name=''Value'']/text()'
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: system
        - uuid: 23e12a6eff4b4886b8003407c25c11dc
          name: 'InnoDB row lock time'
          type: DEPENDENT
          key: mysql.innodb_row_lock_time
          value_type: FLOAT
          units: s
          description: 'The total time spent in acquiring row locks for InnoDB tables, in milliseconds.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_row_lock_time'']/field[@name=''Value'']/text()'
            - type: MULTIPLIER
              parameters:
                - '0.001'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: tables
        - uuid: 346c72cd57a24762bc9ed8fabba70bde
          name: 'InnoDB row lock time max'
          type: DEPENDENT
          key: mysql.innodb_row_lock_time_max
          value_type: FLOAT
          units: s
          description: 'The maximum time to acquire a row lock for InnoDB tables, in milliseconds.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_row_lock_time_max'']/field[@name=''Value'']/text()'
            - type: MULTIPLIER
              parameters:
                - '0.001'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: tables
        - uuid: 6b7c9ed85e354d80b30ab34cef539be0
          name: 'InnoDB row lock waits'
          type: DEPENDENT
          key: mysql.innodb_row_lock_waits
          description: 'Number of times operations on InnoDB tables had to wait for a row lock.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Innodb_row_lock_waits'']/field[@name=''Value'']/text()'
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: innodb
            - tag: component
              value: tables
        - uuid: fb60316605b34ad292e1a01b898aea36
          name: 'Max used connections'
          type: DEPENDENT
          key: mysql.max_used_connections
          description: 'The maximum number of connections that have been in use simultaneously since the server start.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Max_used_connections'']/field[@name=''Value'']/text()'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: connections
        - uuid: edb4e1bd71f74861a251d227a3338e69
          name: 'Open tables'
          type: DEPENDENT
          key: mysql.open_tables
          value_type: FLOAT
          description: 'Number of tables that are open.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Open_tables'']/field[@name=''Value'']/text()'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 6h
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: tables
        - uuid: f6d9dae2b21043d18a498add8ca6de41
          name: 'Open table definitions'
          type: DEPENDENT
          key: mysql.open_table_definitions
          value_type: FLOAT
          description: 'Number of cached table definitions.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Open_table_definitions'']/field[@name=''Value'']/text()'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 6h
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: tables
        - uuid: ca43acd282a8435884b33af454b207fb
          name: Status
          type: ZABBIX_ACTIVE
          key: 'mysql.ping["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          description: 'MySQL server status.'
          valuemap:
            name: 'Service state'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - 'return value.indexOf(''is alive'') !== -1 ? 1 : 0;'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: application
            - tag: component
              value: health
          triggers:
            - uuid: fd1b0391ac694aa89950426d75ed3646
              expression: 'last(/MySQL by Zabbix agent active/mysql.ping["{$MYSQL.HOST}","{$MYSQL.PORT}"])=0'
              name: 'MySQL: Service is down'
              priority: HIGH
              description: 'MySQL is down.'
              tags:
                - tag: scope
                  value: availability
        - uuid: a11244940a734fba98f9845316493314
          name: 'Queries per second'
          type: DEPENDENT
          key: mysql.queries.rate
          value_type: FLOAT
          description: 'Number of statements executed by the server. This variable includes statements executed within stored programs, unlike the `Questions` variable.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Queries'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: queries
        - uuid: 790f6deb835a45d4af6e38c18566fccb
          name: 'Questions per second'
          type: DEPENDENT
          key: mysql.questions.rate
          value_type: FLOAT
          description: 'Number of statements executed by the server. This includes only statements sent to the server by clients and not statements executed within stored programs, unlike the `Queries` variable.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Questions'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: queries
        - uuid: bda290b8a1e940e7a98d23844f37670f
          name: 'Slow queries per second'
          type: DEPENDENT
          key: mysql.slow_queries.rate
          value_type: FLOAT
          description: 'Number of queries that have taken more than `long_query_time` seconds.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Slow_queries'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: queries
          triggers:
            - uuid: 72cbaa89dfc7447aad99ac7a9ae78a17
              expression: 'min(/MySQL by Zabbix agent active/mysql.slow_queries.rate,5m)>{$MYSQL.SLOW_QUERIES.MAX.WARN}'
              name: 'MySQL: Server has slow queries'
              event_name: 'MySQL: Server has slow queries (over {$MYSQL.SLOW_QUERIES.MAX.WARN} for 5m)'
              priority: WARNING
              description: 'The number of slow queries is more than `{$MYSQL.SLOW_QUERIES.MAX.WARN}` in the last 5 minutes.'
              tags:
                - tag: scope
                  value: performance
        - uuid: 358e381b2e014fd2b5746e08157af0e1
          name: 'Threads cached'
          type: DEPENDENT
          key: mysql.threads_cached
          description: 'Number of threads in the thread cache.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Threads_cached'']/field[@name=''Value'']/text()'
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: threads
        - uuid: 242dbee07ddd4e16b7866aac62994f22
          name: 'Threads connected'
          type: DEPENDENT
          key: mysql.threads_connected
          description: 'Number of currently open connections.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Threads_connected'']/field[@name=''Value'']/text()'
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: threads
        - uuid: d676416897564faa820e753e4e7a1c8c
          name: 'Threads created per second'
          type: DEPENDENT
          key: mysql.threads_created.rate
          value_type: FLOAT
          description: 'Number of threads created to handle connections. If the value of `Threads_created` is large, you may want to increase the `thread_cache_size` value. The cache miss rate can be calculated as `Threads_created`/`Connections`.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Threads_created'']/field[@name=''Value'']/text()'
            - type: CHANGE_PER_SECOND
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: threads
        - uuid: be72a43bd41c4f56a1437df12b2ca67e
          name: 'Threads running'
          type: DEPENDENT
          key: mysql.threads_running
          description: 'Number of threads that are not sleeping.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Threads_running'']/field[@name=''Value'']/text()'
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: threads
        - uuid: 20fc2471bcb44807b1ef7b4e4e3e8f4b
          name: Uptime
          type: DEPENDENT
          key: mysql.uptime
          units: uptime
          description: 'Number of seconds that the server has been up.'
          preprocessing:
            - type: XMLPATH
              parameters:
                - '/resultset/row[field/text()=''Uptime'']/field[@name=''Value'']/text()'
          master_item:
            key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          tags:
            - tag: component
              value: application
          triggers:
            - uuid: 4e9e4b036c224c6a8f39a41e8ca2f225
              expression: 'nodata(/MySQL by Zabbix agent active/mysql.uptime,30m)=1'
              name: 'MySQL: Failed to fetch info data'
              event_name: 'MySQL: Failed to fetch info data (or no data for 30m)'
              priority: INFO
              description: 'Zabbix has not received any data for items for the last 30 minutes.'
              dependencies:
                - name: 'MySQL: Service is down'
                  expression: 'last(/MySQL by Zabbix agent active/mysql.ping["{$MYSQL.HOST}","{$MYSQL.PORT}"])=0'
              tags:
                - tag: scope
                  value: availability
            - uuid: 05c74a05d68445f38f4c5af591f0fbf8
              expression: 'last(/MySQL by Zabbix agent active/mysql.uptime)<10m'
              name: 'MySQL: Service has been restarted'
              event_name: 'MySQL: Service has been restarted (uptime < 10m)'
              priority: INFO
              description: 'MySQL uptime is less than 10 minutes.'
              tags:
                - tag: scope
                  value: notice
        - uuid: 2071500ce5ac486fa322fbab8acac046
          name: Version
          type: ZABBIX_ACTIVE
          key: 'mysql.version["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          delay: 15m
          value_type: CHAR
          description: 'MySQL server version.'
          preprocessing:
            - type: REGEX
              parameters:
                - '(Server version)\s+(.+)'
                - \2
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: application
          triggers:
            - uuid: 87b33acf66644972b2a9c7daa4376634
              expression: 'last(/MySQL by Zabbix agent active/mysql.version["{$MYSQL.HOST}","{$MYSQL.PORT}"],#1)<>last(/MySQL by Zabbix agent active/mysql.version["{$MYSQL.HOST}","{$MYSQL.PORT}"],#2) and length(last(/MySQL by Zabbix agent active/mysql.version["{$MYSQL.HOST}","{$MYSQL.PORT}"]))>0'
              name: 'MySQL: Version has changed'
              event_name: 'MySQL: Version has changed (new version value received: {ITEM.VALUE})'
              priority: INFO
              description: 'The MySQL version has changed. Acknowledge to close the problem manually.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
      discovery_rules:
        - uuid: 5f6d9b9473494b6d8a9bd0f75211ffac
          name: 'Database discovery'
          type: ZABBIX_ACTIVE
          key: 'mysql.db.discovery["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#DBNAME}'
                value: '{$MYSQL.DBNAME.MATCHES}'
              - macro: '{#DBNAME}'
                value: '{$MYSQL.DBNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
          description: 'Scanning databases in DBMS.'
          item_prototypes:
            - uuid: def6d1e8f3584454b70fb11d99cb30d0
              name: 'Size of database {#DBNAME}'
              type: ZABBIX_ACTIVE
              key: 'mysql.dbsize["{$MYSQL.HOST}","{$MYSQL.PORT}","{#DBNAME}"]'
              delay: 5m
              units: B
              description: 'Database size.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: component
                  value: storage
                - tag: database
                  value: '{#DBNAME}'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  return JSON.stringify(value.split("\n").map(function (name) {
                  	return ({"{#DBNAME}": name});
                  }));
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
        - uuid: 5aa34129f8f144368e9cc8277ae3e66f
          name: 'MariaDB discovery'
          type: DEPENDENT
          key: mysql.extra_metric.discovery
          description: 'Used for additional metrics if MariaDB is used.'
          item_prototypes:
            - uuid: b869afe6691944879e1ba4b3f1277b5c
              name: 'Binlog commits'
              type: DEPENDENT
              key: 'mysql.binlog_commits[{#SINGLETON}]'
              value_type: FLOAT
              description: 'Total number of transactions committed to the binary log.'
              preprocessing:
                - type: XMLPATH
                  parameters:
                    - '/resultset/row[field/text()=''Binlog_commits'']/field[@name=''Value'']/text()'
              master_item:
                key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
              tags:
                - tag: component
                  value: transactions
            - uuid: 8a0e3e5eee0a4f5a83bde012eeb3c150
              name: 'Binlog group commits'
              type: DEPENDENT
              key: 'mysql.binlog_group_commits[{#SINGLETON}]'
              value_type: FLOAT
              description: 'Total number of group commits done to the binary log.'
              preprocessing:
                - type: XMLPATH
                  parameters:
                    - '/resultset/row[field/text()=''Binlog_group_commits'']/field[@name=''Value'']/text()'
              master_item:
                key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
              tags:
                - tag: component
                  value: transactions
            - uuid: 5252fc984cae4a75b4edc8895c8b1fc7
              name: 'Master GTID wait count'
              type: DEPENDENT
              key: 'mysql.master_gtid_wait_count[{#SINGLETON}]'
              value_type: FLOAT
              description: 'The number of times `MASTER_GTID_WAIT` called.'
              preprocessing:
                - type: XMLPATH
                  parameters:
                    - '/resultset/row[field/text()=''Master_gtid_wait_count'']/field[@name=''Value'']/text()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 6h
              master_item:
                key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
              tags:
                - tag: component
                  value: transactions
            - uuid: 151fd5b8ac8e4ac7ac21eeb7b285156a
              name: 'Master GTID wait timeouts'
              type: DEPENDENT
              key: 'mysql.master_gtid_wait_timeouts[{#SINGLETON}]'
              value_type: FLOAT
              description: 'Number of timeouts occurring in `MASTER_GTID_WAIT`.'
              preprocessing:
                - type: XMLPATH
                  parameters:
                    - '/resultset/row[field/text()=''Master_gtid_wait_timeouts'']/field[@name=''Value'']/text()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 6h
              master_item:
                key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
              tags:
                - tag: component
                  value: transactions
            - uuid: 9fd7b98a3594423bb8c697003126eb93
              name: 'Master GTID wait time'
              type: DEPENDENT
              key: 'mysql.master_gtid_wait_time[{#SINGLETON}]'
              value_type: FLOAT
              description: 'Total number of time spent in `MASTER_GTID_WAIT`.'
              preprocessing:
                - type: XMLPATH
                  parameters:
                    - '/resultset/row[field/text()=''Master_gtid_wait_time'']/field[@name=''Value'']/text()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 6h
              master_item:
                key: 'mysql.get_status_variables["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
              tags:
                - tag: component
                  value: transactions
          master_item:
            key: 'mysql.version["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - 'return JSON.stringify(value.search(''MariaDB'')>-1 ? [{''{#SINGLETON}'': ''''}] : []);'
        - uuid: af8c7f2a0fe7405194887397ee722e47
          name: 'Replication discovery'
          type: ZABBIX_ACTIVE
          key: 'mysql.replication.discovery["{$MYSQL.HOST}","{$MYSQL.PORT}"]'
          delay: 1h
          description: 'If "show slave status" returns Master_Host, "Replication: *" items are created.'
          item_prototypes:
            - uuid: bdea1669775442779bfafd536b29c26b
              name: 'Replication Seconds Behind Master {#MASTER_HOST}'
              type: DEPENDENT
              key: 'mysql.seconds_behind_master["{#MASTER_HOST}"]'
              units: s
              description: |
                The number of seconds that the slave SQL thread is behind processing the master binary log.
                A high number (or an increasing one) can indicate that the slave is unable to handle events
                from the master in a timely fashion.
              preprocessing:
                - type: XMLPATH
                  parameters:
                    - '/resultset/row/field[@name=''Seconds_Behind_Master'']/text()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
                - type: NOT_MATCHES_REGEX
                  parameters:
                    - 'null'
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Replication is not performed.'
              master_item:
                key: 'mysql.slave_status["{$MYSQL.HOST}","{$MYSQL.PORT}","{#SQL_STATEMENT}"]'
              tags:
                - tag: component
                  value: replication
              trigger_prototypes:
                - uuid: 31ac7f52dfc84a93a00862e40295419c
                  expression: 'min(/MySQL by Zabbix agent active/mysql.seconds_behind_master["{#MASTER_HOST}"],5m)>{$MYSQL.REPL_LAG.MAX.WARN}'
                  name: 'MySQL: Replication lag is too high'
                  event_name: 'MySQL: Replication lag is too high (over {$MYSQL.REPL_LAG.MAX.WARN} for 5m)'
                  priority: WARNING
                  description: 'Replication delay is too long.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: b024947e0071477c8ce14b3c6a0e4f66
              name: 'Replication Slave IO Running {#MASTER_HOST}'
              type: DEPENDENT
              key: 'mysql.slave_io_running["{#MASTER_HOST}"]'
              value_type: CHAR
              description: |
                Whether the I/O thread for reading the master's binary log is running.
                Normally, you want this to be `Yes` unless you have not yet started replication or have
                explicitly stopped it with `STOP SLAVE`.
              preprocessing:
                - type: XMLPATH
                  parameters:
                    - '/resultset/row/field[@name=''Slave_IO_Running'']/text()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'mysql.slave_status["{$MYSQL.HOST}","{$MYSQL.PORT}","{#SQL_STATEMENT}"]'
              tags:
                - tag: component
                  value: replication
              trigger_prototypes:
                - uuid: fceb91bcca89405faf5c68845d475d55
                  expression: 'count(/MySQL by Zabbix agent active/mysql.slave_io_running["{#MASTER_HOST}"],#1,"ne","Yes")=1'
                  name: 'MySQL: The slave I/O thread is not connected to a replication master'
                  priority: WARNING
                  description: 'Whether the slave I/O thread is connected to the master.'
                  dependencies:
                    - name: 'MySQL: The slave I/O thread is not running'
                      expression: 'count(/MySQL by Zabbix agent active/mysql.slave_io_running["{#MASTER_HOST}"],#1,"eq","No")=1'
                  tags:
                    - tag: scope
                      value: availability
                - uuid: 7d4aa19570704ea5a571e73c19f57c73
                  expression: 'count(/MySQL by Zabbix agent active/mysql.slave_io_running["{#MASTER_HOST}"],#1,"eq","No")=1'
                  name: 'MySQL: The slave I/O thread is not running'
                  priority: AVERAGE
                  description: 'Whether the I/O thread for reading the master''s binary log is running.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 3bf0331407f04af6b2c36892b34af135
              name: 'Replication Slave SQL Running {#MASTER_HOST}'
              type: DEPENDENT
              key: 'mysql.slave_sql_running["{#MASTER_HOST}"]'
              value_type: CHAR
              description: |
                Whether the SQL thread for executing events in the relay log is running.
                As with the I/O thread, this should normally be `Yes`.
              preprocessing:
                - type: XMLPATH
                  parameters:
                    - '/resultset/row/field[@name=''Slave_SQL_Running'']/text()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'mysql.slave_status["{$MYSQL.HOST}","{$MYSQL.PORT}","{#SQL_STATEMENT}"]'
              tags:
                - tag: component
                  value: replication
              trigger_prototypes:
                - uuid: 01397ed577884506aec546fc8c6f1b08
                  expression: 'count(/MySQL by Zabbix agent active/mysql.slave_sql_running["{#MASTER_HOST}"],#1,"eq","No")=1'
                  name: 'MySQL: The SQL thread is not running'
                  priority: WARNING
                  description: 'Whether the SQL thread for executing events in the relay log is running.'
                  dependencies:
                    - name: 'MySQL: The slave I/O thread is not running'
                      expression: 'count(/MySQL by Zabbix agent active/mysql.slave_io_running["{#MASTER_HOST}"],#1,"eq","No")=1'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 9ac0db816bd7423d8956c05fb8e912d4
              name: 'Replication Slave SQL Running State {#MASTER_HOST}'
              type: DEPENDENT
              key: 'mysql.slave_sql_running_state["{#MASTER_HOST}"]'
              value_type: TEXT
              description: 'This shows the state of the SQL driver threads.'
              preprocessing:
                - type: XMLPATH
                  parameters:
                    - '/resultset/row[field/text()=''Slave_SQL_Running_State'']/field[@name=''Value'']/text()'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 6h
              master_item:
                key: 'mysql.slave_status["{$MYSQL.HOST}","{$MYSQL.PORT}","{#SQL_STATEMENT}"]'
              tags:
                - tag: component
                  value: replication
            - uuid: 2a9a2449f0b945afb2b16a1f744ffaef
              name: 'Replication Slave status {#MASTER_HOST}'
              type: ZABBIX_ACTIVE
              key: 'mysql.slave_status["{$MYSQL.HOST}","{$MYSQL.PORT}","{#SQL_STATEMENT}"]'
              history: '0'
              value_type: TEXT
              description: 'The item gets status information on the essential parameters of the slave threads.'
              preprocessing:
                - type: JAVASCRIPT
                  parameters:
                    - |
                      if (value.indexOf("Source_Host") !== 0) {
                      	value = value.replace(/Source/g, "Master");
                      	value = value.replace(/Replica_/g, "Slave_");
                      }
                      
                      return value;
              tags:
                - tag: component
                  value: raw
          lld_macro_paths:
            - lld_macro: '{#MASTER_HOST}'
              path: $.master_host
            - lld_macro: '{#SQL_STATEMENT}'
              path: $.statement
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  if (value.length === 0) {
                  	return '[]';
                  }
                  
                  try {
                  	var matches = value.match(/statement="show (slave|replica) status[\s\S]*(?:Master|Source)_Host[^>]*>([^<]+)</);
                  
                  	if (matches && matches[1] && matches[2]) {
                  		return JSON.stringify([{
                  			statement: matches[1],
                  			master_host: matches[2].trim()
                  		}]);
                  	}
                  
                  	return '[]';
                  }
                  catch (e) {
                  	Zabbix.log(4, 'Replication parser error: ' + e.message);
                  	return '[]';
                  }
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
      tags:
        - tag: class
          value: database
        - tag: subclass
          value: sql
        - tag: target
          value: mysql
      macros:
        - macro: '{$MYSQL.ABORTED_CONN.MAX.WARN}'
          value: '3'
          description: 'Number of failed attempts to connect to the MySQL server for trigger expressions.'
          config:
            type: TEXT
            priority: '3'
            section_name: Thresholds
            label: 'Number of failed attempts to connect threshold'
            description: 'Threshold for the maximum number of failed attempts to connect to the MySQL server. No less than 0.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$MYSQL.BUFF_UTIL.MIN.WARN}'
          value: '50'
          description: 'The minimum buffer pool utilization in percentage for trigger expressions.'
          config:
            type: TEXT
            priority: '6'
            section_name: Thresholds
            label: 'Buffer pool utilization threshold'
            description: 'Threshold of the minimum percentage of buffer pool utilization. In the range from 0 to 100 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$MYSQL.CREATED_TMP_DISK_TABLES.MAX.WARN}'
          value: '10'
          description: 'The maximum number of temporary tables created on a disk per second for trigger expressions.'
          config:
            type: TEXT
            priority: '8'
            section_name: Thresholds
            label: 'Temporary tables created on a disk per second threshold'
            description: 'Threshold for the maximum number of temporary tables created on a disk per second. No less than 0.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$MYSQL.CREATED_TMP_FILES.MAX.WARN}'
          value: '10'
          description: 'The maximum number of temporary files created on a disk per second for trigger expressions.'
          config:
            type: TEXT
            priority: '9'
            section_name: Thresholds
            label: 'Temporary files created on a disk per second threshold'
            description: 'Threshold for the maximum number of temporary files created on a disk per second. No less than 0.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$MYSQL.CREATED_TMP_TABLES.MAX.WARN}'
          value: '30'
          description: 'The maximum number of temporary tables created in memory per second for trigger expressions.'
          config:
            type: TEXT
            priority: '7'
            section_name: Thresholds
            label: 'Temporary tables created in memory per second threshold'
            description: 'Threshold for the maximum number of temporary tables created in memory per second. No less than 0.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$MYSQL.DBNAME.MATCHES}'
          value: .+
          description: 'Filter of discoverable databases.'
          config:
            type: TEXT
            priority: '11'
            section_name: Filters
            label: 'Include database filter'
            description: 'Regex string to include discovered database by its name.'
        - macro: '{$MYSQL.DBNAME.NOT_MATCHES}'
          value: information_schema
          description: 'Filter to exclude discovered databases.'
          config:
            type: TEXT
            priority: '12'
            section_name: Filters
            label: 'Exclude database filter'
            description: 'Regex string to exclude discovered database by its name.'
        - macro: '{$MYSQL.HOST}'
          value: 127.0.0.1
          description: 'Hostname or IP of MySQL host or container.'
          config:
            type: TEXT
            priority: '1'
            label: 'MySQL address'
            description: 'Hostname or IP address of MySQL host or container.'
        - macro: '{$MYSQL.INNODB_LOG_FILES}'
          value: '2'
          description: 'Number of physical files in the InnoDB redo log for calculating `innodb_log_file_size`.'
          config:
            type: TEXT
            priority: '10'
            section_name: Thresholds
            label: 'InnoDB redo log files number (for calculating)'
            description: 'Threshold for the maximum number of physical files in the InnoDB redo log for calculating `innodb_log_file_size`. No less than 0.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$MYSQL.PORT}'
          value: '3306'
          description: 'MySQL service port.'
          config:
            type: TEXT
            priority: '2'
            label: 'MySQL service port'
            description: 'In the range from 1 to 65535 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$MYSQL.REPL_LAG.MAX.WARN}'
          value: 30m
          description: 'Amount of time the slave is behind the master for trigger expressions.'
          config:
            type: TEXT
            priority: '4'
            section_name: Thresholds
            label: 'Replication lag threshold'
            description: 'Threshold of the maximum time the slave is behind the master.'
        - macro: '{$MYSQL.SLOW_QUERIES.MAX.WARN}'
          value: '3'
          description: 'Number of slow queries for trigger expressions.'
          config:
            type: TEXT
            priority: '5'
            section_name: Thresholds
            label: 'Number of slow queries threshold'
            description: 'Threshold for the maximum number of slow queries. No less than 0.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
      dashboards:
        - uuid: 26e905c4d9334467b57de85a2916db87
          name: 'MySQL performance'
          pages:
            - widgets:
                - type: graph
                  name: 'MySQL: Operations'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'MySQL by Zabbix agent active'
                        name: 'MySQL: Operations'
                    - type: STRING
                      name: reference
                      value: AAAAA
                - type: graph
                  name: 'MySQL: Connections'
                  'y': '5'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'MySQL by Zabbix agent active'
                        name: 'MySQL: Connections'
                    - type: STRING
                      name: reference
                      value: AAAAC
                - type: graph
                  name: 'MySQL: InnoDB buffer pool'
                  'y': '10'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'MySQL by Zabbix agent active'
                        name: 'MySQL: InnoDB buffer pool'
                    - type: STRING
                      name: reference
                      value: AAAAE
                - type: graph
                  name: 'MySQL: Queries'
                  x: '36'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'MySQL by Zabbix agent active'
                        name: 'MySQL: Queries'
                    - type: STRING
                      name: reference
                      value: AAAAB
                - type: graph
                  name: 'MySQL: Bandwidth'
                  x: '36'
                  'y': '5'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'MySQL by Zabbix agent active'
                        name: 'MySQL: Bandwidth'
                    - type: STRING
                      name: reference
                      value: AAAAD
                - type: graph
                  name: 'MySQL: Threads'
                  x: '36'
                  'y': '10'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'MySQL by Zabbix agent active'
                        name: 'MySQL: Threads'
                    - type: STRING
                      name: reference
                      value: AAAAF
      valuemaps:
        - uuid: 53bef1cc5ae849e4845ffdd0dd6bcc6a
          name: 'Service state'
          mappings:
            - value: '0'
              newvalue: Down
            - value: '1'
              newvalue: Up
  graphs:
    - uuid: 46d0f938ec754758a116c68b53d51cb7
      name: 'MySQL: Bandwidth'
      graph_items:
        - drawtype: GRADIENT_LINE
          color: 199C0D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.bytes_received.rate
        - sortorder: '1'
          drawtype: GRADIENT_LINE
          color: F63100
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.bytes_sent.rate
    - uuid: 0273aa8a2b5c4672a27fcf735ccfc1de
      name: 'MySQL: Connections'
      graph_items:
        - color: 199C0D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.aborted_clients.rate
        - sortorder: '1'
          color: F63100
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.aborted_connects.rate
        - sortorder: '2'
          color: 00611C
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.connections.rate
        - sortorder: '3'
          color: F7941D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.max_used_connections
    - uuid: 1614ceed2cb74addb9eb35330dea7ad2
      name: 'MySQL: InnoDB buffer pool'
      graph_items:
        - color: 199C0D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.innodb_buffer_pool_pages_free
        - sortorder: '1'
          color: F63100
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.innodb_buffer_pool_pages_total
        - sortorder: '2'
          color: 00611C
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.innodb_buffer_pool_read_requests.rate
        - sortorder: '3'
          color: F7941D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.innodb_buffer_pool_reads.rate
    - uuid: 43dcf7e893754c1ab12b3cf90c890f13
      name: 'MySQL: Operations'
      graph_items:
        - color: 199C0D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.com_delete.rate
        - sortorder: '1'
          color: F63100
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.com_insert.rate
        - sortorder: '2'
          color: 00611C
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.com_select.rate
        - sortorder: '3'
          color: F7941D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.com_update.rate
    - uuid: e1553784c34149a0bbe1e4ab2abc5a26
      name: 'MySQL: Queries'
      graph_items:
        - color: 199C0D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.queries.rate
        - sortorder: '1'
          color: F63100
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.questions.rate
        - sortorder: '2'
          color: 00611C
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.slow_queries.rate
    - uuid: 7547747e0c744353b98fcc914870035c
      name: 'MySQL: Threads'
      graph_items:
        - color: 199C0D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.threads_cached
        - sortorder: '1'
          color: F63100
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.threads_connected
        - sortorder: '2'
          color: 00611C
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.threads_created.rate
        - sortorder: '3'
          color: F7941D
          item:
            host: 'MySQL by Zabbix agent active'
            key: mysql.threads_running
