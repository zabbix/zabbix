<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
   <version>4.4</version>
   <date>2015-12-30T14:41:30Z</date>
   <groups>
      <group>
         <name>Templates/Databases</name>
      </group>
   </groups>
   <templates>
      <template>
         <template>Template DB Redis</template>
         <name>Template DB Redis</name>
         <description>Get Redis metrics from plugin for the New Zabbix Agent (zabbix-agent2).&#13;
&#13;
You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/389050-discussion-thread-for-official-zabbix-template-redis&#13;
&#13;
Template tooling version used: 0.33</description>
         <groups>
            <group>
               <name>Templates/Databases</name>
            </group>
         </groups>
         <applications>
            <application>
               <name>Redis</name>
            </application>
            <application>
               <name>Zabbix raw items</name>
            </application>
         </applications>
         <items>
            <item>
               <name>Redis: Blocked clients</name>
               <type>DEPENDENT</type>
               <key>redis.clients.blocked</key>
               <delay>0</delay>
               <history>7d</history>
               <description>The number of connections waiting on a blocking call</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Clients.blocked_clients</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Connected clients</name>
               <type>DEPENDENT</type>
               <key>redis.clients.connected</key>
               <delay>0</delay>
               <history>7d</history>
               <description>The number of connected clients</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Clients.connected_clients</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Max input buffer</name>
               <type>DEPENDENT</type>
               <key>redis.clients.max_input_buffer</key>
               <delay>0</delay>
               <history>7d</history>
               <description>The biggest input buffer among current client connections</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>var clients = JSON.parse(value).Clients
return clients.client_recent_max_input_buffer || clients.client_biggest_input_buf</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Max output buffer</name>
               <type>DEPENDENT</type>
               <key>redis.clients.max_output_buffer</key>
               <delay>0</delay>
               <history>7d</history>
               <description>The biggest output buffer among current client connections</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>var clients = JSON.parse(value).Clients
return clients.client_recent_max_output_buffer || clients.client_longest_output_list</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Cluster enabled</name>
               <type>DEPENDENT</type>
               <key>redis.cluster.enabled</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Indicate Redis cluster is enabled</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis flag</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Cluster.cluster_enabled</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Max clients</name>
               <type>DEPENDENT</type>
               <key>redis.config.maxclients</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Max number of connected clients at the same time.&#13;
Once the limit is reached Redis will close all the new connections sending an error "max number of clients reached".</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.maxclients</params>
                  </step>
                  <step>
                     <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                     <params>30m</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.config["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Get config</name>
               <key>redis.config["{$REDIS.CONN.URI}"]</key>
               <history>1h</history>
               <trends>0</trends>
               <value_type>TEXT</value_type>
               <applications>
                  <application>
                     <name>Zabbix raw items</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                     <params>1h</params>
                  </step>
               </preprocessing>
               <triggers>
                  <trigger>
                     <expression>{diff()}=1 and {strlen()}&gt;0</expression>
                     <recovery_mode>NONE</recovery_mode>
                     <name>Redis: Configuration has changed</name>
                     <priority>INFO</priority>
                     <description>Redis configuration has changed. Ack to close.</description>
                     <manual_close>YES</manual_close>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: CPU sys</name>
               <type>DEPENDENT</type>
               <key>redis.cpu.sys</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>s</units>
               <description>System CPU consumed by the Redis server</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.CPU.used_cpu_sys</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: CPU sys children</name>
               <type>DEPENDENT</type>
               <key>redis.cpu.sys_children</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>s</units>
               <description>System CPU consumed by the background processes</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.CPU.used_cpu_sys_children</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: CPU user</name>
               <type>DEPENDENT</type>
               <key>redis.cpu.user</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>s</units>
               <description>User CPU consumed by the Redis server</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.CPU.used_cpu_user</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: CPU user children</name>
               <type>DEPENDENT</type>
               <key>redis.cpu.user_children</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>s</units>
               <description>User CPU consumed by the background processes</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.CPU.used_cpu_user_children</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Get info</name>
               <key>redis.info["{$REDIS.CONN.URI}"]</key>
               <history>1h</history>
               <trends>0</trends>
               <value_type>TEXT</value_type>
               <applications>
                  <application>
                     <name>Zabbix raw items</name>
                  </application>
               </applications>
               <triggers>
                  <trigger>
                     <expression>{nodata(30m)}=1</expression>
                     <name>Redis: Failed to fetch info data (or no data for 30m)</name>
                     <priority>WARNING</priority>
                     <description>Zabbix has not received data for items for the last 30 minutes</description>
                     <manual_close>YES</manual_close>
                     <dependencies>
                        <dependency>
                           <name>Redis: Service is down</name>
                           <expression>{Template DB Redis:redis.ping["{$REDIS.CONN.URI}"].last()}=0</expression>
                        </dependency>
                     </dependencies>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: Memory fragmentation ratio</name>
               <type>DEPENDENT</type>
               <key>redis.memory.fragmentation_ratio</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <description>This ratio is an indication of memory mapping efficiency:&#13;
  — Value over 1.0 indicate that memory fragmentation is very likely. Consider restarting the Redis server so the operating system can recover fragmented memory, especially with a ratio over 1.5.&#13;
  — Value under 1.0 indicate that Redis likely has insufficient memory available. Consider optimizing memory usage or adding more RAM.&#13;
&#13;
Note: If your peak memory usage is much higher than your current memory usage, the memory fragmentation ratio may be unreliable.&#13;
&#13;
https://redis.io/topics/memory-optimization</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Memory.mem_fragmentation_ratio</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <triggers>
                  <trigger>
                     <expression>{min(15m)}&gt;{$REDIS.MEM.FRAG_RATIO.MAX.WARN}</expression>
                     <name>Redis: Memory fragmentation ratio is too high (over {$REDIS.MEM.FRAG_RATIO.MAX.WARN} in 15m)</name>
                     <priority>WARNING</priority>
                     <description>This ratio is an indication of memory mapping efficiency:&#13;
  — Value over 1.0 indicate that memory fragmentation is very likely. Consider restarting the Redis server so the operating system can recover fragmented memory, especially with a ratio over 1.5.&#13;
  — Value under 1.0 indicate that Redis likely has insufficient memory available. Consider optimizing memory usage or adding more RAM.&#13;
&#13;
Note: If your peak memory usage is much higher than your current memory usage, the memory fragmentation ratio may be unreliable.&#13;
&#13;
https://redis.io/topics/memory-optimization</description>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: Memory used</name>
               <type>DEPENDENT</type>
               <key>redis.memory.used_memory</key>
               <delay>0</delay>
               <history>7d</history>
               <units>B</units>
               <description>Total number of bytes allocated by Redis using its allocator</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Memory.used_memory</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Memory used Lua</name>
               <type>DEPENDENT</type>
               <key>redis.memory.used_memory_lua</key>
               <delay>0</delay>
               <history>7d</history>
               <units>B</units>
               <description>Amount of memory used by the Lua engine</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Memory.used_memory_lua</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Memory used peak</name>
               <type>DEPENDENT</type>
               <key>redis.memory.used_memory_peak</key>
               <delay>0</delay>
               <history>7d</history>
               <units>B</units>
               <description>Peak memory consumed by Redis (in bytes)</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Memory.used_memory_peak</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Memory used RSS</name>
               <type>DEPENDENT</type>
               <key>redis.memory.used_memory_rss</key>
               <delay>0</delay>
               <history>7d</history>
               <units>B</units>
               <description>Number of bytes that Redis allocated as seen by the operating system</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Memory.used_memory_rss</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: AOF current rewrite time sec</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.aof_current_rewrite_time_sec</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>s</units>
               <description>Duration of the on-going AOF rewrite operation if any</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis bgsave time</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.aof_current_rewrite_time_sec</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: AOF enabled</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.aof_enabled</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Flag indicating AOF logging is activated</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis flag</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.aof_enabled</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: AOF last bgrewrite status</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.aof_last_bgrewrite_status</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Status of the last AOF rewrite operation</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis bgwrite status</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.aof_last_bgrewrite_status</params>
                  </step>
                  <step>
                     <type>BOOL_TO_DECIMAL</type>
                     <params/>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: AOF last rewrite time sec</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.aof_last_rewrite_time_sec</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>s</units>
               <description>Duration of the last AOF rewrite</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis bgsave time</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.aof_last_rewrite_time_sec</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: AOF last write status</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.aof_last_write_status</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Status of the last write operation to the AOF</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis bgwrite status</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.aof_last_write_status</params>
                  </step>
                  <step>
                     <type>BOOL_TO_DECIMAL</type>
                     <params/>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <triggers>
                  <trigger>
                     <expression>{last()}=0</expression>
                     <name>Redis: Last AOF write operation failed</name>
                     <priority>WARNING</priority>
                     <description>Detailed information about persistence: https://redis.io/topics/persistence</description>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: AOF rewrite in progress</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.aof_rewrite_in_progress</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Flag indicating a AOF rewrite operation is on-going</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.aof_rewrite_in_progress</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: AOF rewrite scheduled</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.aof_rewrite_scheduled</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Flag indicating an AOF rewrite operation will be scheduled once the on-going RDB save is complete</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.aof_rewrite_scheduled</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Dump loading</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.loading</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Flag indicating if the load of a dump file is on-going</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis flag</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.loading</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: RDB bgsave in progress</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.rdb_bgsave_in_progress</key>
               <delay>0</delay>
               <history>7d</history>
               <description>"1" if bgsave is in progress and "0" otherwise</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.rdb_bgsave_in_progress</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: RDB changes since last save</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.rdb_changes_since_last_save</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Number of changes since the last background save</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.rdb_changes_since_last_save</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: RDB current bgsave time sec</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.rdb_current_bgsave_time_sec</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>s</units>
               <description>Duration of the on-going RDB save operation if any</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis bgsave time</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.rdb_current_bgsave_time_sec</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: RDB last bgsave status</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.rdb_last_bgsave_status</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Status of the last RDB save operation</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis bgwrite status</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.rdb_last_bgsave_status</params>
                  </step>
                  <step>
                     <type>BOOL_TO_DECIMAL</type>
                     <params/>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <triggers>
                  <trigger>
                     <expression>{last()}=0</expression>
                     <name>Redis: Last RDB save operation failed</name>
                     <priority>WARNING</priority>
                     <description>Detailed information about persistence: https://redis.io/topics/persistence</description>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: RDB last bgsave time sec</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.rdb_last_bgsave_time_sec</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>s</units>
               <description>Duration of the last bg_save operation</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis bgsave time</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.rdb_last_bgsave_time_sec</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: RDB last save time</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.rdb_last_save_time</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Epoch-based timestamp of last successful RDB save</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Persistence.rdb_last_save_time</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Ping</name>
               <key>redis.ping["{$REDIS.CONN.URI}"]</key>
               <history>7h</history>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Service state</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                     <params>10m</params>
                  </step>
               </preprocessing>
               <triggers>
                  <trigger>
                     <expression>{last()}=0</expression>
                     <name>Redis: Service is down</name>
                     <priority>AVERAGE</priority>
                     <manual_close>YES</manual_close>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: Connected slaves</name>
               <type>DEPENDENT</type>
               <key>redis.replication.connected_slaves</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Number of connected slaves</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Replication.connected_slaves</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <triggers>
                  <trigger>
                     <expression>{diff()}=1</expression>
                     <recovery_mode>NONE</recovery_mode>
                     <name>Redis: Number of slaves has changed</name>
                     <priority>INFO</priority>
                     <description>Redis number of slaves has changed. Ack to close.</description>
                     <manual_close>YES</manual_close>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: Master replication offset</name>
               <type>DEPENDENT</type>
               <key>redis.replication.master_repl_offset</key>
               <delay>0</delay>
               <history>7d</history>
               <units>B</units>
               <description>Replication offset reported by the master</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis repl offset</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Replication.master_repl_offset</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Replication backlog active</name>
               <type>DEPENDENT</type>
               <key>redis.replication.repl_backlog_active</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Flag indicating replication backlog is active</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <valuemap>
                  <name>Redis flag</name>
               </valuemap>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Replication.repl_backlog_active</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Replication backlog first byte offset</name>
               <type>DEPENDENT</type>
               <key>redis.replication.repl_backlog_first_byte_offset</key>
               <delay>0</delay>
               <history>7d</history>
               <units>B</units>
               <description>The master offset of the replication backlog buffer</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Replication.repl_backlog_first_byte_offset</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Replication backlog history length</name>
               <type>DEPENDENT</type>
               <key>redis.replication.repl_backlog_histlen</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Amount of data in the backlog sync buffer</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Replication.repl_backlog_histlen</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Replication backlog size</name>
               <type>DEPENDENT</type>
               <key>redis.replication.repl_backlog_size</key>
               <delay>0</delay>
               <history>7d</history>
               <units>B</units>
               <description>Total size in bytes of the replication backlog buffer</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Replication.repl_backlog_size</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Replication role</name>
               <type>DEPENDENT</type>
               <key>redis.replication.role</key>
               <delay>0</delay>
               <history>7d</history>
               <trends>0</trends>
               <value_type>CHAR</value_type>
               <description>Value is "master" if the instance is replica of no one, or "slave" if the instance is a replica of some master instance. Note that a replica can be master of another replica (chained replication).</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Replication.role</params>
                  </step>
                  <step>
                     <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                     <params>1d</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <triggers>
                  <trigger>
                     <expression>{diff()}=1 and {strlen()}&gt;0</expression>
                     <recovery_mode>NONE</recovery_mode>
                     <name>Redis: Replication role has changed (new role: {ITEM.VALUE})</name>
                     <priority>WARNING</priority>
                     <description>Redis replication role has changed. Ack to close.</description>
                     <manual_close>YES</manual_close>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: Process id</name>
               <type>DEPENDENT</type>
               <key>redis.server.process_id</key>
               <delay>0</delay>
               <history>7d</history>
               <description>PID of the server process</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Server.process_id</params>
                  </step>
                  <step>
                     <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                     <params>1d</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Redis mode</name>
               <type>DEPENDENT</type>
               <key>redis.server.redis_mode</key>
               <delay>0</delay>
               <history>7d</history>
               <trends>0</trends>
               <value_type>CHAR</value_type>
               <description>The server's mode ("standalone", "sentinel" or "cluster")</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Server.redis_mode</params>
                  </step>
                  <step>
                     <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                     <params>1d</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Redis version</name>
               <type>DEPENDENT</type>
               <key>redis.server.redis_version</key>
               <delay>0</delay>
               <history>7d</history>
               <trends>0</trends>
               <value_type>CHAR</value_type>
               <description>Version of the Redis server</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Server.redis_version</params>
                  </step>
                  <step>
                     <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                     <params>1d</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <triggers>
                  <trigger>
                     <expression>{diff()}=1 and {strlen()}&gt;0</expression>
                     <recovery_mode>NONE</recovery_mode>
                     <name>Redis: Version has changed (new version: {ITEM.VALUE})</name>
                     <priority>INFO</priority>
                     <description>Redis version has changed. Ack to close.</description>
                     <manual_close>YES</manual_close>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: TCP port</name>
               <type>DEPENDENT</type>
               <key>redis.server.tcp_port</key>
               <delay>0</delay>
               <history>7d</history>
               <description>TCP/IP listen port</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Server.tcp_port</params>
                  </step>
                  <step>
                     <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                     <params>1d</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Uptime</name>
               <type>DEPENDENT</type>
               <key>redis.server.uptime</key>
               <delay>0</delay>
               <history>7d</history>
               <units>s</units>
               <description>Number of seconds since Redis server start</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Server.uptime_in_seconds</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <triggers>
                  <trigger>
                     <expression>{last()}&lt;10m</expression>
                     <name>Redis: has been restarted (uptime &lt; 10m)</name>
                     <priority>INFO</priority>
                     <description>Uptime is less than 10 minutes</description>
                     <manual_close>YES</manual_close>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: Slowlog entries per second</name>
               <key>redis.slowlog.count["{$REDIS.CONN.URI}"]</key>
               <history>7d</history>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>CHANGE_PER_SECOND</type>
                     <params/>
                  </step>
               </preprocessing>
               <triggers>
                  <trigger>
                     <expression>{min(5m)}&gt;{$REDIS.SLOWLOG.COUNT.MAX.WARN}</expression>
                     <name>Redis: Too many entries in the slowlog (over {$REDIS.SLOWLOG.COUNT.MAX.WARN} per second in 5m)</name>
                     <priority>INFO</priority>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: Evicted keys</name>
               <type>DEPENDENT</type>
               <key>redis.stats.evicted_keys</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Number of evicted keys due to maxmemory limit</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.evicted_keys</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Expired keys</name>
               <type>DEPENDENT</type>
               <key>redis.stats.expired_keys</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Total number of key expiration events</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.expired_keys</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Instantaneous input bytes per second</name>
               <type>DEPENDENT</type>
               <key>redis.stats.instantaneous_input.rate</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>Bps</units>
               <description>The network's read rate per second in KB/sec</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.instantaneous_input_kbps</params>
                  </step>
                  <step>
                     <type>MULTIPLIER</type>
                     <params>1024</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Instantaneous operations per sec</name>
               <type>DEPENDENT</type>
               <key>redis.stats.instantaneous_ops.rate</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Number of commands processed per second</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.instantaneous_ops_per_sec</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Instantaneous output bytes per second</name>
               <type>DEPENDENT</type>
               <key>redis.stats.instantaneous_output.rate</key>
               <delay>0</delay>
               <history>7d</history>
               <value_type>FLOAT</value_type>
               <units>Bps</units>
               <description>The network's write rate per second in KB/sec</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.instantaneous_output_kbps</params>
                  </step>
                  <step>
                     <type>MULTIPLIER</type>
                     <params>1024</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Keyspace hits</name>
               <type>DEPENDENT</type>
               <key>redis.stats.keyspace_hits</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Number of successful lookup of keys in the main dictionary</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.keyspace_hits</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Keyspace misses</name>
               <type>DEPENDENT</type>
               <key>redis.stats.keyspace_misses</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Number of failed lookup of keys in the main dictionary</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.keyspace_misses</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Latest fork usec</name>
               <type>DEPENDENT</type>
               <key>redis.stats.latest_fork_usec</key>
               <delay>0</delay>
               <history>7d</history>
               <units>s</units>
               <description>Duration of the latest fork operation in microseconds</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.latest_fork_usec</params>
                  </step>
                  <step>
                     <type>MULTIPLIER</type>
                     <params>1.0E-5</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Migrate cached sockets</name>
               <type>DEPENDENT</type>
               <key>redis.stats.migrate_cached_sockets</key>
               <delay>0</delay>
               <history>7d</history>
               <description>The number of sockets open for MIGRATE purposes</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.migrate_cached_sockets</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Pubsub channels</name>
               <type>DEPENDENT</type>
               <key>redis.stats.pubsub_channels</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Global number of pub/sub channels with client subscriptions</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.pubsub_channels</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Pubsub patterns</name>
               <type>DEPENDENT</type>
               <key>redis.stats.pubsub_patterns</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Global number of pub/sub pattern with client subscriptions</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.pubsub_patterns</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Rejected connections</name>
               <type>DEPENDENT</type>
               <key>redis.stats.rejected_connections</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Number of connections rejected because of maxclients limit</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.rejected_connections</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <triggers>
                  <trigger>
                     <expression>{last()}&gt;0</expression>
                     <name>Redis: Connections are rejected</name>
                     <priority>HIGH</priority>
                     <description>The number of connections has reached the value of "maxclients".&#13;
&#13;
https://redis.io/topics/clients</description>
                  </trigger>
               </triggers>
            </item>
            <item>
               <name>Redis: Sync full</name>
               <type>DEPENDENT</type>
               <key>redis.stats.sync_full</key>
               <delay>0</delay>
               <history>7d</history>
               <description>The number of full resyncs with replicas</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.sync_full</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Sync partial err</name>
               <type>DEPENDENT</type>
               <key>redis.stats.sync_partial_err</key>
               <delay>0</delay>
               <history>7d</history>
               <description>The number of denied partial resync requests</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.sync_partial_err</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Sync partial ok</name>
               <type>DEPENDENT</type>
               <key>redis.stats.sync_partial_ok</key>
               <delay>0</delay>
               <history>7d</history>
               <description>The number of accepted partial resync requests</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.sync_partial_ok</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Total commands processed</name>
               <type>DEPENDENT</type>
               <key>redis.stats.total_commands_processed</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Total number of commands processed by the server</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.total_commands_processed</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Total connections received</name>
               <type>DEPENDENT</type>
               <key>redis.stats.total_connections_received</key>
               <delay>0</delay>
               <history>7d</history>
               <description>Total number of connections accepted by the server</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.total_connections_received</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Total net input bytes</name>
               <type>DEPENDENT</type>
               <key>redis.stats.total_net_input_bytes</key>
               <delay>0</delay>
               <history>7d</history>
               <units>B</units>
               <description>The total number of bytes read from the network</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.total_net_input_bytes</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
            <item>
               <name>Redis: Total net output bytes</name>
               <type>DEPENDENT</type>
               <key>redis.stats.total_net_output_bytes</key>
               <delay>0</delay>
               <history>7d</history>
               <units>B</units>
               <description>The total number of bytes written to the network</description>
               <applications>
                  <application>
                     <name>Redis</name>
                  </application>
               </applications>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Stats.total_net_output_bytes</params>
                  </step>
               </preprocessing>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
            </item>
         </items>
         <discovery_rules>
            <discovery_rule>
               <name>Process metrics discovery</name>
               <type>ZABBIX_PASSIVE</type>
               <key>proc.num["{$REDIS.LLD.PROCESS_NAME}"]</key>
               <delay>1h</delay>
               <description>Collect metrics by Zabbix agent if it exists</description>
               <item_prototypes>
                  <item_prototype>
                     <name>Redis: CPU utilization</name>
                     <key>proc.cpu.util["{$REDIS.PROCESS_NAME}{#SINGLETON}"]</key>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>%</units>
                     <description>Process CPU utilization percentage.</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory usage (rss)</name>
                     <key>proc.mem["{$REDIS.PROCESS_NAME}{#SINGLETON}",,,,rss]</key>
                     <history>7d</history>
                     <units>B</units>
                     <description>Resident set size memory used by process in bytes.</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory usage (vsize)</name>
                     <key>proc.mem["{$REDIS.PROCESS_NAME}{#SINGLETON}",,,,vsize]</key>
                     <history>7d</history>
                     <units>B</units>
                     <description>Virtual memory size used by process in bytes.</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Number of processes running</name>
                     <key>proc.num["{$REDIS.PROCESS_NAME}{#SINGLETON}"]</key>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{last()}=0</expression>
                           <name>Redis: Process is not running</name>
                           <priority>HIGH</priority>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
               </item_prototypes>
               <graph_prototypes>
                  <graph_prototype>
                     <name>Redis: Memory usage{#SINGLETON}</name>
                     <graph_items>
                        <graph_item>
                           <color>1A7C11</color>
                           <item>
                              <host>Template DB Redis</host>
                              <key>proc.mem["{$REDIS.PROCESS_NAME}{#SINGLETON}",,,,vsize]</key>
                           </item>
                        </graph_item>
                        <graph_item>
                           <sortorder>1</sortorder>
                           <color>2774A4</color>
                           <item>
                              <host>Template DB Redis</host>
                              <key>proc.mem["{$REDIS.PROCESS_NAME}{#SINGLETON}",,,,rss]</key>
                           </item>
                        </graph_item>
                     </graph_items>
                  </graph_prototype>
               </graph_prototypes>
               <preprocessing>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>return JSON.stringify(value &gt; 0 ? [{'{#SINGLETON}': ''}] : []);</params>
                  </step>
               </preprocessing>
            </discovery_rule>
            <discovery_rule>
               <name>Keyspace discovery</name>
               <type>DEPENDENT</type>
               <key>redis.keyspace.discovery</key>
               <delay>0</delay>
               <filter>
                  <evaltype>AND</evaltype>
                  <conditions>
                     <condition>
                        <macro>{#DB}</macro>
                        <value>{$REDIS.LLD.FILTER.DB.MATCHES}</value>
                        <formulaid>A</formulaid>
                     </condition>
                     <condition>
                        <macro>{#DB}</macro>
                        <value>{$REDIS.LLD.FILTER.DB.NOT_MATCHES}</value>
                        <operator>NOT_MATCHES_REGEX</operator>
                        <formulaid>B</formulaid>
                     </condition>
                  </conditions>
               </filter>
               <description>Individual keyspace metrics</description>
               <item_prototypes>
                  <item_prototype>
                     <name>DB {#DB}: Average TTL</name>
                     <type>DEPENDENT</type>
                     <key>redis.db.avg_ttl["{#DB}"]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>s</units>
                     <description>Average TTL</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Redis: DB {#DB}</name>
                        </application_prototype>
                     </application_prototypes>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Keyspace["{#DB}"].avg_ttl</params>
                        </step>
                        <step>
                           <type>MULTIPLIER</type>
                           <params>0.001</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>DB {#DB}: Expires</name>
                     <type>DEPENDENT</type>
                     <key>redis.db.expires["{#DB}"]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Number of keys with an expiration</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Redis: DB {#DB}</name>
                        </application_prototype>
                     </application_prototypes>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Keyspace["{#DB}"].expires</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>DB {#DB}: Keys</name>
                     <type>DEPENDENT</type>
                     <key>redis.db.keys["{#DB}"]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Total number of keys</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Redis: DB {#DB}</name>
                        </application_prototype>
                     </application_prototypes>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Keyspace["{#DB}"].keys</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
               </item_prototypes>
               <graph_prototypes>
                  <graph_prototype>
                     <name>DB {#DB}: Keys</name>
                     <graph_items>
                        <graph_item>
                           <drawtype>GRADIENT_LINE</drawtype>
                           <color>1A7C11</color>
                           <item>
                              <host>Template DB Redis</host>
                              <key>redis.db.keys["{#DB}"]</key>
                           </item>
                        </graph_item>
                        <graph_item>
                           <sortorder>1</sortorder>
                           <drawtype>GRADIENT_LINE</drawtype>
                           <color>2774A4</color>
                           <item>
                              <host>Template DB Redis</host>
                              <key>redis.db.expires["{#DB}"]</key>
                           </item>
                        </graph_item>
                     </graph_items>
                  </graph_prototype>
               </graph_prototypes>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <preprocessing>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>return JSON.stringify(Object.keys(JSON.parse(value).Keyspace)
  .map(function (v){return {"{#DB}": v}}));</params>
                  </step>
               </preprocessing>
            </discovery_rule>
            <discovery_rule>
               <name>Version 4+ metrics discovery</name>
               <type>DEPENDENT</type>
               <key>redis.metrics.v4.discovery</key>
               <delay>0</delay>
               <description>Additional metrics for versions 4+</description>
               <item_prototypes>
                  <item_prototype>
                     <name>Redis: Active defrag running{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.active_defrag_running[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Flag indicating if active defragmentation is active</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.active_defrag_running</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Lazyfree pending objects{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.lazyfree_pending_objects[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>The number of objects waiting to be freed (as a result of calling UNLINK, or FLUSHDB and FLUSHALL with the ASYNC option)</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.lazyfree_pending_objects</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Max memory policy{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.maxmemory_policy[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <trends>0</trends>
                     <value_type>CHAR</value_type>
                     <description>The value of the maxmemory-policy configuration directive</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.maxmemory_policy</params>
                        </step>
                        <step>
                           <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                           <params>1d</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Max memory{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.maxmemory[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>Maximum amount of memory allocated to the Redisdb system</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.maxmemory</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min(5m)}/{Template DB Redis:redis.memory.used_memory.last()}*100&gt;{$REDIS.MEM.PUSED.MAX.WARN}</expression>
                           <name>Redis: Memory usage is too high (over {$REDIS.MEM.PUSED.MAX.WARN}% in 5m)</name>
                           <priority>WARNING</priority>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Total system memory{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.total_system_memory[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>The total amount of memory that the Redis host has</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.total_system_memory</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory used dataset %{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.used_memory_dataset_perc[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>%</units>
                     <description>The percentage of used_memory_dataset out of the net memory usage (used_memory minus used_memory_startup)</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.used_memory_dataset_perc</params>
                        </step>
                        <step>
                           <type>REGEX</type>
                           <params>(.+)%
\1</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory used dataset{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.used_memory_dataset[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>The size in bytes of the dataset</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.used_memory_dataset</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory used overhead{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.used_memory_overhead[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>The sum in bytes of all overheads that the server allocated for managing its internal data structures</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.used_memory_overhead</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory used peak %{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.used_memory_peak_perc[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>%</units>
                     <description>The percentage of used_memory_peak out of used_memory</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.used_memory_peak_perc</params>
                        </step>
                        <step>
                           <type>REGEX</type>
                           <params>(.+)%
\1</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory used startup{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.used_memory_startup[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>Initial amount of memory consumed by Redis at startup in bytes</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.used_memory_startup</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: AOF last CoW size{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.persistence.aof_last_cow_size[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>The size in bytes of copy-on-write allocations during the last AOF rewrite operation</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Persistence.aof_last_cow_size</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: RDB last CoW size{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.persistence.rdb_last_cow_size[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>The size in bytes of copy-on-write allocations during the last RDB save operation</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Persistence.rdb_last_cow_size</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Replication second offset{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.second_repl_offset[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>B</units>
                     <description>Offset up to which replication IDs are accepted</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <valuemap>
                        <name>Redis repl offset</name>
                     </valuemap>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Replication.second_repl_offset</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Executable path{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.server.executable[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <trends>0</trends>
                     <value_type>CHAR</value_type>
                     <description>The path to the server's executable</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Server.executable</params>
                        </step>
                        <step>
                           <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                           <params>1d</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Active defrag hits{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.stats.active_defrag_hits[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Number of value reallocations performed by active the defragmentation process</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Stats.active_defrag_hits</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Active defrag key hits{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.stats.active_defrag_key_hits[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Number of keys that were actively defragmented</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Stats.active_defrag_key_hits</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Active defrag key misses{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.stats.active_defrag_key_misses[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Number of keys that were skipped by the active defragmentation process</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Stats.active_defrag_key_misses</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Active defrag misses{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.stats.active_defrag_misses[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Number of aborted value reallocations started by the active defragmentation process</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Stats.active_defrag_misses</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Expired stale %{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.stats.expired_stale_perc[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Stats.expired_stale_perc</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Expired time cap reached count{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.stats.expired_time_cap_reached_count[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Stats.expired_time_cap_reached_count</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Slave expires tracked keys{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.stats.slave_expires_tracked_keys[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>The number of keys tracked for expiry purposes (applicable only to writable replicas)</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Stats.slave_expires_tracked_keys</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
               </item_prototypes>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Server.redis_version</params>
                  </step>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>return JSON.stringify(parseInt(value.split('.')[0]) &gt;= 4 ? [{'{#SINGLETON}': ''}] : []);</params>
                  </step>
               </preprocessing>
            </discovery_rule>
            <discovery_rule>
               <name>Version 5+ metrics discovery</name>
               <type>DEPENDENT</type>
               <key>redis.metrics.v5.discovery</key>
               <delay>0</delay>
               <description>Additional metrics for versions 5+</description>
               <item_prototypes>
                  <item_prototype>
                     <name>Redis: Allocator active{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.allocator_active[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.allocator_active</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Allocator allocated{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.allocator_allocated[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.allocator_allocated</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Allocator fragmentation bytes{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.allocator_frag_bytes[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.allocator_frag_bytes</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Allocator fragmentation ratio{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.allocator_frag_ratio[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.allocator_frag_ratio</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Allocator resident{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.allocator_resident[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.allocator_resident</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Allocator RSS bytes{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.allocator_rss_bytes[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.allocator_rss_bytes</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Allocator RSS ratio{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.allocator_rss_ratio[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.allocator_rss_ratio</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory fragmentation bytes{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.fragmentation_bytes[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.mem_fragmentation_bytes</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory AOF buffer{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.mem_aof_buffer[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Size of the AOF buffer</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.mem_aof_buffer</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory clients normal{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.mem_clients_normal[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.mem_clients_normal</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory clients slaves{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.mem_clients_slaves[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.mem_clients_slaves</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory not counted for evict{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.not_counted_for_evict[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.mem_not_counted_for_evict</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory number of cached scripts{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.number_of_cached_scripts[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.number_of_cached_scripts</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory replication backlog{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.replication_backlog[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.mem_replication_backlog</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory RSS overhead bytes{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.rss_overhead_bytes[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <units>B</units>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.rss_overhead_bytes</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory RSS overhead ratio{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.rss_overhead_ratio[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <value_type>FLOAT</value_type>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.rss_overhead_ratio</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Memory used scripts{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.memory.used_memory_scripts[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Memory.used_memory_scripts</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
               </item_prototypes>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <preprocessing>
                  <step>
                     <type>JSONPATH</type>
                     <params>$.Server.redis_version</params>
                  </step>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>return JSON.stringify(parseInt(value.split('.')[0]) &gt;= 5 ? [{'{#SINGLETON}': ''}] : []);</params>
                  </step>
               </preprocessing>
            </discovery_rule>
            <discovery_rule>
               <name>AOF metrics discovery</name>
               <type>DEPENDENT</type>
               <key>redis.persistence.aof.discovery</key>
               <delay>0</delay>
               <description>If AOF is activated, additional metrics will be added</description>
               <item_prototypes>
                  <item_prototype>
                     <name>Redis: AOF base size{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.persistence.aof_base_size[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>AOF file size on latest startup or rewrite</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Persistence.aof_base_size</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: AOF buffer length{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.persistence.aof_buffer_length[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>Size of the AOF buffer</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Persistence.aof_buffer_length</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: AOF current size{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.persistence.aof_current_size[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>AOF current file size</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Persistence.aof_current_size</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: AOF delayed fsync{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.persistence.aof_delayed_fsync[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Delayed fsync counter</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Persistence.aof_delayed_fsync</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: AOF pending background I/O fsync{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.persistence.aof_pending_bio_fsync[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Number of fsync pending jobs in background I/O queue</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Persistence.aof_pending_bio_fsync</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: AOF pending rewrite{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.persistence.aof_pending_rewrite[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Flag indicating an AOF rewrite operation will</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <valuemap>
                        <name>Redis flag</name>
                     </valuemap>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Persistence.aof_pending_rewrite</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: AOF rewrite buffer length{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.persistence.aof_rewrite_buffer_length[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>Size of the AOF rewrite buffer</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Persistence.aof_rewrite_buffer_length</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
               </item_prototypes>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <preprocessing>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>return JSON.stringify(JSON.parse(value).Persistence.aof_enabled === '1'
  ? [{'{#SINGLETON}': ''}]
  : []);</params>
                  </step>
               </preprocessing>
            </discovery_rule>
            <discovery_rule>
               <name>Replication metrics discovery</name>
               <type>DEPENDENT</type>
               <key>redis.replication.master.discovery</key>
               <delay>0</delay>
               <description>If the instance is the master and the slaves are connected, additional metrics are provided</description>
               <item_prototypes>
                  <item_prototype>
                     <name>Redis slave {#SLAVE_IP}:{#SLAVE_PORT}: Replication lag in bytes</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.lag_bytes["{#SLAVE_IP}:{#SLAVE_PORT}"]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>Replication lag in bytes</description>
                     <application_prototypes>
                        <application_prototype>
                           <name>Redis: Slave {#SLAVE_IP}:{#SLAVE_PORT}</name>
                        </application_prototype>
                     </application_prototypes>
                     <preprocessing>
                        <step>
                           <type>JAVASCRIPT</type>
                           <params>var repl = JSON.parse(value).Replication;
var res = Object.keys(repl)
    .filter(function (v) {return v.match(/slave\d+/)})
    .filter(function (v) {return (repl[v].ip === "{#SLAVE_IP}" &amp;&amp; repl[v].port === "{#SLAVE_PORT}")})
    .map(function (v) {return repl[v].offset})[0];

if (res === undefined) {
    throw 'Slave {#SLAVE_IP}:{#SLAVE_PORT} is no longer available.';
}

return res;</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
               </item_prototypes>
               <graph_prototypes>
                  <graph_prototype>
                     <name>Redis slave {#SLAVE_IP}:{#SLAVE_PORT}: Replication lag bytes</name>
                     <graph_items>
                        <graph_item>
                           <drawtype>BOLD_LINE</drawtype>
                           <color>1A7C11</color>
                           <item>
                              <host>Template DB Redis</host>
                              <key>redis.replication.lag_bytes["{#SLAVE_IP}:{#SLAVE_PORT}"]</key>
                           </item>
                        </graph_item>
                     </graph_items>
                  </graph_prototype>
               </graph_prototypes>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <preprocessing>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>var repl = JSON.parse(value).Replication;
return JSON.stringify(Object.keys(repl)
  .filter(function (v) {return v.match(/slave\d+/)})
  .map(function (v){
    return {"{#SLAVE_IP}": repl[v].ip, "{#SLAVE_PORT}": repl[v].port}
  }));</params>
                  </step>
               </preprocessing>
            </discovery_rule>
            <discovery_rule>
               <name>Slave metrics discovery</name>
               <type>DEPENDENT</type>
               <key>redis.replication.slave.discovery</key>
               <delay>0</delay>
               <description>If the instance is a replica, additional metrics are provided</description>
               <item_prototypes>
                  <item_prototype>
                     <name>Redis: Master host{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.master_host[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <trends>0</trends>
                     <value_type>CHAR</value_type>
                     <description>Host or IP address of the master</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Replication.master_host</params>
                        </step>
                        <step>
                           <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                           <params>1d</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Master last I/O seconds ago{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.master_last_io_seconds_ago[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>s</units>
                     <description>Number of seconds since the last interaction with master</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Replication.master_last_io_seconds_ago</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                     <trigger_prototypes>
                        <trigger_prototype>
                           <expression>{min(5m)}&gt;{$REDIS.REPL.LAG.MAX.WARN}</expression>
                           <name>Redis: Replication lag with master is too high (over {$REDIS.REPL.LAG.MAX.WARN} in 5m)</name>
                           <priority>WARNING</priority>
                        </trigger_prototype>
                     </trigger_prototypes>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Master link status{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.master_link_status[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <trends>0</trends>
                     <value_type>CHAR</value_type>
                     <description>Status of the link (up/down)</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Replication.master_link_status</params>
                        </step>
                        <step>
                           <type>BOOL_TO_DECIMAL</type>
                           <params/>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Master port{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.master_port[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Master listening TCP port</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Replication.master_port</params>
                        </step>
                        <step>
                           <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                           <params>1d</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Master sync in progress{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.master_sync_in_progress[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Indicate the master is syncing to the replica</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Replication.master_sync_in_progress</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Slave priority{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.slave_priority[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>The priority of the instance as a candidate for failover</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Replication.slave_priority</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Slave priority{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.slave_read_only[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <description>Flag indicating if the replica is read-only</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Replication.slave_read_only</params>
                        </step>
                        <step>
                           <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                           <params>1d</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
                  <item_prototype>
                     <name>Redis: Slave replication offset{#SINGLETON}</name>
                     <type>DEPENDENT</type>
                     <key>redis.replication.slave_repl_offset[{#SINGLETON}]</key>
                     <delay>0</delay>
                     <history>7d</history>
                     <units>B</units>
                     <description>The replication offset of the replica instance</description>
                     <applications>
                        <application>
                           <name>Redis</name>
                        </application>
                     </applications>
                     <preprocessing>
                        <step>
                           <type>JSONPATH</type>
                           <params>$.Replication.slave_repl_offset</params>
                        </step>
                     </preprocessing>
                     <master_item>
                        <key>redis.info["{$REDIS.CONN.URI}"]</key>
                     </master_item>
                  </item_prototype>
               </item_prototypes>
               <graph_prototypes>
                  <graph_prototype>
                     <name>Redis: Replication lag time{#SINGLETON}</name>
                     <graph_items>
                        <graph_item>
                           <drawtype>BOLD_LINE</drawtype>
                           <color>1A7C11</color>
                           <item>
                              <host>Template DB Redis</host>
                              <key>redis.replication.master_last_io_seconds_ago[{#SINGLETON}]</key>
                           </item>
                        </graph_item>
                     </graph_items>
                  </graph_prototype>
               </graph_prototypes>
               <master_item>
                  <key>redis.info["{$REDIS.CONN.URI}"]</key>
               </master_item>
               <preprocessing>
                  <step>
                     <type>JAVASCRIPT</type>
                     <params>return JSON.stringify(JSON.parse(value).Replication.role === 'slave'
  ? [{'{#SINGLETON}': ''}]
  : []);</params>
                  </step>
               </preprocessing>
            </discovery_rule>
         </discovery_rules>
         <macros>
            <macro>
               <macro>{$REDIS.CLIENTS.PRC.MAX.WARN}</macro>
               <value>80</value>
               <description>Maximum percentage of connected clients</description>
            </macro>
            <macro>
               <macro>{$REDIS.CONN.URI}</macro>
               <value>tcp://localhost:6379</value>
               <description>Connection string in the URI format (password is not used). This param overwrites a value configured in the "Server" option of the configuration file (if it's set), otherwise, the plugin's default value is used: "tcp://localhost:6379"</description>
            </macro>
            <macro>
               <macro>{$REDIS.LLD.FILTER.DB.MATCHES}</macro>
               <value>.*</value>
               <description>Filter of discoverable databases</description>
            </macro>
            <macro>
               <macro>{$REDIS.LLD.FILTER.DB.NOT_MATCHES}</macro>
               <value>CHANGE_IF_NEEDED</value>
               <description>Filter to exclude discovered databases</description>
            </macro>
            <macro>
               <macro>{$REDIS.LLD.PROCESS_NAME}</macro>
               <value>redis-server</value>
               <description>Redis server process name for LLD</description>
            </macro>
            <macro>
               <macro>{$REDIS.MEM.FRAG_RATIO.MAX.WARN}</macro>
               <value>1.5</value>
               <description>Maximum memory fragmentation ratio</description>
            </macro>
            <macro>
               <macro>{$REDIS.MEM.PUSED.MAX.WARN}</macro>
               <value>90</value>
               <description>Maximum percentage of memory used</description>
            </macro>
            <macro>
               <macro>{$REDIS.PROCESS_NAME}</macro>
               <value>redis-server</value>
               <description>Redis server process name</description>
            </macro>
            <macro>
               <macro>{$REDIS.REPL.LAG.MAX.WARN}</macro>
               <value>30s</value>
               <description>Maximum replication lag in seconds</description>
            </macro>
            <macro>
               <macro>{$REDIS.SLOWLOG.COUNT.MAX.WARN}</macro>
               <value>1</value>
               <description>Maximum number of slowlog entries per second</description>
            </macro>
         </macros>
         <screens>
            <screen>
               <name>Redis overview</name>
               <hsize>2</hsize>
               <vsize>5</vsize>
               <screen_items>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Clients</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>0</x>
                     <y>0</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Keyspace</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>1</x>
                     <y>0</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Commands</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>0</x>
                     <y>1</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Expired keys</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>1</x>
                     <y>1</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Persistence</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>0</x>
                     <y>2</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Slaves</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>1</x>
                     <y>2</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Slowlog</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>0</x>
                     <y>3</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Uptime</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>1</x>
                     <y>3</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>20</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Replication lag time{#SINGLETON}</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>0</x>
                     <y>4</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
               </screen_items>
            </screen>
            <screen>
               <name>Redis performance</name>
               <hsize>2</hsize>
               <vsize>2</vsize>
               <screen_items>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: CPU</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>0</x>
                     <y>0</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Network</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>1</x>
                     <y>0</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Memory</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>0</x>
                     <y>1</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
                  <screen_item>
                     <resourcetype>0</resourcetype>
                     <style>0</style>
                     <resource>
                        <name>Redis: Memory fragmentation</name>
                        <host>Template DB Redis</host>
                     </resource>
                     <width>750</width>
                     <height>100</height>
                     <x>1</x>
                     <y>1</y>
                     <colspan>1</colspan>
                     <rowspan>1</rowspan>
                     <elements>25</elements>
                     <valign>0</valign>
                     <halign>0</halign>
                     <dynamic>0</dynamic>
                     <sort_triggers>0</sort_triggers>
                     <url/>
                     <application/>
                     <max_columns>3</max_columns>
                  </screen_item>
               </screen_items>
            </screen>
         </screens>
      </template>
   </templates>
   <triggers>
      <trigger>
         <expression>{Template DB Redis:redis.clients.connected.min(5m)}/{Template DB Redis:redis.config.maxclients.last()}*100&gt;{$REDIS.CLIENTS.PRC.MAX.WARN}</expression>
         <name>Redis: Total number of connected clients is too high (over {$REDIS.CLIENTS.PRC.MAX.WARN}% in 5m)</name>
         <priority>WARNING</priority>
         <description>When the number of clients reaches the value of the "maxclients" parameter, new connections will be rejected.&#13;
&#13;
https://redis.io/topics/clients#maximum-number-of-clients</description>
      </trigger>
   </triggers>
   <graphs>
      <graph>
         <name>Redis: Clients</name>
         <graph_items>
            <graph_item>
               <drawtype>GRADIENT_LINE</drawtype>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.clients.connected</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>1</sortorder>
               <drawtype>GRADIENT_LINE</drawtype>
               <color>2774A4</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.clients.blocked</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Commands</name>
         <graph_items>
            <graph_item>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.stats.instantaneous_ops.rate</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: CPU</name>
         <graph_items>
            <graph_item>
               <drawtype>GRADIENT_LINE</drawtype>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.cpu.sys</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>1</sortorder>
               <color>2774A4</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.cpu.sys_children</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>2</sortorder>
               <drawtype>GRADIENT_LINE</drawtype>
               <color>F63100</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.cpu.user</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>3</sortorder>
               <color>A54F10</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.cpu.user_children</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Expired keys</name>
         <graph_items>
            <graph_item>
               <drawtype>BOLD_LINE</drawtype>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.stats.expired_keys</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>1</sortorder>
               <drawtype>BOLD_LINE</drawtype>
               <color>2774A4</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.stats.evicted_keys</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Keyspace</name>
         <graph_items>
            <graph_item>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.stats.keyspace_hits</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>1</sortorder>
               <color>2774A4</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.stats.keyspace_misses</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Memory</name>
         <graph_items>
            <graph_item>
               <drawtype>GRADIENT_LINE</drawtype>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.memory.used_memory</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>1</sortorder>
               <drawtype>BOLD_LINE</drawtype>
               <color>2774A4</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.memory.used_memory_rss</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>2</sortorder>
               <drawtype>BOLD_LINE</drawtype>
               <color>F63100</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.memory.used_memory_peak</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Memory fragmentation</name>
         <graph_items>
            <graph_item>
               <drawtype>BOLD_LINE</drawtype>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.memory.fragmentation_ratio</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Network</name>
         <graph_items>
            <graph_item>
               <drawtype>GRADIENT_LINE</drawtype>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.stats.instantaneous_input.rate</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>1</sortorder>
               <drawtype>GRADIENT_LINE</drawtype>
               <color>2774A4</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.stats.instantaneous_output.rate</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Persistence</name>
         <graph_items>
            <graph_item>
               <drawtype>BOLD_LINE</drawtype>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.persistence.rdb_last_bgsave_time_sec</key>
               </item>
            </graph_item>
            <graph_item>
               <sortorder>1</sortorder>
               <drawtype>BOLD_LINE</drawtype>
               <color>2774A4</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.persistence.aof_last_rewrite_time_sec</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Slaves</name>
         <graph_items>
            <graph_item>
               <drawtype>GRADIENT_LINE</drawtype>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.replication.connected_slaves</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Slowlog</name>
         <graph_items>
            <graph_item>
               <drawtype>GRADIENT_LINE</drawtype>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.slowlog.count["{$REDIS.CONN.URI}"]</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
      <graph>
         <name>Redis: Uptime</name>
         <graph_items>
            <graph_item>
               <color>1A7C11</color>
               <item>
                  <host>Template DB Redis</host>
                  <key>redis.server.uptime</key>
               </item>
            </graph_item>
         </graph_items>
      </graph>
   </graphs>
   <value_maps>
      <value_map>
         <name>Service state</name>
         <mappings>
            <mapping>
               <value>0</value>
               <newvalue>Down</newvalue>
            </mapping>
            <mapping>
               <value>1</value>
               <newvalue>Up</newvalue>
            </mapping>
         </mappings>
      </value_map>
      <value_map>
         <name>Redis bgwrite status</name>
         <mappings>
            <mapping>
               <value>0</value>
               <newvalue>Error</newvalue>
            </mapping>
            <mapping>
               <value>1</value>
               <newvalue>Ok</newvalue>
            </mapping>
         </mappings>
      </value_map>
      <value_map>
         <name>Redis flag</name>
         <mappings>
            <mapping>
               <value>0</value>
               <newvalue>No</newvalue>
            </mapping>
            <mapping>
               <value>1</value>
               <newvalue>Yes</newvalue>
            </mapping>
         </mappings>
      </value_map>
      <value_map>
         <name>Redis repl offset</name>
         <mappings>
            <mapping>
               <value>-1 B</value>
               <newvalue>Undefined</newvalue>
            </mapping>
         </mappings>
      </value_map>
      <value_map>
         <name>Redis bgsave time</name>
         <mappings>
            <mapping>
               <value>- 1s</value>
               <newvalue>Inactive</newvalue>
            </mapping>
         </mappings>
      </value_map>
   </value_maps>
</zabbix_export>
