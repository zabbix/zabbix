zabbix_export:
  version: '8.0'
  template_groups:
    - uuid: a571c0d144b14fd4a87a9d9b2aa9fcd6
      name: Templates/Applications
  templates:
    - uuid: 4677be3e07bf4f3285496f2f4230b928
      template: 'IIS by Zabbix agent active'
      name: 'IIS by Zabbix agent active'
      description: |
        Get metrics from IIS using Zabbix agent running on Windows.
        
        You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/401862-discussion-thread-for-official-zabbix-template-internet-information-services
        
        Generated by official Zabbix template tool "Templator"
      wizard_ready: 'YES'
      readme: |
        ## Overview
        
        The template to monitor IIS (Internet Information Services) by Zabbix that works without any external scripts.
        
        ## Setup
        
        You have to enable the following Windows Features (Control Panel > Programs and Features > Turn Windows features on or off) on your server
        ```text
        Web Server (IIS)
        Web Server (IIS)\Management Tools\IIS Management Scripts and Tools
        ```
        
        Optionally, it is possible to customize the template:
        - Set value for the host wizard configuration field `Max app pool request queue length (trigger)`, if you want to receive alerts when a number of requests in the application pool queue exceeds the threshold.
        - If you use a non-standard port for the IIS, don't forget to update the host wizard configuration fields `Service type` and `Listening port`.
        - Change the value of host wizard configuration field `Monitoring status for discovered app pools` to "0", if you want to disable all notifications about application pools state.<br>
        You can also add additional context macro `{$IIS.APPPOOL.MONITORED:<AppPoolName>}` for excluding specific application pools from monitoring.
        - Change regexp in the host wizard configuration fields `Application pools filter (include)` and `Application pools filter (exclude)` used for filtering application pools discovery results.
      vendor:
        name: Zabbix
        version: 8.0-1
      groups:
        - name: Templates/Applications
      items:
        - uuid: 8fa6b28b8226408db07a2317a99581a5
          name: '{$IIS.PORT} port ping'
          type: SIMPLE
          key: 'net.tcp.service[{$IIS.SERVICE},,{$IIS.PORT}]'
          valuemap:
            name: 'Service state'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 2b73bb4c09404d748e019ef2257a9e20
              expression: 'last(/IIS by Zabbix agent active/net.tcp.service[{$IIS.SERVICE},,{$IIS.PORT}])=0'
              name: 'IIS: Port {$IIS.PORT} is down'
              priority: AVERAGE
              manual_close: 'YES'
              dependencies:
                - name: 'IIS: The World Wide Web Publishing Service (W3SVC) is not running'
                  expression: 'last(/IIS by Zabbix agent active/service.info[W3SVC])<>0'
              tags:
                - tag: scope
                  value: availability
        - uuid: e70f872ed9184757b8a62c732658faa5
          name: 'Anonymous users per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Anonymous Users/sec", 60]'
          value_type: FLOAT
          description: 'The number of requests from users over an anonymous connection per second. Average per minute.'
          tags:
            - tag: component
              value: users
        - uuid: 64816de795864c8fae879e670dfe9e93
          name: 'Bytes Received per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Bytes Received/sec", 60]'
          value_type: FLOAT
          units: Bps
          description: 'The average rate per minute at which data bytes are received by the service at the Application Layer. Does not include protocol headers or control bytes.'
          tags:
            - tag: component
              value: network
        - uuid: 1b0b636e0bbd4948b3047071a4b964fc
          name: 'Bytes Sent per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Bytes Sent/sec", 60]'
          value_type: FLOAT
          units: Bps
          description: 'The average rate per minute at which data bytes are sent by the service.'
          tags:
            - tag: component
              value: network
        - uuid: 5abf01f6e7a7419d9a1de9803ccf1060
          name: 'Bytes Total per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Bytes Total/Sec", 60]'
          value_type: FLOAT
          units: Bps
          description: 'The average rate per minute of total bytes/sec transferred by the Web service (sum of bytes sent/sec and bytes received/sec).'
          tags:
            - tag: component
              value: network
        - uuid: 37b23949ca94466eb552c6fd8239b650
          name: 'Method CGI requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\CGI Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of CGI requests that are simultaneously being processed by the Web service. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: d32eb1398fa7454eb91329aa39d1e90e
          name: 'Connection attempts per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Connection Attempts/Sec", 60]'
          value_type: FLOAT
          description: 'The average rate per minute that connections using the Web service are being attempted. The count is the average for all Web sites combined.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: connections
        - uuid: 182bceaa31194bdd8c906cf226039b0b
          name: 'Method COPY requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Copy Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests made using the COPY method. Copy requests are used for copying files and directories. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 8b316e2896f041dca9b4adc601093b5c
          name: 'Current connections'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Current Connections"]'
          value_type: FLOAT
          description: 'The number of active connections.'
          tags:
            - tag: component
              value: connections
        - uuid: 7da6cf8a65b94b6f8d89dc53c7de38eb
          name: 'Method DELETE requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Delete Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the DELETE method made. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 5381bfc071524f32bb5290379d2e978d
          name: 'Method GET requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Get Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests made using the GET method. GET requests are generally used for basic file retrievals or image maps, though they can be used with forms. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 414b17c9eb11460cb55d35aeb7b8c071
          name: 'Method HEAD requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Head Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the HEAD method made. HEAD requests generally indicate a client is querying the state of a document they already have to see if it needs to be refreshed. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: d5b38b5472214d629e832d2709c64b3c
          name: 'Method ISAPI requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\ISAPI Extension Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of ISAPI Extension requests that are simultaneously being processed by the Web service. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 74fed9efa0ae4301aab2f73d76fd8357
          name: 'Locked errors per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Locked Errors/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of errors due to requests that couldn''t be satisfied by the server because the requested document was locked. These are generally reported as an HTTP 423 error code to the client. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: errors
        - uuid: cdf63d485cd1419385caabc050eb533c
          name: 'Method LOCK requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Lock Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests made using the LOCK method. Lock requests are used to lock a file for one user so that only that user can modify the file. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: edbe50383897434cb33378b973628061
          name: 'Method MKCOL requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Mkcol Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the MKCOL method made. Mkcol requests are used to create directories on the server. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 51a74530b894484a9ba101eb1176a982
          name: 'Method MOVE requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Move Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the MOVE method made. Move requests are used for moving files and directories. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 6dfe3dbde2544c5080c3845d54c83219
          name: 'NonAnonymous users per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\NonAnonymous Users/sec", 60]'
          value_type: FLOAT
          description: 'The number of requests from users over a non-anonymous connection per second. Average per minute.'
          tags:
            - tag: component
              value: users
        - uuid: 13e65fdff0704e6f87133b8efe34704f
          name: 'Not Found errors per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Not Found Errors/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of errors due to requests that couldn''t be satisfied by the server because the requested document could not be found. These are generally reported to the client with HTTP error code 404. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: errors
        - uuid: dcb0338dc59d4c95b9f712fed84a3aa2
          name: 'Method OPTIONS requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Options Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the OPTIONS method made. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: eb6a098fef824b2e9abe80b4331190f4
          name: 'Method Total Other requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Other Request Methods/Sec", 60]'
          value_type: FLOAT
          description: 'Total Other Request Methods is the number of HTTP requests that are not OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, MOVE, COPY, MKCOL, PROPFIND, PROPPATCH, SEARCH, LOCK or UNLOCK methods (since service startup). Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 222bb49332214781bc48a0eb610035c2
          name: 'Method POST requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Post Requests/Sec", 60]'
          value_type: FLOAT
          description: 'Rate of HTTP requests using POST method. Generally used for forms or gateway requests. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 011fff85fb0440b78ca7857454577c08
          name: 'Method PROPFIND requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Propfind Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the PROPFIND method made. Propfind requests retrieve property values on files and directories. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 3b8a1eea86034a268ac37031c08d3740
          name: 'Method PROPPATCH requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Proppatch Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the PROPPATCH method made. Proppatch requests set property values on files and directories. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: c4615d7155d14f98b76705df1a5778e4
          name: 'Method PUT requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Put Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the PUT method made. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: a1cfef3952c346ccb39e85038e49ae63
          name: 'Method MS-SEARCH requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Search Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the MS-SEARCH method made. Search requests are used to query the server to find resources that match a set of conditions provided by the client. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: d53040c921324b2195045dacb3738d6f
          name: Uptime
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Service Uptime"]'
          value_type: FLOAT
          units: s
          description: 'The service uptime expressed in seconds.'
          tags:
            - tag: component
              value: application
          triggers:
            - uuid: f68768567f334d369d52797309f95c41
              expression: 'last(/IIS by Zabbix agent active/perf_counter_en["\Web Service(_Total)\Service Uptime"])<10m'
              name: 'IIS: Service has been restarted'
              event_name: 'IIS: Service has been restarted (uptime < 10m)'
              priority: INFO
              description: 'Uptime is less than 10 minutes.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: notice
        - uuid: f181123b522946018d9ac90599693cfe
          name: 'Total connection attempts'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Total Connection Attempts (all instances)"]'
          value_type: FLOAT
          description: 'The total number of connections to the Web or FTP service that have been attempted since service startup. The count is the total for all Web sites or FTP sites combined.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: connections
        - uuid: ff70ce9edf1c45ba8263d33847992baf
          name: 'Method Total requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Total Method Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of all HTTP requests received. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: fff9e968d5474adfbfd4ae9e19d836d9
          name: 'Method TRACE requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Trace Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the TRACE method made. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 0b6b770a6b014b8c857277e1d9cf6ffe
          name: 'Method TRACE requests per second'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service(_Total)\Unlock Requests/Sec", 60]'
          value_type: FLOAT
          description: 'The rate of HTTP requests using the UNLOCK method made. Unlock requests are used to remove locks from files. Average per minute.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: requests
        - uuid: 5ef9aec68d5b4fe79b17453ab8988b59
          name: 'Files cache hits percentage'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service Cache\File Cache Hits %"]'
          value_type: FLOAT
          description: 'The ratio of user-mode file cache hits to total cache requests (since service startup). Note: This value might be low if the Kernel URI cache hits percentage is high.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: cache
        - uuid: a041713a95e746f5b4797a7aecaed9a5
          name: 'File cache misses'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service Cache\File Cache Misses"]'
          value_type: FLOAT
          description: 'The total number of unsuccessful lookups in the user-mode file cache since service startup.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: cache
        - uuid: 5488881cba254b6b8f49ebacae2bc4c4
          name: 'URIs cache hits percentage'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service Cache\URI Cache Hits %"]'
          value_type: FLOAT
          description: 'The ratio of user-mode URI Cache Hits to total cache requests (since service startup)'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: cache
        - uuid: ffd18aef119f4c7c845c6a3e76fb747d
          name: 'URI cache misses'
          type: ZABBIX_ACTIVE
          key: 'perf_counter_en["\Web Service Cache\URI Cache Misses"]'
          value_type: FLOAT
          description: 'The total number of unsuccessful lookups in the user-mode URI cache since service startup.'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: cache
        - uuid: 31d4f21ce4c6412b912ca65fe9aee83c
          name: 'World Wide Web Publishing Service (W3SVC) state'
          type: ZABBIX_ACTIVE
          key: 'service.info[W3SVC]'
          description: 'The World Wide Web Publishing Service (W3SVC) provides web connectivity and administration of websites through the IIS snap-in. If the World Wide Web Publishing Service stops, the operating system cannot serve any form of web request. This service was dependent on "Windows Process Activation Service".'
          valuemap:
            name: 'Windows service state'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: application
            - tag: component
              value: health
          triggers:
            - uuid: ca139b8b27c44f7fb22938fd3419cff5
              expression: 'last(/IIS by Zabbix agent active/service.info[W3SVC])<>0'
              name: 'IIS: The World Wide Web Publishing Service (W3SVC) is not running'
              priority: HIGH
              description: 'The World Wide Web Publishing Service (W3SVC) is not in the running state. IIS cannot start.'
              dependencies:
                - name: 'IIS: Windows process Activation Service (WAS) is not running'
                  expression: 'last(/IIS by Zabbix agent active/service.info[WAS])<>0'
              tags:
                - tag: scope
                  value: availability
        - uuid: 7f016ce3ab3941b78741dfb72c6d7693
          name: 'Windows Process Activation Service (WAS) state'
          type: ZABBIX_ACTIVE
          key: 'service.info[WAS]'
          description: 'Windows Process Activation Service (WAS) is a tool for managing worker processes that contain applications that host Windows Communication Foundation (WCF) services. Worker processes handle requests that are sent to a Web Server for specific application pools. Each application pool sets boundaries for the applications it contains.'
          valuemap:
            name: 'Windows service state'
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 10m
          tags:
            - tag: component
              value: application
            - tag: component
              value: health
          triggers:
            - uuid: d7a16291f196424ca9c39af4271ab78f
              expression: 'last(/IIS by Zabbix agent active/service.info[WAS])<>0'
              name: 'IIS: Windows process Activation Service (WAS) is not running'
              priority: HIGH
              description: 'Windows Process Activation Service (WAS) is not in the running state. IIS cannot start.'
              tags:
                - tag: scope
                  value: availability
        - uuid: bfe53ca77e2046d6bb9ece5250e227f1
          name: 'Active agent availability'
          type: INTERNAL
          key: 'zabbix[host,active_agent,available]'
          description: |
            Availability of active checks on the host. The value of this item corresponds to availability icons in the host list.
            Possible values:
            0 - unknown
            1 - available
            2 - not available
          valuemap:
            name: zabbix.host.active_agent.available
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: b9d8edc865f54e8eb56e84392817ff5b
              expression: 'min(/IIS by Zabbix agent active/zabbix[host,active_agent,available],{$AGENT.TIMEOUT})=2'
              name: 'IIS: Active checks are not available'
              opdata: 'Current state: {ITEM.LASTVALUE1}'
              priority: HIGH
              description: 'Active checks are considered unavailable. Agent is not sending heartbeat for prolonged time.'
              tags:
                - tag: scope
                  value: availability
      discovery_rules:
        - uuid: 1dfb7339b81b4237a4e90b29328de297
          name: 'Application pools discovery'
          type: ZABBIX_ACTIVE
          key: 'wmi.getall[root\webAdministration, select Name from ApplicationPool]'
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              - macro: '{#APPPOOL}'
                value: '{$IIS.APPPOOL.MATCHES}'
              - macro: '{#APPPOOL}'
                value: '{$IIS.APPPOOL.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
          item_prototypes:
            - uuid: 82c0636b84d84863a2051d6b708d841b
              name: 'AppPool {#APPPOOL} state'
              type: ZABBIX_ACTIVE
              key: 'perf_counter_en["\APP_POOL_WAS({#APPPOOL})\Current Application Pool State"]'
              description: 'The state of the application pool.'
              valuemap:
                name: 'Application pool state'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 10m
              tags:
                - tag: application-pool
                  value: '{#APPPOOL}'
                - tag: component
                  value: application
              trigger_prototypes:
                - uuid: a7184495eb684293ada387292c812b0f
                  expression: 'last(/IIS by Zabbix agent active/perf_counter_en["\APP_POOL_WAS({#APPPOOL})\Current Application Pool State"])<>3 and {$IIS.APPPOOL.MONITORED:"{#APPPOOL}"}=1'
                  name: 'IIS: Application pool {#APPPOOL} is not in Running state'
                  priority: HIGH
                  dependencies:
                    - name: 'IIS: The World Wide Web Publishing Service (W3SVC) is not running'
                      expression: 'last(/IIS by Zabbix agent active/service.info[W3SVC])<>0'
                  tags:
                    - tag: scope
                      value: availability
            - uuid: f0a6fe8a4cc44582a3048f1a00442736
              name: '{#APPPOOL} Uptime'
              type: ZABBIX_ACTIVE
              key: 'perf_counter_en["\APP_POOL_WAS({#APPPOOL})\Current Application Pool Uptime"]'
              value_type: FLOAT
              units: s
              description: 'The web application uptime period since the last restart.'
              tags:
                - tag: application-pool
                  value: '{#APPPOOL}'
                - tag: component
                  value: application
              trigger_prototypes:
                - uuid: d2a9854722a44253a39c8eaab67f7677
                  expression: 'last(/IIS by Zabbix agent active/perf_counter_en["\APP_POOL_WAS({#APPPOOL})\Current Application Pool Uptime"])<10m'
                  name: 'IIS: {#APPPOOL} has been restarted'
                  event_name: 'IIS: {#APPPOOL} has been restarted (uptime < 10m)'
                  priority: INFO
                  description: 'Uptime is less than 10 minutes.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: e2cfc77aebab4b14bf6a690dbdd0c2b1
              name: 'AppPool {#APPPOOL} recycles'
              type: ZABBIX_ACTIVE
              key: 'perf_counter_en["\APP_POOL_WAS({#APPPOOL})\Total Application Pool Recycles"]'
              description: 'The number of times the application pool has been recycled since Windows Process Activation Service (WAS) started.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 10m
              tags:
                - tag: application-pool
                  value: '{#APPPOOL}'
                - tag: component
                  value: application
              trigger_prototypes:
                - uuid: 27a93967a29849f3aef833db136e1b8e
                  expression: 'last(/IIS by Zabbix agent active/perf_counter_en["\APP_POOL_WAS({#APPPOOL})\Total Application Pool Recycles"],#1)<>last(/IIS by Zabbix agent active/perf_counter_en["\APP_POOL_WAS({#APPPOOL})\Total Application Pool Recycles"],#2) and {$IIS.APPPOOL.MONITORED:"{#APPPOOL}"}=1'
                  name: 'IIS: Application pool {#APPPOOL} has been recycled'
                  priority: INFO
                  tags:
                    - tag: scope
                      value: notice
            - uuid: d525c1c47ee2402d9635ae276a5e58ec
              name: 'AppPool {#APPPOOL} current queue size'
              type: ZABBIX_ACTIVE
              key: 'perf_counter_en["\HTTP Service Request Queues({#APPPOOL})\CurrentQueueSize"]'
              delay: 30s
              description: 'The number of requests in the queue.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 10m
              tags:
                - tag: application-pool
                  value: '{#APPPOOL}'
                - tag: component
                  value: application
              trigger_prototypes:
                - uuid: 68499a4737d24ee6846aaea2a37b7b4f
                  expression: 'min(/IIS by Zabbix agent active/perf_counter_en["\HTTP Service Request Queues({#APPPOOL})\CurrentQueueSize"],{$IIS.QUEUE.MAX.TIME})>{$IIS.QUEUE.MAX.WARN}'
                  name: 'IIS: Request queue of {#APPPOOL} is too large'
                  event_name: 'IIS: Request queue of {#APPPOOL} is too large (over {$IIS.QUEUE.MAX.WARN})'
                  priority: WARNING
                  dependencies:
                    - name: 'IIS: Application pool {#APPPOOL} is not in Running state'
                      expression: 'last(/IIS by Zabbix agent active/perf_counter_en["\APP_POOL_WAS({#APPPOOL})\Current Application Pool State"])<>3 and {$IIS.APPPOOL.MONITORED:"{#APPPOOL}"}=1'
                  tags:
                    - tag: scope
                      value: performance
          lld_macro_paths:
            - lld_macro: '{#APPPOOL}'
              path: $.Name
      tags:
        - tag: class
          value: software
        - tag: subclass
          value: webserver
        - tag: target
          value: iis
      macros:
        - macro: '{$AGENT.TIMEOUT}'
          value: 5m
          description: 'Timeout after which agent is considered unavailable.'
          config:
            type: TEXT
            priority: '8'
            section_name: Other
            label: 'Agent timeout (when agent is offline)'
            description: 'Timeout after which agent is considered unavailable.'
        - macro: '{$IIS.APPPOOL.MATCHES}'
          value: .+
          description: 'This macro is used in application pools discovery. Can be overridden on the host or linked template level.'
          config:
            type: TEXT
            priority: '6'
            section_name: Filters
            label: 'Application pools filter (include)'
            description: 'This macro is used in application pools discovery. Can be overridden on the host or linked template level.'
        - macro: '{$IIS.APPPOOL.MONITORED}'
          value: '1'
          description: 'Monitoring status for discovered application pools. Use context to avoid trigger firing for specific application pools. "1" - enabled, "0" - disabled.'
          config:
            type: TEXT
            priority: '7'
            section_name: Other
            label: 'Monitoring status for discovered app pools'
            description: 'Monitoring status for discovered application pools. Use context to avoid trigger firing for specific application pools. "1" - enabled, "0" - disabled.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$IIS.APPPOOL.NOT_MATCHES}'
          value: '<CHANGE_IF_NEEDED>'
          description: 'This macro is used in application pools discovery. Can be overridden on the host or linked template level.'
          config:
            type: TEXT
            priority: '5'
            section_name: Filters
            label: 'Application pools filter (exclude)'
            description: 'This macro is used in application pools discovery. Can be overridden on the host or linked template level.'
        - macro: '{$IIS.PORT}'
          value: '80'
          description: 'Listening port.'
          config:
            type: TEXT
            priority: '1'
            label: 'Listening port'
            description: 'Listening port. In the range from 1 to 65535 inclusive.'
            required: 'YES'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$IIS.QUEUE.MAX.TIME}'
          value: 5m
          description: 'The time during which the queue length may exceed the threshold.'
          config:
            type: TEXT
            priority: '4'
            section_name: Thresholds
            label: 'Time queue length may exceed threshold'
            description: 'The time during which the queue length may exceed the threshold.'
        - macro: '{$IIS.QUEUE.MAX.WARN}'
          description: 'Maximum application pool''s request queue length for trigger expression.'
          config:
            type: TEXT
            priority: '3'
            section_name: Thresholds
            label: 'Max app pool request queue length (trigger)'
            description: 'Maximum application pool''s request queue length for trigger expression.'
        - macro: '{$IIS.SERVICE}'
          value: http
          description: 'The service (http/https/etc) for port check. See "net.tcp.service" documentation page for more information: https://www.zabbix.com/documentation/8.0/manual/config/items/itemtypes/simple_checks'
          config:
            type: TEXT
            priority: '2'
            label: 'Service type'
            description: 'The service (http/https/etc) for port check. See "net.tcp.service" documentation page for more information: https://www.zabbix.com/documentation/8.0/manual/config/items/itemtypes/simple_checks'
            required: 'YES'
      dashboards:
        - uuid: 5fab732455514f558e99fc392a1a7e7e
          name: 'IIS Overview'
          pages:
            - widgets:
                - type: graph
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'IIS by Zabbix agent active'
                        name: 'IIS: Requests rate'
                    - type: STRING
                      name: reference
                      value: AAAAA
                - type: graph
                  'y': '5'
                  width: '72'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'IIS by Zabbix agent active'
                        name: 'IIS: Cache misses'
                    - type: STRING
                      name: reference
                      value: AAAAC
                - type: graph
                  x: '36'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'IIS by Zabbix agent active'
                        name: 'IIS: Cache hits percentage'
                    - type: STRING
                      name: reference
                      value: AAAAB
      valuemaps:
        - uuid: 636c6915a8154b6ea1ea5b00f015c149
          name: 'Application pool state'
          mappings:
            - value: '1'
              newvalue: Uninitialized
            - value: '2'
              newvalue: Initialized
            - value: '3'
              newvalue: Running
            - value: '4'
              newvalue: Disabling
            - value: '5'
              newvalue: Disabled
            - value: '6'
              newvalue: 'Shutdown Pending'
            - value: '7'
              newvalue: 'Delete Pending'
        - uuid: 41be60c561114627b861677603b92acb
          name: 'Service state'
          mappings:
            - value: '0'
              newvalue: Down
            - value: '1'
              newvalue: Up
        - uuid: 6dc834d8e50842d3a7337b0f88540b61
          name: 'Windows service state'
          mappings:
            - value: '0'
              newvalue: Running
            - value: '1'
              newvalue: Paused
            - value: '2'
              newvalue: 'Start pending'
            - value: '3'
              newvalue: 'Pause pending'
            - value: '4'
              newvalue: 'Continue pending'
            - value: '5'
              newvalue: 'Stop pending'
            - value: '6'
              newvalue: Stopped
            - value: '7'
              newvalue: Unknown
            - value: '255'
              newvalue: 'No such service'
        - uuid: c63064c6717e4604805491ce54166356
          name: zabbix.host.active_agent.available
          mappings:
            - value: '0'
              newvalue: unknown
            - value: '1'
              newvalue: available
            - value: '2'
              newvalue: 'not available'
  graphs:
    - uuid: e3b3f8f973204070a37b9eb861e2a079
      name: 'IIS: Cache hits percentage'
      type: STACKED
      graph_items:
        - color: 199C0D
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service Cache\URI Cache Hits %"]'
        - sortorder: '1'
          color: F63100
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service Cache\File Cache Hits %"]'
    - uuid: 2ac5f3ee169b4e79ad6f08e4dffbffeb
      name: 'IIS: Cache misses'
      graph_items:
        - color: 199C0D
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service Cache\URI Cache Misses"]'
        - sortorder: '1'
          color: F63100
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service Cache\File Cache Misses"]'
    - uuid: 4c488d9247ca49ac8b33d655ccbca2b3
      name: 'IIS: Requests rate'
      graph_items:
        - color: 199C0D
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service(_Total)\Total Method Requests/Sec", 60]'
        - sortorder: '1'
          color: F63100
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service(_Total)\Other Request Methods/Sec", 60]'
        - sortorder: '2'
          color: 00611C
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service(_Total)\Get Requests/Sec", 60]'
        - sortorder: '3'
          color: F7941D
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service(_Total)\Post Requests/Sec", 60]'
        - sortorder: '4'
          color: FC6EA3
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service(_Total)\Put Requests/Sec", 60]'
        - sortorder: '5'
          color: 6C59DC
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service(_Total)\Delete Requests/Sec", 60]'
        - sortorder: '6'
          color: C7A72D
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service(_Total)\Head Requests/Sec", 60]'
        - sortorder: '7'
          color: BA2A5D
          item:
            host: 'IIS by Zabbix agent active'
            key: 'perf_counter_en["\Web Service(_Total)\Trace Requests/Sec", 60]'
