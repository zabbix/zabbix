zabbix_export:
  version: '5.4'
  date: '2021-01-28T10:38:45Z'
  groups:
    -
      name: Templates/Applications
  templates:
    -
      template: 'Aranet Cloud'
      name: 'Aranet Cloud'
      description: 'Template tooling version used: 0.38'
      groups:
        -
          name: Templates/Applications
      applications:
        -
          name: Aranet
        -
          name: 'Zabbix raw items'
      items:
        -
          name: 'Aranet: Get data'
          type: SCRIPT
          key: aranet.get_data
          history: '0'
          trends: '0'
          value_type: TEXT
          params: |
            var Aranet = {
                params: {},
                auth_token: null,
                refresh_token: null,
                space_id: null,
            
                setParams: function (params) {
                    ['api_endpoint', 'username', 'password', 'space_name'].forEach(function (field) {
                        if (typeof params !== 'object' || typeof params[field] === 'undefined'
                                || params[field] === '') {
                            throw 'Required param is not set: "' + field + '".';
                        }
                    });
            
                    Aranet.params = params;
                    if (typeof Aranet.params.api_endpoint === 'string') {
                        if (!Aranet.params.api_endpoint.endsWith('/')) {
                            Aranet.params.api_endpoint += '/';
                        }
                    }
                },
            
                request: function (method, query, data) {
                    var response,
                        request = new HttpRequest(),
                        url = Aranet.params.api_endpoint + query;
            
                    request.addHeader('Content-Type: application/json');
            
                    if (Aranet.auth_token !== null) {
                        request.addHeader('Authorization: Bearer ' + Aranet.auth_token);
                    }
            
                    if (typeof data !== 'undefined') {
                        data = JSON.stringify(data);
                    }
            
                    switch (method) {
                        case 'get':
                            response = request.get(url, data);
                            break;
            
                        case 'post':
                            response = request.post(url, data);
                            break;
            
                        default:
                            throw 'Unsupported HTTP request method: ' + method;
                    }
            
                    Zabbix.log(4, '[ Aranet scraper ] Received response with status code ' + request.getStatus() + ': ' + response);
            
                    if (request.getStatus() < 200 || request.getStatus() >= 300) {
                        var message = 'Request failed with status code ' + request.getStatus();
            
                        message += ': ' + response;
                        throw message;
                    }
            
                    if (response !== null) {
                        try {
                            response = JSON.parse(response);
                        }
                        catch (error) {
                            throw 'Failed to parse response received from Aranet Cloud. Check debug log for more information.';
                        }
                    }
            
                    return {
                        status: request.getStatus(),
                        response: response
                    };
                },
            
                login: function () {
                    var result,
                        data = {
                            login: Aranet.params.username,
                            passw: Aranet.params.password
                        };
            
                    result = Aranet.request('post', 'user/login', data);
                    if (typeof result.response !== 'object'
                            || typeof result.response.auth === 'undefined'
                            || result.status != 200) {
                        throw 'Cannot login to Aranet Cloud. Check debug log for more information.';
                    }
            
                    Aranet.auth_token = result.response.auth;
                    Aranet.refresh_token = result.response.refresh;
            
                    var spaces = result.response.spaces;
                    for (var key in spaces) {
                        if (spaces[key] == Aranet.params.space_name) {
                            Aranet.space_id = key;
                            break;
                        }
                    }
            
                    return result.response;
                },
            
                logout: function () {
                    var result,
                        data = {
                            refresh: Aranet.refresh_token
                        };
            
                    try {
                        result = Aranet.request('post', 'user/logout', data);
                        if (result.status != 204) {
                            throw 'Cannot logout from Aranet Cloud ' + request.getStatus() + ': ' + result.response;
                        }
                    }
                    catch (error) {
                        Zabbix.log(4, '[ Aranet scraper ] ' + error)
                    }
                },
            
                getMetrics: function () {
                    var result = Aranet.request('get', 'metrics/' + Aranet.space_id);
            
                    if (typeof result.response !== 'object'
                            || typeof result.response.data === 'undefined'
                            || result.status != 200) {
                        throw 'Cannot get metrics data from Aranet Cloud. Check debug log for more information.';
                    };
            
                    return result.response;
                },
            
                getSensors: function () {
                    var result = Aranet.request('get', 'sensors/' + Aranet.space_id + '?fields=devices,metrics,telemetry,name');
            
                    if (typeof result.response !== 'object'
                            || typeof result.response.data === 'undefined'
                            || result.status != 200) {
                        throw 'Cannot get sensors data from Aranet Cloud. Check debug log for more information.';
                    };
            
                    return result.response;
                },
            
                getGateways: function () {
                    var result = Aranet.request('get', 'gateways/' + Aranet.space_id);
            
                    if (typeof result.response !== 'object'
                        || typeof result.response.devices === 'undefined'
                        || result.status != 200) {
                        throw 'Cannot get gateways data from Aranet Cloud. Check debug log for more information.';
                    };
            
                    return result.response;
                }
            }
            
            var processed_metrics = {},
                processed_sensors = [];
            
            try {
                Aranet.setParams(JSON.parse(value));
            
                Aranet.login();
            
                var raw_metrics = Aranet.getMetrics(),
                    raw_sensors = Aranet.getSensors(),
                    raw_gateways = Aranet.getGateways();
            
                Aranet.logout();
            
                var items = raw_metrics.data.items;
                for (item_idx in items) {
                    var unit_name,
                        units = items[item_idx].units;
            
                    units.some(function (unit) {
                        unit_name = unit.name;
                        if (unit.selected) {
                            return true;
                        }
                    });
            
                    processed_metrics[items[item_idx].id] = {
                        name: items[item_idx].name,
                        unit: unit_name
                    }
            
                    delete items[item_idx];
                }
            
                var items = raw_sensors.data.items;
                for (item_idx in items) {
                    var upd_ts = 0,
                        gateway = {},
                        sensor_metrics = [],
                        metrics = items[item_idx].metrics,
                        telemetry = items[item_idx].telemetry;
            
                    for (m_idx in metrics) {
                        var unit = processed_metrics[metrics[m_idx].id];
            
                        if (upd_ts < metrics[m_idx].t) {
                            upd_ts = metrics[m_idx].t;
                        }
            
                        sensor_metrics.push({
                            name: unit.name,
                            unit: unit.unit,
                            value: metrics[m_idx].v
                        });
                    }
            
                    for (var t_idx in telemetry) {
                        var unit = processed_metrics[telemetry[t_idx].id];
            
                        if (upd_ts < telemetry[t_idx].t) {
                            upd_ts = telemetry[t_idx].t;
                        }
            
                        sensor_metrics.push({
                            name: unit.name,
                            unit: unit.unit,
                            value: telemetry[t_idx].v
                        });
                    }
            
                    raw_gateways.devices.some(function (dev) {
                        if (items[item_idx].devices[0].id === dev.id) {
                            gateway = {
                                id: dev.id,
                                name: dev.device
                            }
                            return true;
                        }
                    })
            
                    if (upd_ts) {
                        sensor_metrics.push({
                            name: 'Last update',
                            unit: 's',
                            value: upd_ts
                        });
                    }
            
                    var sensor_id = parseInt(items[item_idx].id).toString(16).slice(-5);
            
                    processed_sensors.push({
                        id: sensor_id,
                        name: items[item_idx].name.trim() === '' ? sensor_id : items[item_idx].name,
                        gateway: gateway,
                        metrics: sensor_metrics
                    });
            
                    delete items[item_idx];
                }
            
                return JSON.stringify(processed_sensors);
            }
            catch (error) {
                Zabbix.log(3, '[ Aranet scraper ] ERROR: ' + error);
                throw 'Scraping failed: ' + error;
            }
          applications:
            -
              name: 'Zabbix raw items'
          timeout: 10s
          parameters:
            -
              name: api_endpoint
              value: '{$ARANET.API.ENDPOINT}'
            -
              name: password
              value: '{$ARANET.API.PASSWORD}'
            -
              name: space_name
              value: '{$ARANET.API.SPACE_NAME}'
            -
              name: username
              value: '{$ARANET.API.USERNAME}'
        -
          name: 'Aranet: Sensors discovery'
          type: DEPENDENT
          key: aranet.sensor.discovery
          delay: '0'
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Discovery for Aranet Cloud sensors'
          applications:
            -
              name: 'Zabbix raw items'
          preprocessing:
            -
              type: JAVASCRIPT
              parameters:
                - |
                  var input = JSON.parse(value),
                      output = [];
                  
                  input.forEach(function (sensor) {
                      sensor.metrics.forEach(function (metric) {
                          output.push(
                              {
                                  '{#SENSOR_ID}': sensor.id,
                                  '{#SENSOR_NAME}': sensor.name,
                                  '{#GATEWAY_ID}': sensor.gateway.id,
                                  '{#GATEWAY_NAME}': sensor.gateway.name,
                                  '{#METRIC}': metric.name,
                                  '{#UNIT}': metric.unit
                              }
                          );
                      })
                  });
                  
                  return JSON.stringify(output);
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 15m
          master_item:
            key: aranet.get_data
      discovery_rules:
        -
          name: 'Battery voltage discovery'
          type: DEPENDENT
          key: aranet.battery.voltage.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: 'Battery voltage'
                formulaid: D
          description: 'Discovery for Aranet Cloud Battery voltage sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.battery.voltage["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
              trigger_prototypes:
                -
                  expression: '{max(5m)} < {$ARANET.BATT.VOLTAGE.MIN.CRIT:"{#SENSOR_NAME}"}'
                  name: '{#METRIC}: Critically low battery voltage on "[{#GATEWAY_NAME}] {#SENSOR_NAME}" (below {$ARANET.BATT.VOLTAGE.MIN.CRIT:"{#SENSOR_NAME}"}{#UNIT} for 5m)'
                  priority: HIGH
                -
                  expression: '{max(5m)} < {$ARANET.BATT.VOLTAGE.MIN.WARN:"{#SENSOR_NAME}"}'
                  name: '{#METRIC}: Low battery voltage on "[{#GATEWAY_NAME}] {#SENSOR_NAME}" (below {$ARANET.BATT.VOLTAGE.MIN.WARN:"{#SENSOR_NAME}"}{#UNIT} for 5m)'
                  priority: WARNING
                  dependencies:
                    -
                      name: '{#METRIC}: Critically low battery voltage on "[{#GATEWAY_NAME}] {#SENSOR_NAME}" (below {$ARANET.BATT.VOLTAGE.MIN.CRIT:"{#SENSOR_NAME}"}{#UNIT} for 5m)'
                      expression: '{Aranet Cloud:aranet.battery.voltage["{#GATEWAY_ID}", "{#SENSOR_ID}"].max(5m)} < {$ARANET.BATT.VOLTAGE.MIN.CRIT:"{#SENSOR_NAME}"}'
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'CO2 discovery'
          type: DEPENDENT
          key: aranet.co2.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: COâ‚‚
                formulaid: D
          description: 'Discovery for Aranet Cloud CO2 sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.co2["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
              trigger_prototypes:
                -
                  expression: '{min(5m)} > {$ARANET.CO2.MAX.CRIT:"{#SENSOR_NAME}"}'
                  name: '{#METRIC}: Critically high CO2 level on "[{#GATEWAY_NAME}] {#SENSOR_NAME}" (over {$ARANET.CO2.MAX.CRIT:"{#SENSOR_NAME}"}{#UNIT} for 5m)'
                  priority: HIGH
                -
                  expression: '{min(5m)} > {$ARANET.CO2.MAX.WARN:"{#SENSOR_NAME}"}'
                  name: '{#METRIC}: High CO2 level on "[{#GATEWAY_NAME}] {#SENSOR_NAME}" (over {$ARANET.CO2.MAX.WARN:"{#SENSOR_NAME}"}{#UNIT} for 5m)'
                  priority: WARNING
                  dependencies:
                    -
                      name: '{#METRIC}: Critically high CO2 level on "[{#GATEWAY_NAME}] {#SENSOR_NAME}" (over {$ARANET.CO2.MAX.CRIT:"{#SENSOR_NAME}"}{#UNIT} for 5m)'
                      expression: '{Aranet Cloud:aranet.co2["{#GATEWAY_ID}", "{#SENSOR_ID}"].min(5m)} > {$ARANET.CO2.MAX.CRIT:"{#SENSOR_NAME}"}'
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Current discovery'
          type: DEPENDENT
          key: aranet.current.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: Current
                formulaid: D
          description: 'Discovery for Aranet Cloud Current sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.current["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Differential Pressure discovery'
          type: DEPENDENT
          key: aranet.diff_pressure.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: 'Differential Pressure'
                formulaid: D
          description: 'Discovery for Aranet Cloud Differential Pressure sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.diff_pressure["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Distance discovery'
          type: DEPENDENT
          key: aranet.distance.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: Distance
                formulaid: D
          description: 'Discovery for Aranet Cloud Distance sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.distance["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Humidity discovery'
          type: DEPENDENT
          key: aranet.humidity.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: Humidity
                formulaid: D
          description: 'Discovery for Aranet Cloud humidity sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.humidity["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
              trigger_prototypes:
                -
                  expression: '{min(5m)} > {$ARANET.HUMIDITY.MAX.WARN:"{#SENSOR_NAME}"}'
                  name: '{#METRIC}: High humidity on "[{#GATEWAY_NAME}] {#SENSOR_NAME}" (over {$ARANET.HUMIDITY.MAX.WARN:"{#SENSOR_NAME}"}{#UNIT} for 5m)'
                  priority: HIGH
                -
                  expression: '{max(5m)} < {$ARANET.HUMIDITY.MIN.WARN:"{#SENSOR_NAME}"}'
                  name: '{#METRIC}: Low humidity on "[{#GATEWAY_NAME}] {#SENSOR_NAME}" (below {$ARANET.HUMIDITY.MIN.WARN:"{#SENSOR_NAME}"}{#UNIT} for 5m)'
                  priority: WARNING
                  dependencies:
                    -
                      name: '{#METRIC}: High humidity on "[{#GATEWAY_NAME}] {#SENSOR_NAME}" (over {$ARANET.HUMIDITY.MAX.WARN:"{#SENSOR_NAME}"}{#UNIT} for 5m)'
                      expression: '{Aranet Cloud:aranet.humidity["{#GATEWAY_ID}", "{#SENSOR_ID}"].min(5m)} > {$ARANET.HUMIDITY.MAX.WARN:"{#SENSOR_NAME}"}'
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Illuminance discovery'
          type: DEPENDENT
          key: aranet.illuminance.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: Illuminance
                formulaid: D
          description: 'Discovery for Aranet Cloud Illuminance sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.illuminance["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Last update discovery'
          type: DEPENDENT
          key: aranet.last_update.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: 'Last update'
                formulaid: D
          description: 'Discovery for Aranet Cloud Last update metric'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.last_update["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
                -
                  type: JAVASCRIPT
                  parameters:
                    - 'return Math.floor(Date.now()/1000 - Number(value));'
              master_item:
                key: aranet.get_data
              trigger_prototypes:
                -
                  expression: '{last()} > {$ARANET.LAST_UPDATE.MAX.WARN:"{#SENSOR_NAME}"}'
                  name: '{#METRIC}: Sensor data "[{#GATEWAY_NAME}] {#SENSOR_NAME}" is not updated (more than {$ARANET.LAST_UPDATE.MAX.WARN:"{#SENSOR_NAME}"})'
                  priority: WARNING
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'pH discovery'
          type: DEPENDENT
          key: aranet.ph.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: pH
                formulaid: D
          description: 'Discovery for Aranet Cloud pH sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.ph["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Pore Electrical Conductivity discovery'
          type: DEPENDENT
          key: aranet.pore_electric_cond.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: 'Pore Electrical Conductivity'
                formulaid: D
          description: 'Discovery for Aranet Cloud Pore Electrical Conductivity sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.pore_electric_cond["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'PPFD discovery'
          type: DEPENDENT
          key: aranet.ppfd.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: PPFD
                formulaid: D
          description: 'Discovery for Aranet Cloud PPFD sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.ppfd["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Atmospheric pressure discovery'
          type: DEPENDENT
          key: aranet.pressure.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: 'Atmospheric Pressure'
                formulaid: D
          description: 'Discovery for Aranet Cloud atmospheric pressure sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.pressure["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Pulses discovery'
          type: DEPENDENT
          key: aranet.pulses.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: Pulses
                formulaid: D
          description: 'Discovery for Aranet Cloud Pulses sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.pulses["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Pulses Cumulative discovery'
          type: DEPENDENT
          key: aranet.pulses_cumulative.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: 'Pulses Cumulative'
                formulaid: D
          description: 'Discovery for Aranet Cloud Pulses Cumulative sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.pulses_cumulative["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'RSSI discovery'
          type: DEPENDENT
          key: aranet.rssi.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: RSSI
                formulaid: D
          description: 'Discovery for Aranet Cloud RSSI sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.rssi["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Soil Dielectric Permittivity discovery'
          type: DEPENDENT
          key: aranet.soil_dielectric_perm.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: 'Soil Dielectric Permittivity'
                formulaid: D
          description: 'Discovery for Aranet Cloud Soil Dielectric Permittivity sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.soil_dielectric_perm["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Soil Electrical Conductivity discovery'
          type: DEPENDENT
          key: aranet.soil_electric_cond.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: 'Soil Electrical Conductivity'
                formulaid: D
          description: 'Discovery for Aranet Cloud Soil Electrical Conductivity sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.soil_electric_cond["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Temperature discovery'
          type: DEPENDENT
          key: aranet.temp.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: Temperature
                formulaid: D
          description: 'Discovery for Aranet Cloud temperature sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.temp["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Voltage discovery'
          type: DEPENDENT
          key: aranet.voltage.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: Voltage
                formulaid: D
          description: 'Discovery for Aranet Cloud Voltage sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.voltage["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Volumetric Water Content discovery'
          type: DEPENDENT
          key: aranet.volum_water_content.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: 'Volumetric Water Content'
                formulaid: D
          description: 'Discovery for Aranet Cloud Volumetric Water Content sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.volumetric.water.content["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
        -
          name: 'Weight discovery'
          type: DEPENDENT
          key: aranet.weight.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
                formulaid: F
              -
                macro: '{#SENSOR_NAME}'
                value: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: G
              -
                macro: '{#SENSOR_ID}'
                value: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
                formulaid: E
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
                formulaid: B
              -
                macro: '{#GATEWAY_NAME}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: C
              -
                macro: '{#GATEWAY_ID}'
                value: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
                formulaid: A
              -
                macro: '{#METRIC}'
                value: Weight
                formulaid: D
          description: 'Discovery for Aranet Cloud Weight sensors'
          item_prototypes:
            -
              name: '{#METRIC}: [{#GATEWAY_NAME}] {#SENSOR_NAME}'
              type: DEPENDENT
              key: 'aranet.weight["{#GATEWAY_ID}", "{#SENSOR_ID}"]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              units: '{#UNIT}'
              application_prototypes:
                -
                  name: '{#METRIC}'
              preprocessing:
                -
                  type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#SENSOR_ID}" && @.name == "{#SENSOR_NAME}")].metrics[?(@.name == "{#METRIC}")].value.first()'
              master_item:
                key: aranet.get_data
          master_item:
            key: aranet.sensor.discovery
      macros:
        -
          macro: '{$ARANET.API.ENDPOINT}'
          value: 'https://aranet.cloud/api'
        -
          macro: '{$ARANET.API.PASSWORD}'
          value: '<PUT YOUR PASSWORD>'
        -
          macro: '{$ARANET.API.SPACE_NAME}'
          value: '<PUT YOUR SPACE NAME>'
        -
          macro: '{$ARANET.API.USERNAME}'
          value: '<PUT YOUR USERNAME>'
        -
          macro: '{$ARANET.BATT.VOLTAGE.MIN.CRIT}'
          value: '2'
        -
          macro: '{$ARANET.BATT.VOLTAGE.MIN.WARN}'
          value: '1'
        -
          macro: '{$ARANET.CO2.MAX.CRIT}'
          value: '1000'
        -
          macro: '{$ARANET.CO2.MAX.WARN}'
          value: '600'
        -
          macro: '{$ARANET.HUMIDITY.MAX.WARN}'
          value: '70'
        -
          macro: '{$ARANET.HUMIDITY.MIN.WARN}'
          value: '20'
        -
          macro: '{$ARANET.LAST_UPDATE.MAX.WARN}'
          value: 1h
        -
          macro: '{$ARANET.LLD.FILTER.GATEWAY_ID.MATCHES}'
          value: .+
          description: 'Filter of discoverable sensors by gateway id'
        -
          macro: '{$ARANET.LLD.FILTER.GATEWAY_NAME.MATCHES}'
          value: .+
          description: 'Filter of discoverable sensors by gateway name'
        -
          macro: '{$ARANET.LLD.FILTER.GATEWAY_NAME.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Filter to exclude discoverable sensors by gateway name'
        -
          macro: '{$ARANET.LLD.FILTER.SENSOR_ID.MATCHES}'
          value: .+
          description: 'Filter of discoverable sensors by id'
        -
          macro: '{$ARANET.LLD.FILTER.SENSOR_NAME.MATCHES}'
          value: .+
          description: 'Filter of discoverable sensors by name'
        -
          macro: '{$ARANET.LLD.FILTER.SENSOR_NAME.NOT_MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Filter to exclude discoverable sensors by name'
