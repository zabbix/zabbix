zabbix_export:
  version: '6.0'
  date: '2023-06-26T13:27:55Z'
  groups:
    - uuid: c2c162144c2d4c5491c8801193af4945
      name: Templates/Cloud
  templates:
    - uuid: ff637e001b91472d8730eb7f10e65800
      template: 'OpenStack Nova by HTTP'
      name: 'OpenStack Nova by HTTP'
      description: |
        OpenStack template documentation.
        
        You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback
        
        Generated by official Zabbix template tool "Templator" 2.0.0
      groups:
        - name: Templates/Cloud
      items:
        - uuid: 87d263a6f797439c8c7699d96f4305fb
          name: 'Nova: Get availability zones'
          type: HTTP_AGENT
          key: openstack.nova.availability_zone.get
          delay: '{$INTERVAL.AVAILABILITY_ZONE}'
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Gets a list of availability zones and it''s data.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.availabilityZoneInfo
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Could not get availability zones list'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          url: '{$SERVICE.URL}/os-availability-zone/detail'
          headers:
            - name: X-Auth-Token
              value: '{$TOKEN}'
          tags:
            - tag: component
              value: raw
        - uuid: c4297b412ad54bae85a1219e2d988bcb
          name: 'Nova: Get hypervisors'
          type: HTTP_AGENT
          key: openstack.nova.hypervisors.get
          delay: '{$INTERVAL.HYPERVISOR}'
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Gets a list of hypervisors and it''s data.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.hypervisors
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Could not get hypervisors list'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          url: '{$SERVICE.URL}/os-hypervisors/detail'
          headers:
            - name: X-Auth-Token
              value: '{$TOKEN}'
          tags:
            - tag: component
              value: raw
        - uuid: 02698d2fcd2949868013dedb311b8db3
          name: 'Nova: Get absolute limits'
          type: HTTP_AGENT
          key: openstack.nova.limits.get
          delay: '{$INTERVAL.LIMITS}'
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Gets absolute limits for the project.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.limits.absolute
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Could not get absolute project limits'
          url: '{$SERVICE.URL}/limits'
          headers:
            - name: X-Auth-Token
              value: '{$TOKEN}'
          tags:
            - tag: component
              value: raw
        - uuid: bea005220b704f1fb6ca523647ae24ce
          name: 'Nova: Instances count, current'
          type: DEPENDENT
          key: openstack.nova.limits.instances.current
          delay: '0'
          history: 7d
          description: 'Gets the current instances count.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.totalInstancesUsed
          master_item:
            key: openstack.nova.limits.get
          tags:
            - tag: component
              value: environment
        - uuid: 29898c0cb13d4ccebc3da95c082da29b
          name: 'Nova: Instances count, free'
          type: CALCULATED
          key: openstack.nova.limits.instances.free
          delay: '{$INTERVAL.LIMITS}'
          history: 7d
          params: last(//openstack.nova.limits.instances.max)-last(//openstack.nova.limits.instances.current)
          description: 'Gets the free instances count.'
          tags:
            - tag: component
              value: environment
        - uuid: 7526be4743564c32a293f96daf7cb242
          name: 'Nova: Instances count, max'
          type: DEPENDENT
          key: openstack.nova.limits.instances.max
          delay: '0'
          history: 7d
          description: 'Gets the maximum instance count.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.maxTotalInstances
          master_item:
            key: openstack.nova.limits.get
          tags:
            - tag: component
              value: environment
        - uuid: 64ae014b201945f299f80080dc63176d
          name: 'Nova: RAM usage, current'
          type: DEPENDENT
          key: openstack.nova.limits.ram.current
          delay: '0'
          history: 7d
          units: bytes
          description: 'Gets the current instances count.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.totalRAMUsed
            - type: MULTIPLIER
              parameters:
                - '1000000'
          master_item:
            key: openstack.nova.limits.get
          tags:
            - tag: component
              value: environment
        - uuid: bdc1492bbb5c4bcd844eaa6f6e76c1ff
          name: 'Nova: RAM usage, free'
          type: CALCULATED
          key: openstack.nova.limits.ram.free
          delay: '{$INTERVAL.LIMITS}'
          history: 7d
          units: bytes
          params: last(//openstack.nova.limits.ram.max)-last(//openstack.nova.limits.ram.current)
          description: 'Gets the free RAM.'
          tags:
            - tag: component
              value: environment
        - uuid: 50f2128cace04cf5a783e438de813e72
          name: 'Nova: RAM usage, max'
          type: DEPENDENT
          key: openstack.nova.limits.ram.max
          delay: '0'
          history: 7d
          units: bytes
          description: 'Gets the maximum instance count.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.maxTotalRAMSize
            - type: MULTIPLIER
              parameters:
                - '1000000'
          master_item:
            key: openstack.nova.limits.get
          tags:
            - tag: component
              value: environment
        - uuid: 678f2c0017f54d8b827876005f6ca670
          name: 'Nova: vCPUs usage, current'
          type: DEPENDENT
          key: openstack.nova.limits.vcpu.current
          delay: '0'
          history: 7d
          description: 'Gets the current vCPUs count.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.totalCoresUsed
          master_item:
            key: openstack.nova.limits.get
          tags:
            - tag: component
              value: environment
        - uuid: 97d3b897722d4910aea8e4c3c5f6c9a9
          name: 'Nova: vCPUs usage, free'
          type: CALCULATED
          key: openstack.nova.limits.vcpu.free
          delay: '{$INTERVAL.LIMITS}'
          history: 7d
          params: last(//openstack.nova.limits.vcpu.max)-last(//openstack.nova.limits.vcpu.current)
          description: 'Gets the free vCPUs count.'
          tags:
            - tag: component
              value: environment
        - uuid: e0583793b29b4bb195198d196cc1f0cc
          name: 'Nova: vCPUs usage, max'
          type: DEPENDENT
          key: openstack.nova.limits.vcpu.max
          delay: '0'
          history: 7d
          description: 'Gets the maximum vCPUs count.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.maxTotalCores
          master_item:
            key: openstack.nova.limits.get
          tags:
            - tag: component
              value: environment
        - uuid: 85d746d8b6cf404f95eeb7903c2e66e0
          name: 'Nova: Get servers'
          type: HTTP_AGENT
          key: openstack.nova.servers.get
          delay: '{$INTERVAL.SERVERS}'
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Gets a list of servers.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.servers
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Could not get servers list'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          url: '{$SERVICE.URL}/servers'
          headers:
            - name: X-Auth-Token
              value: '{$TOKEN}'
          tags:
            - tag: component
              value: raw
        - uuid: 3db93b6116ad416eb10da851cce385a1
          name: 'Nova: Get compute services'
          type: HTTP_AGENT
          key: openstack.nova.services.get
          delay: '{$INTERVAL.SERVICES}'
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Gets a list of compute services and it''s data.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.services
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Could not get compute services list'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          url: '{$SERVICE.URL}/os-services'
          headers:
            - name: X-Auth-Token
              value: '{$TOKEN}'
          tags:
            - tag: component
              value: raw
        - uuid: c258e567922c4f71a4dee9c0d6b88b1e
          name: 'Nova: Get tenants'
          type: HTTP_AGENT
          key: openstack.nova.tenant.get
          delay: '{$INTERVAL.TENANTS}'
          history: '0'
          trends: '0'
          value_type: TEXT
          description: 'Gets a list of tenants and it''s data.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.tenant_usages
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Could not get tenant list'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          url: '{$SERVICE.URL}/os-simple-tenant-usage'
          headers:
            - name: X-Auth-Token
              value: '{$TOKEN}'
          tags:
            - tag: component
              value: raw
      discovery_rules:
        - uuid: 55f919d49a364921a0e63e51dcabe9e2
          name: 'Nova: Availability zones discovery'
          type: DEPENDENT
          key: openstack.nova.availability_zone.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#ZONE_NAME}'
                value: '{$HYPERVISOR.DISCOVERY.HOSTNAME.MATCHES}'
                formulaid: A
              - macro: '{#ZONE_NAME}'
                value: '{$HYPERVISOR.DISCOVERY.HOSTNAME.NOT.MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          lifetime: 7d
          description: 'Discovers OpenStack Nova availability zones.'
          item_prototypes:
            - uuid: 988be318a8d345e4ba1d339e7e877a2c
              name: 'Availability zone [{#ZONE_NAME}]: Raw data'
              type: DEPENDENT
              key: 'openstack.nova.availability_zone.raw[{#ZONE_NAME}]'
              delay: '0'
              history: '0'
              trends: '0'
              value_type: TEXT
              description: 'Gets raw data of an availability zone.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.zoneName == "{#ZONE_NAME}")].first()'
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed availability zone report'
              master_item:
                key: openstack.nova.availability_zone.get
              tags:
                - tag: component
                  value: raw
            - uuid: 2d99e000412244b998417c19399a8ff9
              name: 'Availability zone [{#ZONE_NAME}]: State'
              type: DEPENDENT
              key: 'openstack.nova.availability_zone.state[{#ZONE_NAME}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Gets state of an availability zone.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.zoneState.available
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed availability zone report'
                - type: BOOL_TO_DECIMAL
                  parameters:
                    - ''
              master_item:
                key: 'openstack.nova.availability_zone.raw[{#ZONE_NAME}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: zone
              trigger_prototypes:
                - uuid: 0b4865c81de741b8a96574eeb450cf40
                  expression: 'last(/OpenStack Nova by HTTP/openstack.nova.availability_zone.state[{#ZONE_NAME}])=0'
                  name: 'Availability zone [{#ZONE_NAME}]: Zone is unavailable'
                  opdata: 'Current zone state: {ITEM.LASTVALUE}'
                  priority: WARNING
                  description: 'Availability zone is unavailable. Acknowledge to close the problem manually.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
          master_item:
            key: openstack.nova.availability_zone.get
          lld_macro_paths:
            - lld_macro: '{#ZONE_NAME}'
              path: $.zoneName
        - uuid: 84b17b240632413fbc3cd5b261cc2fd6
          name: 'Nova: Hypervisor discovery'
          type: DEPENDENT
          key: openstack.nova.hypervisors.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#HOSTNAME}'
                value: '{$HYPERVISOR.DISCOVERY.HOSTNAME.MATCHES}'
                formulaid: A
              - macro: '{#HOSTNAME}'
                value: '{$HYPERVISOR.DISCOVERY.HOSTNAME.NOT.MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
              - macro: '{#TYPE}'
                value: '{$HYPERVISOR.DISCOVERY.TYPE.MATCHES}'
                formulaid: E
              - macro: '{#TYPE}'
                value: '{$HYPERVISOR.DISCOVERY.TYPE.NOT.MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: F
              - macro: '{#HOST_IP}'
                value: '{$HYPERVISOR.DISCOVERY.IP.MATCHES}'
                formulaid: C
              - macro: '{#HOST_IP}'
                value: '{$HYPERVISOR.DISCOVERY.IP.NOT.MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
          lifetime: 7d
          description: 'Discovers OpenStack Nova hypervisors.'
          item_prototypes:
            - uuid: 3edd8fcf7d3643119b7b21111155fcc0
              name: 'Hypervisor [{#ID}]:[{#HOSTNAME}]: Raw data'
              type: DEPENDENT
              key: 'openstack.nova.hypervisors.raw[{#ID}]'
              delay: '0'
              history: '0'
              trends: '0'
              value_type: TEXT
              description: 'Gets raw data of a hypervisor.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#ID}")].first()'
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed hypervisor report'
              master_item:
                key: openstack.nova.hypervisors.get
              tags:
                - tag: component
                  value: raw
            - uuid: ef893a8517414964ade5d40064291f87
              name: 'Hypervisor [{#ID}]:[{#HOSTNAME}]: State'
              type: DEPENDENT
              key: 'openstack.nova.hypervisors.state[{#ID}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Gets state of a hypervisor.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.state
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed hypervisor report'
              master_item:
                key: 'openstack.nova.hypervisors.raw[{#ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: hypervisor
              trigger_prototypes:
                - uuid: 5fb5ed829d9747499c385d268bf229ea
                  expression: 'last(/OpenStack Nova by HTTP/openstack.nova.hypervisors.state[{#ID}])="down"'
                  name: 'Hypervisor [{#ID}]:[{#HOSTNAME}]: State is "down"'
                  opdata: 'Current state: {ITEM.LASTVALUE}'
                  priority: WARNING
                  description: 'State of the hypervisor is "down".'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
            - uuid: 26d06619594049c594998359a4659686
              name: 'Hypervisor [{#ID}]:[{#HOSTNAME}]: Status'
              type: DEPENDENT
              key: 'openstack.nova.hypervisors.status[{#ID}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Gets status of a hypervisor.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.status
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed hypervisor report'
              master_item:
                key: 'openstack.nova.hypervisors.raw[{#ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: hypervisor
              trigger_prototypes:
                - uuid: 5022a6a84f884a31be1ff440a3c14732
                  expression: 'last(/OpenStack Nova by HTTP/openstack.nova.hypervisors.status[{#ID}])="disabled"'
                  name: 'Hypervisor [{#ID}]:[{#HOSTNAME}]: Status is "disabled"'
                  opdata: 'Current status: {ITEM.LASTVALUE}'
                  priority: INFO
                  description: 'Status of the hypervisor is disabled. Acknowledge to close the problem manually.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
            - uuid: 5e9ced69d41d40ffabb04f9fd88b7730
              name: 'Hypervisor [{#ID}]:[{#HOSTNAME}]: Version'
              type: DEPENDENT
              key: 'openstack.nova.hypervisors.version[{#ID}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Gets version of a hypervisor.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.hypervisor_version
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed hypervisor report'
              master_item:
                key: 'openstack.nova.hypervisors.raw[{#ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: hypervisor
              trigger_prototypes:
                - uuid: 958ce612bb0a4b1ea67aba594dbd53b3
                  expression: 'last(/OpenStack Nova by HTTP/openstack.nova.hypervisors.version[{#ID}],#1)<>last(/OpenStack Nova by HTTP/openstack.nova.hypervisors.version[{#ID}],#2) and length(last(/OpenStack Nova by HTTP/openstack.nova.hypervisors.version[{#ID}]))>0'
                  name: 'Hypervisor [{#ID}]:[{#HOSTNAME}]: Version has changed'
                  opdata: 'Current version: {ITEM.LASTVALUE}'
                  priority: INFO
                  description: 'Status of the hypervisor is disabled. Acknowledge to close the problem manually.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: notice
          master_item:
            key: openstack.nova.hypervisors.get
          lld_macro_paths:
            - lld_macro: '{#HOSTNAME}'
              path: $.hypervisor_hostname
            - lld_macro: '{#HOST_IP}'
              path: $.host_ip
            - lld_macro: '{#ID}'
              path: $.id
            - lld_macro: '{#TYPE}'
              path: $.hypervisor_type
        - uuid: b38111e1499f414cbe662fada0d40b10
          name: 'Nova: Servers discovery'
          type: DEPENDENT
          key: openstack.nova.servers.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#SERVER_NAME}'
                value: '{$SERVER.DISCOVERY.SERVER.NAME.MATCHES}'
                formulaid: A
              - macro: '{#SERVER_NAME}'
                value: '{$SERVER.DISCOVERY.SERVER.NAME.NOT.MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          lifetime: 7d
          description: 'Discovers OpenStack Nova servers.'
          item_prototypes:
            - uuid: 84fd4be0c5f84744ac6bd93d4d4e8f0e
              name: 'Server [{#SERVER_ID}]:[{#SERVER_NAME}]: Raw data'
              type: HTTP_AGENT
              key: 'openstack.nova.servers.details.get[{#SERVER_ID}]'
              delay: '{$INTERVAL.SERVERS}'
              history: '0'
              trends: '0'
              value_type: TEXT
              description: 'Gets a detailed report of server.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.server
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed server report'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              url: '{$SERVICE.URL}/servers/{#SERVER_ID}'
              headers:
                - name: X-Auth-Token
                  value: '{$TOKEN}'
              tags:
                - tag: component
                  value: raw
            - uuid: 1bd84dc430854b75a2bc7ddda6c53353
              name: 'Server [{#SERVER_ID}]:[{#SERVER_NAME}]: Flavor'
              type: DEPENDENT
              key: 'openstack.nova.servers.flavor[{#SERVER_ID}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Gets flavor of the server.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.flavor.id
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not get server flavor from master item'
              master_item:
                key: 'openstack.nova.servers.details.get[{#SERVER_ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: server
            - uuid: 8c3b60d9902c40aebabd4b87657646c7
              name: 'Server [{#SERVER_ID}]:[{#SERVER_NAME}]: Status'
              type: DEPENDENT
              key: 'openstack.nova.servers.status[{#SERVER_ID}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Gets status of the server.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.status
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not get server status from master item'
              master_item:
                key: 'openstack.nova.servers.details.get[{#SERVER_ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: server
              trigger_prototypes:
                - uuid: 490262a25fb842c9a9b83a2e0be83654
                  expression: 'last(/OpenStack Nova by HTTP/openstack.nova.servers.status[{#SERVER_ID}],#1)<>last(/OpenStack Nova by HTTP/openstack.nova.servers.status[{#SERVER_ID}],#2) and length(last(/OpenStack Nova by HTTP/openstack.nova.servers.status[{#SERVER_ID}]))>0'
                  recovery_mode: NONE
                  name: 'Server [{#SERVER_ID}]:[{#SERVER_NAME}]: Status has changed'
                  opdata: 'Current status: {ITEM.LASTVALUE}'
                  priority: INFO
                  description: 'Status of the server has changed. Acknowledge to close the problem manually.'
                  manual_close: 'YES'
                  dependencies:
                    - name: 'Server [{#SERVER_ID}]:[{#SERVER_NAME}]: Status is "ERROR"'
                      expression: 'last(/OpenStack Nova by HTTP/openstack.nova.servers.status[{#SERVER_ID}])="ERROR"'
                  tags:
                    - tag: scope
                      value: availability
                - uuid: 7d2ca81f24154099b3857aeaadef114f
                  expression: 'last(/OpenStack Nova by HTTP/openstack.nova.servers.status[{#SERVER_ID}])="ERROR"'
                  name: 'Server [{#SERVER_ID}]:[{#SERVER_NAME}]: Status is "ERROR"'
                  opdata: 'Current status: {ITEM.LASTVALUE}'
                  priority: HIGH
                  description: 'Server is in "ERROR" status.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
          master_item:
            key: openstack.nova.servers.get
          lld_macro_paths:
            - lld_macro: '{#SERVER_ID}'
              path: $.id
            - lld_macro: '{#SERVER_NAME}'
              path: $.name
        - uuid: 4af40cd615d74e54a3759041470995fe
          name: 'Nova: Compute services discovery'
          type: DEPENDENT
          key: openstack.nova.services.discovery
          delay: '0'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#HOST}'
                value: '{$SERVICES.DISCOVERY.HOST.MATCHES}'
                formulaid: C
              - macro: '{#HOST}'
                value: '{$SERVICES.DISCOVERY.HOST.NOT.MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: D
              - macro: '{#BINARY}'
                value: '{$SERVICES.DISCOVERY.BINARY.MATCHES}'
                formulaid: A
              - macro: '{#BINARY}'
                value: '{$SERVICES.DISCOVERY.BINARY.NOT.MATCHES}'
                operator: NOT_MATCHES_REGEX
                formulaid: B
          lifetime: 7d
          description: 'Discovers OpenStack Compute services.'
          item_prototypes:
            - uuid: 3bd724dad043411187a86466cf8ee2c6
              name: 'Compute service [{#HOST}]:[{#BINARY}]: Disabled reason'
              type: DEPENDENT
              key: 'openstack.nova.services.disabled.reason[{#ID}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Gets disabled reason of a Compute service.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.disabled_reason
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed services report'
              master_item:
                key: 'openstack.nova.services.raw[{#ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: service
            - uuid: 60c5f4461ad84269983168b359a0ff87
              name: 'Compute service [{#HOST}]:[{#BINARY}]: Raw data'
              type: DEPENDENT
              key: 'openstack.nova.services.raw[{#ID}]'
              delay: '0'
              history: '0'
              trends: '0'
              value_type: TEXT
              description: 'Gets raw data of a single Compute service.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.id == "{#ID}")].first()'
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed services report'
              master_item:
                key: openstack.nova.services.get
              tags:
                - tag: component
                  value: raw
            - uuid: 8f123b2f902647b381b2c9a5af3bee80
              name: 'Compute service [{#HOST}]:[{#BINARY}]: State'
              type: DEPENDENT
              key: 'openstack.nova.services.state[{#ID}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Gets state of a Compute service.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.state
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed services report'
              master_item:
                key: 'openstack.nova.services.raw[{#ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: service
              trigger_prototypes:
                - uuid: 9479c68ee2db4104ac44f47931d96929
                  expression: 'last(/OpenStack Nova by HTTP/openstack.nova.services.state[{#ID}])="down"'
                  name: 'Compute service [{#HOST}]:[{#BINARY}]: State is "down"'
                  opdata: 'Current state: {ITEM.LASTVALUE}'
                  priority: WARNING
                  description: 'State of the service is "down".'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
            - uuid: 65288a6f75094c74bbb04651c87cb323
              name: 'Compute service [{#HOST}]:[{#BINARY}]: Status'
              type: DEPENDENT
              key: 'openstack.nova.services.status[{#ID}]'
              delay: '0'
              history: 7d
              trends: '0'
              value_type: TEXT
              description: 'Gets status of a Compute service.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.status
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed services report'
              master_item:
                key: 'openstack.nova.services.raw[{#ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: service
          trigger_prototypes:
            - uuid: 177fa631136c4340816ee9e2cf90f1ac
              expression: 'last(/OpenStack Nova by HTTP/openstack.nova.services.status[{#ID}])="disabled" and length(last(/OpenStack Nova by HTTP/openstack.nova.services.disabled.reason[{#ID}]))>0'
              name: 'Compute service [{#HOST}]:[{#BINARY}]: Status is "disabled"'
              opdata: 'Current state: {ITEM.LASTVALUE1}, Disabled reason: "{ITEM.VALUE2}"'
              priority: INFO
              description: 'Status of the server is disabled. Acknowledge to close the problem manually.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: availability
          master_item:
            key: openstack.nova.services.get
          lld_macro_paths:
            - lld_macro: '{#BINARY}'
              path: $.binary
            - lld_macro: '{#HOST}'
              path: $.host
            - lld_macro: '{#ID}'
              path: $.id
        - uuid: dba72b914e5c45fd9049ee5e4194bdcf
          name: 'Nova: Tenant discovery'
          type: DEPENDENT
          key: openstack.nova.tenant.discovery
          delay: '0'
          description: 'Usage statistics for all tenants.'
          item_prototypes:
            - uuid: 73e8e9b39da64358948407efd6aded6b
              name: 'Tenant [{#TENANT_ID}]: Total disk usage'
              type: DEPENDENT
              key: 'openstack.nova.tenant.disk_usage[{#TENANT_ID}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'Multiplying the server disk size (in GiB) by hours the server exists, and then adding that all together for each server.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.total_local_gb_usage
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed tenant report'
              master_item:
                key: 'openstack.nova.tenant.raw[{#TENANT_ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: tenant
            - uuid: c96dd7741d344b7f95f571640712faa0
              name: 'Tenant [{#TENANT_ID}]: Raw data'
              type: DEPENDENT
              key: 'openstack.nova.tenant.raw[{#TENANT_ID}]'
              delay: '0'
              history: '0'
              trends: '0'
              value_type: TEXT
              description: 'Gets raw data of tenant.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$[?(@.tenant_id == "{#TENANT_ID}")].first()'
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the tenant report'
              master_item:
                key: openstack.nova.tenant.get
              tags:
                - tag: component
                  value: raw
            - uuid: 634ccd12a49e440fb72f622f3fa36034
              name: 'Tenant [{#TENANT_ID}]: Total hours'
              type: DEPENDENT
              key: 'openstack.nova.tenant.total_hours[{#TENANT_ID}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'The total duration that servers exist (in hours).'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.total_hours
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed tenant report'
              master_item:
                key: 'openstack.nova.tenant.raw[{#TENANT_ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: tenant
            - uuid: ce4fccd4d93a4621af8982d3e6b9dcbb
              name: 'Tenant [{#TENANT_ID}]: Total memory usage'
              type: DEPENDENT
              key: 'openstack.nova.tenant.total_memory_mb_usage[{#TENANT_ID}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'Multiplying the server memory size (in MiB) by hours the server exists, and then adding that all together for each server.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.total_memory_mb_usage
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed tenant report'
              master_item:
                key: 'openstack.nova.tenant.raw[{#TENANT_ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: tenant
            - uuid: eee30f1ee62c40839bcf623c8a0a6ae6
              name: 'Tenant [{#TENANT_ID}]: Total vCPUs usage'
              type: DEPENDENT
              key: 'openstack.nova.tenant.total_vcpu[{#TENANT_ID}]'
              delay: '0'
              history: 7d
              value_type: FLOAT
              description: 'Multiplying the number of virtual CPUs of the server by hours the server exists, and then adding that all together for each server.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.total_vcpus_usage
                  error_handler: CUSTOM_ERROR
                  error_handler_params: 'Could not parse the detailed tenant report'
              master_item:
                key: 'openstack.nova.tenant.raw[{#TENANT_ID}]'
              tags:
                - tag: component
                  value: application
                - tag: component
                  value: tenant
          graph_prototypes:
            - uuid: d456ccd13e38476bb43a948fd42fae1d
              name: 'Tenant [{#TENANT_ID}]: Total disk utilization'
              graph_items:
                - color: 199C0D
                  item:
                    host: 'OpenStack Nova by HTTP'
                    key: 'openstack.nova.tenant.disk_usage[{#TENANT_ID}]'
            - uuid: 97466fabfd21468584658ffe480d7e22
              name: 'Tenant [{#TENANT_ID}]: Total hours utilization'
              graph_items:
                - color: 199C0D
                  item:
                    host: 'OpenStack Nova by HTTP'
                    key: 'openstack.nova.tenant.total_hours[{#TENANT_ID}]'
            - uuid: a6b67816bd694539b0ebb77255ab479c
              name: 'Tenant [{#TENANT_ID}]: Total memory utilization'
              graph_items:
                - color: 199C0D
                  item:
                    host: 'OpenStack Nova by HTTP'
                    key: 'openstack.nova.tenant.total_memory_mb_usage[{#TENANT_ID}]'
            - uuid: b8b3899c252945138cc8e241f37d8d40
              name: 'Tenant [{#TENANT_ID}]: Total vCPUs utilization'
              graph_items:
                - color: 199C0D
                  item:
                    host: 'OpenStack Nova by HTTP'
                    key: 'openstack.nova.tenant.total_vcpu[{#TENANT_ID}]'
          master_item:
            key: openstack.nova.tenant.get
          lld_macro_paths:
            - lld_macro: '{#TENANT_ID}'
              path: $.tenant_id
      tags:
        - tag: class
          value: cloud
        - tag: target
          value: nova
        - tag: target
          value: openstack
      macros:
        - macro: '{$AVAILABILITY_ZONE.DISCOVERY.NAME.MATCHES}'
          value: '.*'
          description: 'Sets the zone name regex filter to use in availability zone discovery for including.'
        - macro: '{$AVAILABILITY_ZONE.DISCOVERY.NAME.NOT.MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Sets the zone name regex filter to use in availability zone discovery for excluding.'
        - macro: '{$HYPERVISOR.DISCOVERY.HOSTNAME.MATCHES}'
          value: '.*'
          description: 'Sets the hostname regex filter to use in hypervisor discovery for including.'
        - macro: '{$HYPERVISOR.DISCOVERY.HOSTNAME.NOT.MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Sets the hostname regex filter to use in hypervisor discovery for excluding.'
        - macro: '{$HYPERVISOR.DISCOVERY.IP.MATCHES}'
          value: '.*'
          description: 'Sets the host IP address regex filter to use in hypervisor discovery for including.'
        - macro: '{$HYPERVISOR.DISCOVERY.IP.NOT.MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Sets the host IP address regex filter to use in hypervisor discovery for excluding.'
        - macro: '{$HYPERVISOR.DISCOVERY.TYPE.MATCHES}'
          value: '.*'
          description: 'Sets the type regex filter to use in hypervisor discovery for including.'
        - macro: '{$HYPERVISOR.DISCOVERY.TYPE.NOT.MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Sets the type regex filter to use in hypervisor discovery for excluding.'
        - macro: '{$INTERVAL.AVAILABILITY_ZONE}'
          value: 3m
          description: 'Interval for availability zone HTTP agent item query.'
        - macro: '{$INTERVAL.HYPERVISOR}'
          value: 3m
          description: 'Interval for hypervisor HTTP agent item query.'
        - macro: '{$INTERVAL.LIMITS}'
          value: 3m
          description: 'Interval for absolute limit HTTP agent item query.'
        - macro: '{$INTERVAL.SERVERS}'
          value: 3m
          description: 'Interval for server HTTP agent item queries.'
        - macro: '{$INTERVAL.SERVICES}'
          value: 3m
          description: 'Interval for service HTTP agent item query.'
        - macro: '{$INTERVAL.TENANTS}'
          value: 3m
          description: 'Interval for tenant HTTP agent item query.'
        - macro: '{$PROJECT.CPU.TRIGGER.HIGH}'
          value: '90'
          description: 'Sets the percentage threshold for creating a high severity event about vCPU resource usage.'
        - macro: '{$PROJECT.CPU.TRIGGER.WARNING}'
          value: '75'
          description: 'Sets the percentage threshold for creating a warning severity event about vCPU resource usage.'
        - macro: '{$PROJECT.INSTANCES.TRIGGER.HIGH}'
          value: '90'
          description: 'Sets the percentage threshold for creating a high severity event about instances resource count.'
        - macro: '{$PROJECT.INSTANCES.TRIGGER.WARNING}'
          value: '75'
          description: 'Sets the percentage threshold for creating a warning severity event about instances resource count.'
        - macro: '{$PROJECT.RAM.TRIGGER.HIGH}'
          value: '90'
          description: 'Sets the percentage threshold for creating a high severity event about RAM resource usage.'
        - macro: '{$PROJECT.RAM.TRIGGER.WARNING}'
          value: '75'
          description: 'Sets the percentage threshold for creating a warning severity event about RAM resource usage.'
        - macro: '{$SERVER.DISCOVERY.SERVER.NAME.MATCHES}'
          value: '.*'
          description: 'Sets the server name regex filter to use in server discovery for including.'
        - macro: '{$SERVER.DISCOVERY.SERVER.NAME.NOT.MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Sets the server name regex filter to use in server discovery for excluding.'
        - macro: '{$SERVICE.URL}'
          description: 'API endpoint for Nova Service, e.g., https://local.openstack:8774/v2.1.'
        - macro: '{$SERVICES.DISCOVERY.BINARY.MATCHES}'
          value: '.*'
          description: 'Sets the binary name regex filter to use in Compute services discovery for including.'
        - macro: '{$SERVICES.DISCOVERY.BINARY.NOT.MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Sets the binary name regex filter to use in Compute services discovery for excluding.'
        - macro: '{$SERVICES.DISCOVERY.HOST.MATCHES}'
          value: '.*'
          description: 'Sets the host name regex filter to use in Compute services discovery for including.'
        - macro: '{$SERVICES.DISCOVERY.HOST.NOT.MATCHES}'
          value: CHANGE_IF_NEEDED
          description: 'Sets the host name regex filter to use in Compute services discovery for excluding.'
        - macro: '{$TOKEN}'
          type: SECRET_TEXT
          description: 'API token for the monitoring user.'
      dashboards:
        - uuid: 462016340f49447f80b5d2405f3a682a
          name: 'Nova: Limits overview'
          pages:
            - widgets:
                - type: GRAPH_CLASSIC
                  width: '12'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid
                      value:
                        host: 'OpenStack Nova by HTTP'
                        name: 'Nova: Instances utilization'
                - type: GRAPH_CLASSIC
                  x: '12'
                  width: '12'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid
                      value:
                        host: 'OpenStack Nova by HTTP'
                        name: 'Nova: vCPUs utilization'
                - type: GRAPH_CLASSIC
                  'y': '5'
                  width: '24'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid
                      value:
                        host: 'OpenStack Nova by HTTP'
                        name: 'Nova: RAM utilization'
  triggers:
    - uuid: 22592fabc09d416598fb4fb806048040
      expression: 'last(/OpenStack Nova by HTTP/openstack.nova.limits.instances.current) >= ({$PROJECT.INSTANCES.TRIGGER.HIGH} / 100 * last(/OpenStack Nova by HTTP/openstack.nova.limits.instances.max))'
      name: 'Nova: Current instances count exceeded {$PROJECT.INSTANCES.TRIGGER.HIGH}% of max available'
      opdata: 'Current: {ITEM.LASTVALUE1}, MAX: {ITEM.LASTVALUE2}'
      priority: HIGH
      description: 'Current instances count has exceeded {$PROJECT.INSTANCES.TRIGGER.HIGH}% of the max available instances count.'
      tags:
        - tag: scope
          value: capacity
    - uuid: 3dbae725014d4f289e20f002f2674dc7
      expression: 'last(/OpenStack Nova by HTTP/openstack.nova.limits.instances.current,#1) >= ({$PROJECT.INSTANCES.TRIGGER.WARNING} / 100 * last(/OpenStack Nova by HTTP/openstack.nova.limits.instances.max,#1))'
      name: 'Nova: Current instances count exceeded {$PROJECT.INSTANCES.TRIGGER.WARNING}% of max available'
      opdata: 'Current: {ITEM.LASTVALUE1}, MAX: {ITEM.LASTVALUE2}'
      priority: WARNING
      description: 'Current instances count has exceeded {$PROJECT.INSTANCES.TRIGGER.WARNING}% of the max available instances count.'
      dependencies:
        - name: 'Nova: Current instances count exceeded {$PROJECT.INSTANCES.TRIGGER.HIGH}% of max available'
          expression: 'last(/OpenStack Nova by HTTP/openstack.nova.limits.instances.current) >= ({$PROJECT.INSTANCES.TRIGGER.HIGH} / 100 * last(/OpenStack Nova by HTTP/openstack.nova.limits.instances.max))'
      tags:
        - tag: scope
          value: capacity
    - uuid: 9dfd643fb555419c9c3200a07cc7647e
      expression: 'last(/OpenStack Nova by HTTP/openstack.nova.limits.ram.current) >= ({$PROJECT.RAM.TRIGGER.HIGH} / 100 * last(/OpenStack Nova by HTTP/openstack.nova.limits.ram.max))'
      name: 'Nova: Current RAM usage exceeded {$PROJECT.RAM.TRIGGER.HIGH}% of max available'
      opdata: 'Current: {ITEM.LASTVALUE1}, MAX: {ITEM.LASTVALUE2}'
      priority: HIGH
      description: 'Current RAM usage has exceeded {$PROJECT.RAM.TRIGGER.HIGH}% of the max available RAM usage.'
      tags:
        - tag: scope
          value: capacity
    - uuid: c9d9eca4b3e540f491210b5c2312e1ba
      expression: 'last(/OpenStack Nova by HTTP/openstack.nova.limits.ram.current) >= ({$PROJECT.RAM.TRIGGER.WARNING} / 100 * last(/OpenStack Nova by HTTP/openstack.nova.limits.ram.max))'
      name: 'Nova: Current RAM usage exceeded {$PROJECT.RAM.TRIGGER.WARNING}% of max available'
      opdata: 'Current: {ITEM.LASTVALUE1}, MAX: {ITEM.LASTVALUE2}'
      priority: WARNING
      description: 'Current RAM usage has exceeded {$PROJECT.RAM.TRIGGER.WARNING}% of the max available RAM usage.'
      dependencies:
        - name: 'Nova: Current RAM usage exceeded {$PROJECT.RAM.TRIGGER.HIGH}% of max available'
          expression: 'last(/OpenStack Nova by HTTP/openstack.nova.limits.ram.current) >= ({$PROJECT.RAM.TRIGGER.HIGH} / 100 * last(/OpenStack Nova by HTTP/openstack.nova.limits.ram.max))'
      tags:
        - tag: scope
          value: capacity
    - uuid: e62a7fb598b34a0cb5bee6bc0370f7dd
      expression: 'last(/OpenStack Nova by HTTP/openstack.nova.limits.vcpu.current) >= ({$PROJECT.CPU.TRIGGER.HIGH} / 100 * last(/OpenStack Nova by HTTP/openstack.nova.limits.vcpu.max))'
      name: 'Nova: Current vCPU usage exceeded {$PROJECT.CPU.TRIGGER.HIGH}% of max available'
      opdata: 'Current: {ITEM.LASTVALUE1}, MAX: {ITEM.LASTVALUE2}'
      priority: HIGH
      description: 'Current vCPU usage has exceeded {$PROJECT.CPU.TRIGGER.HIGH}% of the max available vCPU usage.'
      tags:
        - tag: scope
          value: capacity
    - uuid: 85b1a132602344e39a50ef10b29fca15
      expression: 'last(/OpenStack Nova by HTTP/openstack.nova.limits.vcpu.current) >= ({$PROJECT.CPU.TRIGGER.WARNING} / 100 * last(/OpenStack Nova by HTTP/openstack.nova.limits.vcpu.max))'
      name: 'Nova: Current vCPU usage exceeded {$PROJECT.CPU.TRIGGER.WARNING}% of max available'
      opdata: 'Current: {ITEM.LASTVALUE1}, MAX: {ITEM.LASTVALUE2}'
      priority: WARNING
      description: 'Current vCPU usage has exceeded {$PROJECT.CPU.TRIGGER.WARNING}% of the max available vCPU usage.'
      dependencies:
        - name: 'Nova: Current vCPU usage exceeded {$PROJECT.CPU.TRIGGER.HIGH}% of max available'
          expression: 'last(/OpenStack Nova by HTTP/openstack.nova.limits.vcpu.current) >= ({$PROJECT.CPU.TRIGGER.HIGH} / 100 * last(/OpenStack Nova by HTTP/openstack.nova.limits.vcpu.max))'
      tags:
        - tag: scope
          value: capacity
  graphs:
    - uuid: 462db790ba6c451b8d2d4f4669ed11b5
      name: 'Nova: Instances utilization'
      graph_items:
        - color: 00FF00
          item:
            host: 'OpenStack Nova by HTTP'
            key: openstack.nova.limits.instances.current
        - sortorder: '1'
          drawtype: DASHED_LINE
          color: FF0000
          item:
            host: 'OpenStack Nova by HTTP'
            key: openstack.nova.limits.instances.max
    - uuid: d65df309a6ae47f48ebf245257750e58
      name: 'Nova: RAM utilization'
      graph_items:
        - color: 00FF00
          item:
            host: 'OpenStack Nova by HTTP'
            key: openstack.nova.limits.ram.current
        - sortorder: '1'
          drawtype: DASHED_LINE
          color: FF0000
          item:
            host: 'OpenStack Nova by HTTP'
            key: openstack.nova.limits.ram.max
    - uuid: 5c7434d968b64c118138e413758630c0
      name: 'Nova: vCPUs utilization'
      graph_items:
        - color: 00FF00
          item:
            host: 'OpenStack Nova by HTTP'
            key: openstack.nova.limits.vcpu.current
        - sortorder: '1'
          drawtype: DASHED_LINE
          color: FF0000
          item:
            host: 'OpenStack Nova by HTTP'
            key: openstack.nova.limits.vcpu.max
