zabbix_export:
  version: '8.0'
  template_groups:
    - uuid: 846977d1dfed4968bc5f8bdb363285bc
      name: 'Templates/Operating systems'
  templates:
    - uuid: a3dc630729e443139f4e608954fa6e19
      template: 'FreeBSD by Zabbix agent'
      name: 'FreeBSD by Zabbix agent'
      description: |
        This is an official FreeBSD template. It requires Zabbix agent 8.0 or newer.
        
        Notes on filesystem (FS) discovery:
          - The ext4/3/2 FS reserves space for privileged usage, typically set at 5% by default.
          - BTRFS allocates a default of 10% of the volume for its own needs.
          - To mitigate potential disasters, FS usage triggers are based on the maximum available space.
            - Utilization formula: 'pused = 100 - 100 * (available / total - free + available)'
          - The FS utilization chart, derived from graph prototypes, reflects FS reserved space as the difference between used and available space from the total volume.
        
        You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/
        
        Generated by official Zabbix template tool "Templator"
      wizard_ready: 'YES'
      readme: |
        ## Overview
        
        This is an official FreeBSD template. It requires Zabbix agent 8.0 or newer.
        
        #### Notes on filesystem (FS) discovery:
        - The ext4/3/2 FS reserves space for privileged usage, typically set at 5% by default.
        - BTRFS allocates a default of 10% of the volume for its own needs.
        - To mitigate potential disasters, FS usage triggers are based on the maximum available space.
          - Utilization formula: `pused = 100 - 100 * (available / total - free + available)`
        - The FS utilization chart, derived from graph prototypes, reflects FS reserved space as the difference between used and available space from the total volume.
        
        
        ## Setup
        
        Install Zabbix agent on FreeBSD according to Zabbix documentation.
      vendor:
        name: Zabbix
        version: 8.0-1
      groups:
        - name: 'Templates/Operating systems'
      items:
        - uuid: 74bc1a15ef314d5f9b26332531885c0d
          name: 'Host name of Zabbix agent running'
          key: agent.hostname
          delay: 1h
          value_type: CHAR
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: system
        - uuid: da59d099f7614653b37b8eaaa518ebd2
          name: 'Zabbix agent ping'
          key: agent.ping
          description: 'The agent always returns "1" for this item. May be used in combination with `nodata()` for the availability check.'
          valuemap:
            name: 'Zabbix agent ping status'
          tags:
            - tag: component
              value: system
        - uuid: e2b84269401e41acb973bc29666b9e7a
          name: 'Version of Zabbix agent running'
          key: agent.version
          delay: 1h
          value_type: CHAR
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: application
        - uuid: d1b2d3cc2b7e44af8f9bfee11e04bf21
          name: 'Maximum number of opened files'
          key: kernel.maxfiles
          delay: 1h
          description: 'May be increased by using the `sysctl` utility or modifying the file `/etc/sysctl.conf`.'
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: 00f035b7890d4227a84a942ba5730df3
              expression: 'last(/FreeBSD by Zabbix agent/kernel.maxfiles)<1024'
              name: 'FreeBSD: Configured max number of opened files is too low on {HOST.NAME}'
              priority: INFO
              tags:
                - tag: scope
                  value: notice
                - tag: scope
                  value: performance
        - uuid: 58244a8e72694ffcbba5a78a910ae818
          name: 'Maximum number of processes'
          key: kernel.maxproc
          delay: 1h
          description: 'May be increased by using the `sysctl` utility or modifying the file `/etc/sysctl.conf`.'
          tags:
            - tag: component
              value: os
            - tag: component
              value: processes
          triggers:
            - uuid: 0d2417112c1e4ef38a4b763872cbb18b
              expression: 'last(/FreeBSD by Zabbix agent/kernel.maxproc)<256'
              name: 'FreeBSD: Configured max number of processes is too low on {HOST.NAME}'
              priority: INFO
              tags:
                - tag: scope
                  value: notice
                - tag: scope
                  value: performance
        - uuid: 448c6de07b244281a4b1defe2e811773
          name: 'Number of running processes'
          key: 'proc.num[,,run]'
          description: 'Number of processes in a running state.'
          tags:
            - tag: component
              value: os
            - tag: component
              value: processes
          triggers:
            - uuid: 837fdc71174246d987a6f7f277d65f6c
              expression: 'avg(/FreeBSD by Zabbix agent/proc.num[,,run],5m)>30'
              name: 'FreeBSD: Too many processes running on {HOST.NAME}'
              priority: WARNING
              tags:
                - tag: scope
                  value: notice
                - tag: scope
                  value: performance
        - uuid: 5fd5b351d8214eac8f4f4649594c27eb
          name: 'Number of processes'
          key: 'proc.num[]'
          description: 'Total number of processes in any state.'
          tags:
            - tag: component
              value: os
            - tag: component
              value: processes
          triggers:
            - uuid: 0d5ac85120734fa98d3eef01b6f4033b
              expression: 'avg(/FreeBSD by Zabbix agent/proc.num[],5m)>300'
              name: 'FreeBSD: Too many processes on {HOST.NAME}'
              priority: WARNING
              tags:
                - tag: scope
                  value: notice
                - tag: scope
                  value: performance
        - uuid: 4a533b30c43e42fb8c9eabada0817186
          name: 'Host boot time'
          key: system.boottime
          delay: 10m
          units: unixtime
          tags:
            - tag: component
              value: os
        - uuid: db555e8318cf4e7aa7beb85aa0250697
          name: 'Interrupts per second'
          key: system.cpu.intr
          units: ips
          description: 'Number of interrupts processed.'
          preprocessing:
            - type: CHANGE_PER_SECOND
          tags:
            - tag: component
              value: cpu
        - uuid: 2336b2ec03a846f3bed1e64384b2532e
          name: 'Processor load (1 min average per core)'
          key: 'system.cpu.load[percpu,avg1]'
          value_type: FLOAT
          description: 'Calculated as the system CPU load divided by the number of CPU cores.'
          tags:
            - tag: component
              value: cpu
          triggers:
            - uuid: 8c339065ecc54b7d8c2e4405f2149f27
              expression: 'avg(/FreeBSD by Zabbix agent/system.cpu.load[percpu,avg1],5m)>5'
              name: 'FreeBSD: Processor load is too high on {HOST.NAME}'
              priority: WARNING
              tags:
                - tag: scope
                  value: availability
                - tag: scope
                  value: performance
        - uuid: de68f40fc96648c0925c1f6a4ca6776e
          name: 'Processor load (5 min average per core)'
          key: 'system.cpu.load[percpu,avg5]'
          value_type: FLOAT
          description: 'Calculated as the system CPU load divided by the number of CPU cores.'
          tags:
            - tag: component
              value: cpu
        - uuid: ad9ebf859f7346ca885c1edcb7333d78
          name: 'Processor load (15 min average per core)'
          key: 'system.cpu.load[percpu,avg15]'
          value_type: FLOAT
          description: 'Calculated as the system CPU load divided by the number of CPU cores.'
          tags:
            - tag: component
              value: cpu
        - uuid: 0a140185a5114dd29451bfac68abdde5
          name: 'Context switches per second'
          key: system.cpu.switches
          units: sps
          description: 'The combined rate at which all processors on the computer are switched from one thread to another.'
          preprocessing:
            - type: CHANGE_PER_SECOND
          tags:
            - tag: component
              value: cpu
        - uuid: 7612803821c845889bda84b7f1ac9ae5
          name: 'CPU idle time'
          key: 'system.cpu.util[,idle]'
          value_type: FLOAT
          units: '%'
          description: 'Time the CPU has spent doing nothing.'
          tags:
            - tag: component
              value: cpu
        - uuid: f2acc3cd432546e5a223095a0ea2f096
          name: 'CPU interrupt time'
          key: 'system.cpu.util[,interrupt]'
          value_type: FLOAT
          units: '%'
          description: 'Time the CPU has spent servicing hardware interrupts.'
          tags:
            - tag: component
              value: cpu
        - uuid: efa92492bec0437ba74f47d694500cab
          name: 'CPU nice time'
          key: 'system.cpu.util[,nice]'
          value_type: FLOAT
          units: '%'
          description: 'Time the CPU has spent running users'' processes that have been niced.'
          tags:
            - tag: component
              value: cpu
        - uuid: c9479b02b04141128b1ce7c8f3726c09
          name: 'CPU system time'
          key: 'system.cpu.util[,system]'
          value_type: FLOAT
          units: '%'
          description: 'Time the CPU has spent running the kernel and its processes.'
          tags:
            - tag: component
              value: cpu
        - uuid: 1f3bc82009e04b59845a0e15004637ad
          name: 'CPU user time'
          key: 'system.cpu.util[,user]'
          value_type: FLOAT
          units: '%'
          description: 'Time the CPU has spent running users'' processes that are not niced.'
          tags:
            - tag: component
              value: cpu
        - uuid: c17d001bd20a4732b8ef487366c6aa42
          name: 'Host name'
          key: system.hostname
          delay: 1h
          value_type: CHAR
          description: 'The host name of the system.'
          inventory_link: NAME
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: f48fb8ce1229492dae62de362c8c9539
              expression: 'last(/FreeBSD by Zabbix agent/system.hostname,#1)<>last(/FreeBSD by Zabbix agent/system.hostname,#2)'
              name: 'FreeBSD: Hostname was changed on {HOST.NAME}'
              priority: INFO
              tags:
                - tag: scope
                  value: notice
        - uuid: 4095ed7d606a47439294097a98af2c4f
          name: 'Host local time'
          key: system.localtime
          units: unixtime
          description: 'The local system time of the host.'
          tags:
            - tag: component
              value: os
        - uuid: 63fc1259011f4250901889979cdf472c
          name: 'Free swap space'
          key: 'system.swap.size[,free]'
          units: B
          description: 'The free space of the swap volume/file expressed in bytes.'
          tags:
            - tag: component
              value: memory
        - uuid: 187d11e610b94b468d18b88ca38f2c32
          name: 'Free swap space in %'
          key: 'system.swap.size[,pfree]'
          value_type: FLOAT
          units: '%'
          description: 'The free space of the swap volume/file expressed in %.'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: a125b6786d55426eb19afe284cee1f76
              expression: 'last(/FreeBSD by Zabbix agent/system.swap.size[,pfree])<50'
              name: 'FreeBSD: Lack of free swap space on {HOST.NAME}'
              priority: WARNING
              description: 'The system might need more physical memory.'
              tags:
                - tag: scope
                  value: capacity
                - tag: scope
                  value: performance
        - uuid: 9647b0b857074c4b9c14f15bb04af096
          name: 'Total swap space'
          key: 'system.swap.size[,total]'
          delay: 1h
          units: B
          description: 'Total space of the swap volume/file expressed in bytes.'
          tags:
            - tag: component
              value: memory
        - uuid: 4523ae069e0b4e16bcb5182c6dbf63f2
          name: 'System information'
          key: system.uname
          delay: 1h
          value_type: CHAR
          description: 'Information as normally returned by `uname -a`.'
          inventory_link: OS
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: ea2f9c186798420da781bd835fa0eaed
              expression: 'last(/FreeBSD by Zabbix agent/system.uname,#1)<>last(/FreeBSD by Zabbix agent/system.uname,#2)'
              name: 'FreeBSD: Host information was changed on {HOST.NAME}'
              priority: INFO
              tags:
                - tag: scope
                  value: notice
        - uuid: a49b956d592c4e2ba41caac3671e009f
          name: 'System uptime'
          key: system.uptime
          delay: 10m
          units: uptime
          tags:
            - tag: component
              value: os
          triggers:
            - uuid: 809e57eb897b43fb8538e76ec7dd6602
              expression: 'change(/FreeBSD by Zabbix agent/system.uptime)<0'
              name: 'FreeBSD: {HOST.NAME} has just been restarted'
              priority: INFO
              tags:
                - tag: scope
                  value: notice
        - uuid: fec3e877764e4bfd98e77da9d8c73606
          name: 'Number of logged in users'
          key: system.users.num
          description: 'The number of users who are currently logged in.'
          tags:
            - tag: component
              value: os
        - uuid: 2bb327cd5f8c49d9b680142825b9c030
          name: 'Checksum of /etc/passwd'
          key: 'vfs.file.cksum[/etc/passwd,sha256]'
          delay: 15m
          value_type: CHAR
          preprocessing:
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          tags:
            - tag: component
              value: security
          triggers:
            - uuid: 27b4e5de411949a4befa7171a2af6441
              expression: 'last(/FreeBSD by Zabbix agent/vfs.file.cksum[/etc/passwd,sha256],#1)<>last(/FreeBSD by Zabbix agent/vfs.file.cksum[/etc/passwd,sha256],#2)'
              name: 'FreeBSD: /etc/passwd has been changed on {HOST.NAME}'
              priority: WARNING
              tags:
                - tag: scope
                  value: security
        - uuid: 9695b40b38f74bb3bb5d127af1ba13ce
          name: 'Get filesystems'
          key: vfs.fs.get
          history: '0'
          value_type: TEXT
          description: 'The `vfs.fs.get` key acquires raw information set about the filesystems. Later to be extracted by preprocessing in dependent items.'
          tags:
            - tag: component
              value: raw
        - uuid: 561c7a383b944bca9ec5f7c44e322fed
          name: 'Available memory'
          key: 'vm.memory.size[available]'
          units: B
          description: 'Defined as free + cached + buffers.'
          tags:
            - tag: component
              value: memory
          triggers:
            - uuid: f8fcce1904ab46088fa80433b85f2e83
              expression: 'last(/FreeBSD by Zabbix agent/vm.memory.size[available])<20M'
              name: 'FreeBSD: Lack of available memory on server {HOST.NAME}'
              priority: AVERAGE
              tags:
                - tag: scope
                  value: capacity
                - tag: scope
                  value: performance
        - uuid: ffa54e82b7914672a3f7134134ac2638
          name: 'Total memory'
          key: 'vm.memory.size[total]'
          delay: 1h
          units: B
          description: 'Total memory expressed in bytes.'
          tags:
            - tag: component
              value: memory
        - uuid: cbfaa94dc7bc4606a792aaf357054075
          name: 'Zabbix agent availability'
          type: INTERNAL
          key: 'zabbix[host,agent,available]'
          description: 'Used for monitoring the availability status of the agent.'
          valuemap:
            name: zabbix.host.available
          tags:
            - tag: component
              value: system
          triggers:
            - uuid: fd9d36aaedff45f59017b1e714a5db69
              expression: 'max(/FreeBSD by Zabbix agent/zabbix[host,agent,available],{$AGENT.TIMEOUT})=0'
              name: 'FreeBSD: Zabbix agent is not available'
              event_name: 'FreeBSD: Zabbix agent is not available (for {$AGENT.TIMEOUT})'
              priority: AVERAGE
              description: 'For passive checks only. The availability of the agent(s) and a host is used with `{$AGENT.TIMEOUT}` as the time threshold.'
              manual_close: 'YES'
              tags:
                - tag: scope
                  value: availability
      discovery_rules:
        - uuid: cac3466488a544198f766d1152878456
          name: 'Network interface discovery'
          key: net.if.discovery
          delay: 1h
          filter:
            conditions:
              - macro: '{#IFNAME}'
                value: '@Network interfaces for discovery'
          description: 'Used for the discovery of network interfaces.'
          item_prototypes:
            - uuid: b1f9e472c6ed467d8cb0cc1739c39b59
              name: 'Interface {#IFNAME}: Incoming network traffic'
              key: 'net.if.in[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: interface
                - tag: interface
                  value: '{#IFNAME}'
            - uuid: ac93068d05084aa0a32a1bee78df3bd8
              name: 'Interface {#IFNAME}: Outgoing network traffic'
              key: 'net.if.out[{#IFNAME}]'
              units: bps
              preprocessing:
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters:
                    - '8'
              tags:
                - tag: component
                  value: interface
                - tag: interface
                  value: '{#IFNAME}'
          graph_prototypes:
            - uuid: 1f52d0c9ee934eb3a5198ab53fdf4679
              name: 'Interface {#IFNAME}: Network traffic'
              ymin_type_1: FIXED
              graph_items:
                - drawtype: GRADIENT_LINE
                  color: 00AA00
                  item:
                    host: 'FreeBSD by Zabbix agent'
                    key: 'net.if.in[{#IFNAME}]'
                - sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 3333FF
                  item:
                    host: 'FreeBSD by Zabbix agent'
                    key: 'net.if.out[{#IFNAME}]'
        - uuid: 4fd60a606c6343e9a7d7808d1d1f6008
          name: 'Mounted filesystem discovery'
          type: DEPENDENT
          key: vfs.fs.dependent.discovery
          filter:
            evaltype: AND
            conditions:
              - macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.MATCHES}'
              - macro: '{#FSNAME}'
                value: '{$VFS.FS.FSNAME.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
              - macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.MATCHES}'
              - macro: '{#FSTYPE}'
                value: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
                operator: NOT_MATCHES_REGEX
          description: 'The discovery of mounted filesystems with different types.'
          item_prototypes:
            - uuid: a5cdfe771122483fa1a88b2ea5c26b36
              name: 'FS [{#FSNAME}]: Inodes: Free, in %'
              type: DEPENDENT
              key: 'vfs.fs.dependent.inode[{#FSNAME},pfree]'
              value_type: FLOAT
              units: '%'
              description: 'Free metadata space expressed in %.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.inodes.pfree
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
              trigger_prototypes:
                - uuid: b9f632d35efd4958bd665ac0764c6da4
                  expression: 'min(/FreeBSD by Zabbix agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  name: 'FreeBSD: FS [{#FSNAME}]: Running out of free inodes'
                  event_name: 'FreeBSD: {#FSNAME}: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}%)'
                  opdata: 'Free inodes: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
                  description: 'Disk writing may fail if index nodes are exhausted, leading to error messages like "No space left on device" or "Disk is full", despite available free space.'
                  tags:
                    - tag: scope
                      value: capacity
                    - tag: scope
                      value: performance
                - uuid: 2b87c38f49b146f1b801319d03a19dc3
                  expression: 'min(/FreeBSD by Zabbix agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}'
                  name: 'FreeBSD: FS [{#FSNAME}]: Running out of free inodes'
                  event_name: 'FreeBSD: FS [{#FSNAME}]: Running out of free inodes (free < {$VFS.FS.INODE.PFREE.MIN.WARN:"{#FSNAME}"}%)'
                  opdata: 'Free inodes: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'Disk writing may fail if index nodes are exhausted, leading to error messages like "No space left on device" or "Disk is full", despite available free space.'
                  dependencies:
                    - name: 'FreeBSD: FS [{#FSNAME}]: Running out of free inodes'
                      expression: 'min(/FreeBSD by Zabbix agent/vfs.fs.dependent.inode[{#FSNAME},pfree],5m)<{$VFS.FS.INODE.PFREE.MIN.CRIT:"{#FSNAME}"}'
                  tags:
                    - tag: scope
                      value: capacity
                    - tag: scope
                      value: performance
            - uuid: 2ed6230d292a4037b67fe549c719e7ee
              name: 'FS [{#FSNAME}]: Space: Available'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},free]'
              units: B
              description: 'Available storage space expressed in bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.free
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
            - uuid: aa0dd0eb957a4485b1a62f715381019a
              name: 'FS [{#FSNAME}]: Space: Available, in %'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},pfree]'
              value_type: FLOAT
              units: '%'
              description: |
                Deprecated metric.
                Space availability expressed as a percentage, calculated using the current and maximum available spaces.
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.pfree
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: deprecated
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
            - uuid: 5db5afc2278744efadcf71d8531e40fa
              name: 'FS [{#FSNAME}]: Space: Used, in %'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},pused]'
              value_type: FLOAT
              units: '%'
              description: 'Calculated as the percentage of currently used space compared to the maximum available space.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.pused
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
              trigger_prototypes:
                - uuid: a14b0a2369404525aa1e079a16a222f1
                  expression: 'min(/FreeBSD by Zabbix agent/vfs.fs.dependent.size[{#FSNAME},pused],5m)>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}'
                  name: 'FreeBSD: FS [{#FSNAME}]: Space is critically low'
                  event_name: 'FreeBSD: FS [{#FSNAME}]: Space is critically low (used > {$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}%, total {{?last(//vfs.fs.dependent.size[{#FSNAME},total])/1024/1024/1024}.fmtnum(1)}GB)'
                  opdata: 'Space used: {{ITEM.LASTVALUE1}.fmtnum(1)}%'
                  priority: AVERAGE
                  description: |
                    The volume's space usage exceeds the `{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}%` limit.
                    The trigger expression is based on the current used and maximum available spaces.
                    Event name represents the total volume space, which can differ from the maximum available space, depending on the filesystem type.
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
                    - tag: scope
                      value: capacity
                - uuid: 01ea8e7f30564586af3b48adb3c930c1
                  expression: 'min(/FreeBSD by Zabbix agent/vfs.fs.dependent.size[{#FSNAME},pused],5m)>{$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}'
                  name: 'FreeBSD: FS [{#FSNAME}]: Space is low'
                  event_name: 'FreeBSD: FS [{#FSNAME}]: Space is low (used > {$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}%, total {{?last(//vfs.fs.dependent.size[{#FSNAME},total])/1024/1024/1024}.fmtnum(1)}GB)'
                  opdata: 'Space used: {{ITEM.LASTVALUE1}.fmtnum(1)}%'
                  priority: WARNING
                  description: |
                    The volume's space usage exceeds the `{$VFS.FS.PUSED.MAX.WARN:"{#FSNAME}"}%` limit.
                    The trigger expression is based on the current used and maximum available spaces.
                    Event name represents the total volume space, which can differ from the maximum available space, depending on the filesystem type.
                  manual_close: 'YES'
                  dependencies:
                    - name: 'FreeBSD: FS [{#FSNAME}]: Space is critically low'
                      expression: 'min(/FreeBSD by Zabbix agent/vfs.fs.dependent.size[{#FSNAME},pused],5m)>{$VFS.FS.PUSED.MAX.CRIT:"{#FSNAME}"}'
                  tags:
                    - tag: scope
                      value: availability
                    - tag: scope
                      value: capacity
            - uuid: 6daede58ae8f4e42a4aa2539a552ab08
              name: 'FS [{#FSNAME}]: Space: Total'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},total]'
              units: B
              description: 'Total space expressed in bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.total
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
            - uuid: 6efb08c26e1b439181a17d462ec1dab8
              name: 'FS [{#FSNAME}]: Space: Used'
              type: DEPENDENT
              key: 'vfs.fs.dependent.size[{#FSNAME},used]'
              units: B
              description: 'Used storage expressed in bytes.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.bytes.used
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
            - uuid: 94deedece667494398cbc537314911dd
              name: 'FS [{#FSNAME}]: Get data'
              type: DEPENDENT
              key: 'vfs.fs.dependent[{#FSNAME},data]'
              history: 1h
              value_type: TEXT
              description: 'Intermediate data of `{#FSNAME}` filesystem.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.fsname==''{#FSNAME}'')].first()'
              master_item:
                key: vfs.fs.get
              tags:
                - tag: component
                  value: raw
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
            - uuid: 5e2e9d6a08e34a37832bced869a75b1e
              name: 'FS [{#FSNAME}]: Option: Read-only'
              type: DEPENDENT
              key: 'vfs.fs.dependent[{#FSNAME},readonly]'
              description: 'The filesystem is mounted as read-only. It is available only for Zabbix agents 6.4 and higher.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.options
                  error_handler: DISCARD_VALUE
                - type: REGEX
                  parameters:
                    - '(?:^|,)read-only\b'
                    - '1'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
              master_item:
                key: 'vfs.fs.dependent[{#FSNAME},data]'
              tags:
                - tag: component
                  value: storage
                - tag: filesystem
                  value: '{#FSNAME}'
                - tag: fstype
                  value: '{#FSTYPE}'
              trigger_prototypes:
                - uuid: f5a2fc8328d647d48eb3c2ebda361dc3
                  expression: 'last(/FreeBSD by Zabbix agent/vfs.fs.dependent[{#FSNAME},readonly],#2)=0 and last(/FreeBSD by Zabbix agent/vfs.fs.dependent[{#FSNAME},readonly])=1'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/FreeBSD by Zabbix agent/vfs.fs.dependent[{#FSNAME},readonly])=0'
                  name: 'FreeBSD: FS [{#FSNAME}]: Filesystem has become read-only'
                  priority: AVERAGE
                  description: 'The filesystem has become read-only, possibly due to an I/O error. Available only for Zabbix agents 6.4 and higher.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: availability
                    - tag: scope
                      value: performance
          graph_prototypes:
            - uuid: 6c07aee93f0f4da696112b276ef7ca65
              name: 'FS [{#FSTYPE}({#FSNAME})]: Space usage graph, in % (relative to max available)'
              width: '600'
              height: '340'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                - drawtype: FILLED_REGION
                  color: F63100
                  calc_fnc: ALL
                  item:
                    host: 'FreeBSD by Zabbix agent'
                    key: 'vfs.fs.dependent.size[{#FSNAME},pused]'
            - uuid: 7db8f820b1f74bae9bd1a7dbe08c2ef5
              name: 'FS [{#FSTYPE}({#FSNAME})]: Space utilization chart (relative to total)'
              width: '600'
              height: '340'
              type: PIE
              show_3d: 'YES'
              graph_items:
                - color: '787878'
                  calc_fnc: LAST
                  type: GRAPH_SUM
                  item:
                    host: 'FreeBSD by Zabbix agent'
                    key: 'vfs.fs.dependent.size[{#FSNAME},total]'
                - sortorder: '1'
                  color: F63100
                  calc_fnc: LAST
                  item:
                    host: 'FreeBSD by Zabbix agent'
                    key: 'vfs.fs.dependent.size[{#FSNAME},used]'
                - sortorder: '2'
                  color: 199C09
                  calc_fnc: LAST
                  item:
                    host: 'FreeBSD by Zabbix agent'
                    key: 'vfs.fs.dependent.size[{#FSNAME},free]'
          master_item:
            key: vfs.fs.get
          lld_macro_paths:
            - lld_macro: '{#FSNAME}'
              path: $.fsname
            - lld_macro: '{#FSTYPE}'
              path: $.fstype
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  var filesystems = JSON.parse(value);
                  
                  result = filesystems.map(function (filesystem) {
                  	return {
                  		'fsname': filesystem.fsname,
                  		'fstype': filesystem.fstype
                  	};
                  });
                  
                  return JSON.stringify(result);
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          overrides:
            - name: 'Skip metadata collection for dynamic FS'
              step: '1'
              filter:
                conditions:
                  - macro: '{#FSTYPE}'
                    value: ^(btrfs|zfs)$
              operations:
                - operator: LIKE
                  value: Inodes
                  discover: NO_DISCOVER
      tags:
        - tag: class
          value: os
        - tag: target
          value: freebsd
      macros:
        - macro: '{$AGENT.TIMEOUT}'
          value: 3m
          description: 'Timeout after which the agent is considered unavailable. Works only for agents reachable from Zabbix server/proxy (in passive mode).'
          config:
            type: TEXT
            priority: '1'
            section_name: Other
            label: 'Seconds since the last Zabbix agent seen'
            description: 'Timeout after which the agent is considered unavailable. Works only for agents reachable from Zabbix server/proxy (in passive mode).'
        - macro: '{$VFS.FS.FSNAME.MATCHES}'
          value: .+
          description: 'Used for filesystem discovery. Can be overridden on the host or linked template level.'
          config:
            type: TEXT
            priority: '3'
            section_name: Filters
            label: 'Filter for filesystems by name'
            description: 'Used for filesystem discovery. Can be overridden on the host or linked template level.'
        - macro: '{$VFS.FS.FSNAME.NOT_MATCHES}'
          value: ^(/dev|/sys|/run|/proc|.+/shm$)
          description: 'Used for filesystem discovery. Can be overridden on the host or linked template level.'
          config:
            type: TEXT
            priority: '2'
            section_name: Filters
            label: 'Filter for filesystems by name (exclude)'
            description: 'Used for filesystem discovery. Can be overridden on the host or linked template level.'
        - macro: '{$VFS.FS.FSTYPE.MATCHES}'
          value: ^(btrfs|ext2|ext3|ext4|reiser|xfs|ffs|ufs|jfs|jfs2|vxfs|hfs|apfs|refs|ntfs|fat32|zfs)$
          description: 'Used for filesystem discovery. Can be overridden on the host or linked template level.'
          config:
            type: TEXT
            priority: '4'
            section_name: Filters
            label: 'Filter for filesystems by type'
            description: 'Used for filesystem discovery. Can be overridden on the host or linked template level.'
        - macro: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
          value: ^\s$
          description: 'Used for filesystem discovery. Can be overridden on the host or linked template level.'
          config:
            type: TEXT
            priority: '5'
            section_name: Filters
            label: 'Filter for filesystems by type (exclude)'
            description: 'Used for filesystem discovery. Can be overridden on the host or linked template level.'
        - macro: '{$VFS.FS.INODE.PFREE.MIN.CRIT}'
          value: '10'
          description: 'The critical threshold of the filesystem metadata utilization.'
          config:
            type: TEXT
            priority: '6'
            section_name: Thresholds
            label: 'Threshold of the filesystem metadata utilization (critical)'
            description: 'The critical threshold of the filesystem metadata utilization. In the range from 0 to 100 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$VFS.FS.INODE.PFREE.MIN.WARN}'
          value: '20'
          description: 'The warning threshold of the filesystem metadata utilization.'
          config:
            type: TEXT
            priority: '7'
            section_name: Thresholds
            label: 'Threshold of the filesystem metadata utilization'
            description: 'The warning threshold of the filesystem metadata utilization. In the range from 0 to 100 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$VFS.FS.PUSED.MAX.CRIT}'
          value: '90'
          description: 'The critical threshold of the filesystem utilization.'
          config:
            type: TEXT
            priority: '8'
            section_name: Thresholds
            label: 'Threshold for filesystem utilization (critical)'
            description: 'The critical threshold of the filesystem utilization. In the range from 0 to 100 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$VFS.FS.PUSED.MAX.WARN}'
          value: '80'
          description: 'The warning threshold of the filesystem utilization.'
          config:
            type: TEXT
            priority: '9'
            section_name: Thresholds
            label: 'Threshold for filesystem utilization (warning)'
            description: 'The warning threshold of the filesystem utilization. In the range from 0 to 100 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
      dashboards:
        - uuid: ccdd4aba5a154cd39cffb59e39f96c08
          name: Filesystems
          pages:
            - name: Overview
              widgets:
                - type: graphprototype
                  width: '72'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '3'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'FreeBSD by Zabbix agent'
                        name: 'FS [{#FSTYPE}({#FSNAME})]: Space utilization chart (relative to total)'
                    - type: STRING
                      name: reference
                      value: AAAEB
                - type: graphprototype
                  'y': '5'
                  width: '72'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '1'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'FreeBSD by Zabbix agent'
                        name: 'FS [{#FSTYPE}({#FSNAME})]: Space usage graph, in % (relative to max available)'
                    - type: STRING
                      name: reference
                      value: AAAEC
        - uuid: 618c8fc9d4b640999b3389960f5bead4
          name: 'System performance'
          pages:
            - widgets:
                - type: graph
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'FreeBSD by Zabbix agent'
                        name: 'FreeBSD: CPU load'
                    - type: STRING
                      name: reference
                      value: AAAAA
                - type: graph
                  'y': '5'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'FreeBSD by Zabbix agent'
                        name: 'FreeBSD: Memory usage'
                    - type: STRING
                      name: reference
                      value: AAAAC
                - type: graphprototype
                  'y': '10'
                  width: '72'
                  height: '5'
                  fields:
                    - type: INTEGER
                      name: columns
                      value: '3'
                    - type: GRAPH_PROTOTYPE
                      name: graphid.0
                      value:
                        host: 'FreeBSD by Zabbix agent'
                        name: 'FS [{#FSTYPE}({#FSNAME})]: Space utilization chart (relative to total)'
                    - type: STRING
                      name: reference
                      value: AAAAE
                - type: graph
                  x: '36'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'FreeBSD by Zabbix agent'
                        name: 'FreeBSD: CPU utilization'
                    - type: STRING
                      name: reference
                      value: AAAAB
                - type: graph
                  x: '36'
                  'y': '5'
                  width: '36'
                  height: '5'
                  fields:
                    - type: GRAPH
                      name: graphid.0
                      value:
                        host: 'FreeBSD by Zabbix agent'
                        name: 'FreeBSD: Swap usage'
                    - type: STRING
                      name: reference
                      value: AAAAD
      valuemaps:
        - uuid: 9c02af203e354ac6ac87a742e85f683b
          name: zabbix.host.available
          mappings:
            - value: '0'
              newvalue: 'not available'
            - value: '1'
              newvalue: available
            - value: '2'
              newvalue: unknown
        - uuid: b82f35541efe4fc1a432c049eba5d082
          name: 'Zabbix agent ping status'
          mappings:
            - value: '1'
              newvalue: Up
  graphs:
    - uuid: 3ed928729f2d41139a42ca3ee0204551
      name: 'FreeBSD: CPU jumps'
      graph_items:
        - color: '009900'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: system.cpu.switches
        - sortorder: '1'
          color: '000099'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: system.cpu.intr
    - uuid: ac8b187522904c0880ea16a2b8727dfc
      name: 'FreeBSD: CPU load'
      ymin_type_1: FIXED
      graph_items:
        - color: '009900'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.cpu.load[percpu,avg1]'
        - sortorder: '1'
          color: '000099'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.cpu.load[percpu,avg5]'
        - sortorder: '2'
          color: '990000'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.cpu.load[percpu,avg15]'
    - uuid: ecdccd78d75d4255948995b510acfefb
      name: 'FreeBSD: CPU utilization'
      show_triggers: 'NO'
      type: STACKED
      ymin_type_1: FIXED
      ymax_type_1: FIXED
      graph_items:
        - color: '009999'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.cpu.util[,interrupt]'
        - sortorder: '1'
          color: '990099'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.cpu.util[,nice]'
        - sortorder: '2'
          color: '990000'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.cpu.util[,system]'
        - sortorder: '3'
          color: '000099'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.cpu.util[,user]'
        - sortorder: '4'
          color: '009900'
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.cpu.util[,idle]'
    - uuid: 191f6c7b63204fd091d2e82c4f4b678a
      name: 'FreeBSD: Memory usage'
      graph_items:
        - drawtype: GRADIENT_LINE
          color: 00C800
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'vm.memory.size[available]'
    - uuid: 23ade54acd87415080578379ab2cca6b
      name: 'FreeBSD: Swap usage'
      width: '600'
      height: '340'
      show_work_period: 'NO'
      show_triggers: 'NO'
      type: PIE
      show_3d: 'YES'
      graph_items:
        - color: AA0000
          type: GRAPH_SUM
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.swap.size[,total]'
        - sortorder: '1'
          color: 00AA00
          item:
            host: 'FreeBSD by Zabbix agent'
            key: 'system.swap.size[,free]'
