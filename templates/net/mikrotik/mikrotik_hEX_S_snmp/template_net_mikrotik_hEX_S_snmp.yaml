zabbix_export:
  version: '6.0'
  date: '2021-12-17T18:09:25Z'
  groups:
    -
      uuid: 36bff6c29af64692839d077febfc7079
      name: 'Templates/Network devices'
  templates:
    -
      uuid: 7802db8c2f9c4a7eba7b381b8f3fa5c5
      template: 'MikroTik hEX S SNMP'
      name: 'MikroTik hEX S SNMP'
      description: |
        The template for monitoring Ethernet router MikroTik hEX S.
        5x Gigabit Ethernet, SFP, Dual Core 880MHz CPU, 256MB RAM, USB, microSD, RouterOS L4, IPsec hardware encryption support and The Dude server package
        
        MIBs used:
        HOST-RESOURCES-MIB
        MIKROTIK-MIB
        
        Template tooling version used: 0.40
      templates:
        -
          name: 'Generic SNMP'
        -
          name: 'Interfaces SNMP'
      groups:
        -
          name: 'Templates/Network devices'
      items:
        -
          uuid: dd3b07cbd6d74fec88e1d371846b48a4
          name: 'Firmware version'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.14988.1.1.7.4.0
          key: system.hw.firmware
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: |
            MIB: MIKROTIK-MIB
            Current firmware version.
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: Application
              value: Inventory
          triggers:
            -
              uuid: bdc6d6b5a4be4bba95f1635d8cf165d7
              expression: 'last(/MikroTik hEX S SNMP/system.hw.firmware,#1)<>last(/MikroTik hEX S SNMP/system.hw.firmware,#2) and length(last(/MikroTik hEX S SNMP/system.hw.firmware))>0'
              name: 'Firmware has changed'
              opdata: 'Current value: {ITEM.LASTVALUE1}'
              priority: INFO
              description: 'Firmware version has changed. Ack to close'
              manual_close: 'YES'
        -
          uuid: ea51e70e43e24056b25309ce0fa8f9d8
          name: 'Hardware model name'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: system.hw.model
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          inventory_link: MODEL
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: Application
              value: Inventory
        -
          uuid: a577dbe3cfde4294ab93e0ab114c24c7
          name: 'Hardware serial number'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.14988.1.1.7.3.0
          key: system.hw.serialnumber
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: |
            MIB: MIKROTIK-MIB
            RouterBOARD serial number.
          inventory_link: SERIALNO_A
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: Application
              value: Inventory
          triggers:
            -
              uuid: 9bcc039b8f1e4b3c84414d0d62d6c52d
              expression: 'last(/MikroTik hEX S SNMP/system.hw.serialnumber,#1)<>last(/MikroTik hEX S SNMP/system.hw.serialnumber,#2) and length(last(/MikroTik hEX S SNMP/system.hw.serialnumber))>0'
              name: 'Device has been replaced (new serial number received)'
              priority: INFO
              description: 'Device serial number has changed. Ack to close'
              manual_close: 'YES'
        -
          uuid: 34a57dc1a4f54f7ea156fa5c7b5f61de
          name: 'Operating system'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.14988.1.1.4.4.0
          key: 'system.sw.os[mtxrLicVersion.0]'
          delay: 1h
          history: 2w
          trends: '0'
          value_type: CHAR
          description: |
            MIB: MIKROTIK-MIB
            Software version.
          inventory_link: OS
          preprocessing:
            -
              type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1d
          tags:
            -
              tag: Application
              value: Inventory
          triggers:
            -
              uuid: 21dd8dc14526470493b31ebddf14574c
              expression: 'last(/MikroTik hEX S SNMP/system.sw.os[mtxrLicVersion.0],#1)<>last(/MikroTik hEX S SNMP/system.sw.os[mtxrLicVersion.0],#2) and length(last(/MikroTik hEX S SNMP/system.sw.os[mtxrLicVersion.0]))>0'
              name: 'Operating system description has changed'
              priority: INFO
              description: 'Operating system description has changed. Possible reasons that system has been updated or replaced. Ack to close.'
              manual_close: 'YES'
        -
          uuid: 4d8039dcceb344dcb4de5c4895a4e199
          name: 'Total memory'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.25.2.3.1.5.65536
          key: 'vm.memory.total[hrStorageSize.Memory]'
          history: 7d
          units: B
          description: |
            MIB: HOST-RESOURCES-MIB
            The size of the storage represented by this entry, in
            units of hrStorageAllocationUnits. This object is
            writable to allow remote configuration of the size of
            the storage area in those cases where such an
            operation makes sense and is possible on the
            underlying system. For example, the amount of main
            memory allocated to a buffer pool might be modified or
            the amount of disk space allocated to virtual memory
            might be modified.
          preprocessing:
            -
              type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            -
              tag: Application
              value: Memory
        -
          uuid: 664555ffcf5e48039bdcf98bf79247ef
          name: 'Used memory'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.25.2.3.1.6.65536
          key: 'vm.memory.used[hrStorageUsed.Memory]'
          history: 7d
          units: B
          description: |
            MIB: HOST-RESOURCES-MIB
            The amount of the storage represented by this entry that is allocated, in units of hrStorageAllocationUnits.
          preprocessing:
            -
              type: MULTIPLIER
              parameters:
                - '1024'
          tags:
            -
              tag: Application
              value: Memory
        -
          uuid: 8aa0e7e65d12468e9fdf4e2faebd3450
          name: 'Memory utilization'
          type: CALCULATED
          key: 'vm.memory.util[memoryUsedPercentage.Memory]'
          history: 7d
          value_type: FLOAT
          units: '%'
          params: 'last(//vm.memory.used[hrStorageUsed.Memory])/last(//vm.memory.total[hrStorageSize.Memory])*100'
          description: 'Memory utilization in %'
          tags:
            -
              tag: Application
              value: Memory
          triggers:
            -
              uuid: bdd1ff379f214b1896c0e7ee5d6e6e16
              expression: 'min(/MikroTik hEX S SNMP/vm.memory.util[memoryUsedPercentage.Memory],5m)>{$MEMORY.UTIL.MAX}'
              name: 'High memory utilization (>{$MEMORY.UTIL.MAX}% for 5m)'
              priority: AVERAGE
              description: 'The system is running out of free memory.'
      discovery_rules:
        -
          uuid: 455bfeb9d0b14c77a43129d489e3140b
          name: 'CPU discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.2.1.25.3.3.1.1]'
          key: hrProcessorLoad.discovery
          delay: 1h
          description: 'HOST-RESOURCES-MIB::hrProcessorTable discovery'
          item_prototypes:
            -
              uuid: e0fd55cedc7340f2a453865f02f3a668
              name: '#{#SNMPINDEX}: CPU utilization'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.3.3.1.2.{#SNMPINDEX}'
              key: 'system.cpu.util[hrProcessorLoad.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              units: '%'
              description: |
                MIB: HOST-RESOURCES-MIB
                The average, over the last minute, of the percentage of time that this processor was not idle. Implementations may approximate this one minute smoothing period if necessary.
              tags:
                -
                  tag: Application
                  value: CPU
              trigger_prototypes:
                -
                  uuid: ca6c0d5b13a24f6b9e28296818ae1624
                  expression: 'min(/MikroTik hEX S SNMP/system.cpu.util[hrProcessorLoad.{#SNMPINDEX}],5m)>{$CPU.UTIL.CRIT}'
                  name: '#{#SNMPINDEX}: High CPU utilization (over {$CPU.UTIL.CRIT}% for 5m)'
                  opdata: 'Current utilization: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'CPU utilization is too high. The system might be slow to respond.'
          graph_prototypes:
            -
              uuid: 37edfa6825394b30b3742eac201a3a58
              name: '#{#SNMPINDEX}: CPU utilization'
              ymin_type_1: FIXED
              ymax_type_1: FIXED
              graph_items:
                -
                  drawtype: GRADIENT_LINE
                  color: 1A7C11
                  item:
                    host: 'MikroTik hEX S SNMP'
                    key: 'system.cpu.util[hrProcessorLoad.{#SNMPINDEX}]'
        -
          uuid: f328cfadd7c149c98d8e6694ff8a1d16
          name: 'Temperature CPU discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.14988.1.1.3.11]'
          key: mtxrHlProcessorTemperature.discovery
          delay: 1h
          description: |
            MIKROTIK-MIB::mtxrHlProcessorTemperature
            Since temperature of CPU is not available on all Mikrotik hardware, this is done to avoid unsupported items.
          item_prototypes:
            -
              uuid: 7c007188eb6b465c8b56f415ac1a8efc
              name: 'CPU: Temperature'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.3.11.{#SNMPINDEX}'
              key: 'sensor.temp.value[mtxrHlProcessorTemperature.{#SNMPINDEX}]'
              delay: 3m
              value_type: FLOAT
              units: °C
              description: |
                MIB: MIKROTIK-MIB
                mtxrHlProcessorTemperature Processor temperature in Celsius (degrees C).
                Might be missing in entry models (RB750, RB450G..).
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.1'
              tags:
                -
                  tag: Application
                  value: Temperature
              trigger_prototypes:
                -
                  uuid: 21775fd4ca0143838ea2c2c7c16c4b75
                  expression: 'avg(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlProcessorTemperature.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"CPU"}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'max(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlProcessorTemperature.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"CPU"}-3'
                  name: 'CPU: Temperature is above critical threshold: >{$TEMP_CRIT:"CPU"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: HIGH
                  description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
                -
                  uuid: 7c75f3db8a8341819bb4455d4a6440e3
                  expression: 'avg(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlProcessorTemperature.{#SNMPINDEX}],5m)>{$TEMP_WARN:"CPU"}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'max(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlProcessorTemperature.{#SNMPINDEX}],5m)<{$TEMP_WARN:"CPU"}-3'
                  name: 'CPU: Temperature is above warning threshold: >{$TEMP_WARN:"CPU"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
                  dependencies:
                    -
                      name: 'CPU: Temperature is above critical threshold: >{$TEMP_CRIT:"CPU"}'
                      expression: 'avg(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlProcessorTemperature.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"CPU"}'
                      recovery_expression: 'max(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlProcessorTemperature.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"CPU"}-3'
                -
                  uuid: 3247cd9062894b59bb736c3c75bf2f67
                  expression: 'avg(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlProcessorTemperature.{#SNMPINDEX}],5m)<{$TEMP_CRIT_LOW:"CPU"}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'min(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlProcessorTemperature.{#SNMPINDEX}],5m)>{$TEMP_CRIT_LOW:"CPU"}+3'
                  name: 'CPU: Temperature is too low: <{$TEMP_CRIT_LOW:"CPU"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
        -
          uuid: 7f462b2b67494acc8e968a38ae2949e7
          name: 'Temperature sensor discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.14988.1.1.3.10]'
          key: mtxrHlTemperature.discovery
          delay: 1h
          description: |
            MIKROTIK-MIB::mtxrHlTemperature
            Since temperature sensor is not available on all Mikrotik hardware,
            this is done to avoid unsupported items.
          item_prototypes:
            -
              uuid: 219015883daa4871be424d46c4af4126
              name: 'Device: Temperature'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.3.10.{#SNMPINDEX}'
              key: 'sensor.temp.value[mtxrHlTemperature.{#SNMPINDEX}]'
              delay: 3m
              value_type: FLOAT
              units: °C
              description: |
                MIB: MIKROTIK-MIB
                mtxrHlTemperature Device temperature in Celsius (degrees C).
                Might be missing in entry models (RB750, RB450G..).
                
                Reference: http://wiki.mikrotik.com/wiki/Manual:SNMP
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '0.1'
              tags:
                -
                  tag: Application
                  value: Temperature
              trigger_prototypes:
                -
                  uuid: ce2928b0b45a4e74976c4ebb01f769b6
                  expression: 'avg(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlTemperature.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"Device"}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'max(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlTemperature.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"Device"}-3'
                  name: 'Device: Temperature is above critical threshold: >{$TEMP_CRIT:"Device"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: HIGH
                  description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
                -
                  uuid: 9401397315604181973ac4a5e0c6a5ba
                  expression: 'avg(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlTemperature.{#SNMPINDEX}],5m)>{$TEMP_WARN:"Device"}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'max(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlTemperature.{#SNMPINDEX}],5m)<{$TEMP_WARN:"Device"}-3'
                  name: 'Device: Temperature is above warning threshold: >{$TEMP_WARN:"Device"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'This trigger uses temperature sensor values as well as temperature sensor status if available'
                  dependencies:
                    -
                      name: 'Device: Temperature is above critical threshold: >{$TEMP_CRIT:"Device"}'
                      expression: 'avg(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlTemperature.{#SNMPINDEX}],5m)>{$TEMP_CRIT:"Device"}'
                      recovery_expression: 'max(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlTemperature.{#SNMPINDEX}],5m)<{$TEMP_CRIT:"Device"}-3'
                -
                  uuid: 466053cdfce44600bf1ff0ced3c4fce4
                  expression: 'avg(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlTemperature.{#SNMPINDEX}],5m)<{$TEMP_CRIT_LOW:"Device"}'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'min(/MikroTik hEX S SNMP/sensor.temp.value[mtxrHlTemperature.{#SNMPINDEX}],5m)>{$TEMP_CRIT_LOW:"Device"}+3'
                  name: 'Device: Temperature is too low: <{$TEMP_CRIT_LOW:"Device"}'
                  opdata: 'Current value: {ITEM.LASTVALUE1}'
                  priority: AVERAGE
        -
          uuid: 9bab04f1de2b4bb59ee2f5116b67829e
          name: 'LTE modem discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFNAME},1.3.6.1.4.1.14988.1.1.14.1.1.2,{#IFALIAS},1.3.6.1.2.1.31.1.1.1.18,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: mtxrLTEModem.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#IFTYPE}'
                value: ^1$
                formulaid: B
              -
                macro: '{#IFNAME}'
                value: '{$IFNAME.LTEMODEM.MATCHES}'
                formulaid: A
          description: 'MIKROTIK-MIB::mtxrLTEModemInterfaceIndex'
          item_prototypes:
            -
              uuid: 88a280a7905449e793add1d1217f92f9
              name: 'Interface {#IFNAME}({#IFALIAS}): LTE modem RSRP'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.16.1.1.4.{#SNMPINDEX}'
              key: 'lte.modem.rsrp[mtxrLTEModemSignalRSRP.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              units: dbm
              description: |
                MIB: MIKROTIK-MIB
                mtxrLTEModemSignalRSRP Reference Signal Received Power.
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
              trigger_prototypes:
                -
                  uuid: 9a48a8512ac74bff9c44733842d21693
                  expression: 'max(/MikroTik hEX S SNMP/lte.modem.rsrp[mtxrLTEModemSignalRSRP.{#SNMPINDEX}],5m) < {$LTEMODEM.RSRP.MIN.WARN}'
                  name: 'Interface {#IFNAME}({#IFALIAS}): LTE modem RSRP is low (below {$LTEMODEM.RSRP.MIN.WARN}dbm for 5m)'
                  priority: WARNING
            -
              uuid: b04b0c8358f84225bd33ba0a4494bc91
              name: 'Interface {#IFNAME}({#IFALIAS}): LTE modem RSRQ'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.16.1.1.3.{#SNMPINDEX}'
              key: 'lte.modem.rsrq[mtxrLTEModemSignalRSRQ.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              units: db
              description: |
                MIB: MIKROTIK-MIB
                mtxrLTEModemSignalRSRQ Reference Signal Received Quality.
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
              trigger_prototypes:
                -
                  uuid: c5e6899f9dee47d7812366a26e5191d9
                  expression: 'max(/MikroTik hEX S SNMP/lte.modem.rsrq[mtxrLTEModemSignalRSRQ.{#SNMPINDEX}],5m) < {$LTEMODEM.RSRQ.MIN.WARN}'
                  name: 'Interface {#IFNAME}({#IFALIAS}): LTE modem RSRQ is low (below {$LTEMODEM.RSRQ.MIN.WARN}db for 5m)'
                  priority: WARNING
            -
              uuid: 9600e46ee74e48b48d169399b2dda431
              name: 'Interface {#IFNAME}({#IFALIAS}): LTE modem RSSI'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.16.1.1.2.{#SNMPINDEX}'
              key: 'lte.modem.rssi[mtxrLTEModemSignalRSSI.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              units: dbm
              description: |
                MIB: MIKROTIK-MIB
                mtxrLTEModemSignalRSSI Received Signal Strength Indicator.
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
              trigger_prototypes:
                -
                  uuid: 207bea70b82e4a6087f104cb1ec1f8a2
                  expression: 'max(/MikroTik hEX S SNMP/lte.modem.rssi[mtxrLTEModemSignalRSSI.{#SNMPINDEX}],5m) < {$LTEMODEM.RSSI.MIN.WARN}'
                  name: 'Interface {#IFNAME}({#IFALIAS}): LTE modem RSSI is low (below {$LTEMODEM.RSSI.MIN.WARN}dbm for 5m)'
                  priority: WARNING
            -
              uuid: 67466da7befe41a9a0a6d84b6c2508d2
              name: 'Interface {#IFNAME}({#IFALIAS}): LTE modem SINR'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.16.1.1.7.{#SNMPINDEX}'
              key: 'lte.modem.sinr[mtxrLTEModemSignalSINR.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              units: db
              description: |
                MIB: MIKROTIK-MIB
                mtxrLTEModemSignalSINR Signal to Interference & Noise Ratio.
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
              trigger_prototypes:
                -
                  uuid: 3b7135afe54a4acfbf5d14510f6b22c1
                  expression: 'max(/MikroTik hEX S SNMP/lte.modem.sinr[mtxrLTEModemSignalSINR.{#SNMPINDEX}],5m) < {$LTEMODEM.SINR.MIN.WARN}'
                  name: 'Interface {#IFNAME}({#IFALIAS}): LTE modem SINR is low (below {$LTEMODEM.SINR.MIN.WARN}db for 5m)'
                  priority: WARNING
          graph_prototypes:
            -
              uuid: 709b83b504d5409091a71fc4351f06f7
              name: 'Interface {#IFNAME}({#IFALIAS}): Modem Signal. {#SNMPINDEX}'
              graph_items:
                -
                  color: 1A7C11
                  item:
                    host: 'MikroTik hEX S SNMP'
                    key: 'lte.modem.sinr[mtxrLTEModemSignalSINR.{#SNMPINDEX}]'
                -
                  sortorder: '1'
                  color: 2774A4
                  item:
                    host: 'MikroTik hEX S SNMP'
                    key: 'lte.modem.rsrq[mtxrLTEModemSignalRSRQ.{#SNMPINDEX}]'
                -
                  sortorder: '2'
                  color: F63100
                  item:
                    host: 'MikroTik hEX S SNMP'
                    key: 'lte.modem.rsrp[mtxrLTEModemSignalRSRP.{#SNMPINDEX}]'
                -
                  sortorder: '3'
                  color: A54F10
                  item:
                    host: 'MikroTik hEX S SNMP'
                    key: 'lte.modem.rssi[mtxrLTEModemSignalRSSI.{#SNMPINDEX}]'
        -
          uuid: 0e917c0aa21343248fe29278d61b961a
          name: 'AP channel discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFNAME},1.3.6.1.4.1.14988.1.1.14.1.1.2,{#IFALIAS},1.3.6.1.2.1.31.1.1.1.18,{#IFTYPE},1.3.6.1.2.1.2.2.1.3,{#IFADMINSTATUS},1.3.6.1.2.1.2.2.1.7]'
          key: mtxrWlAp.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#IFTYPE}'
                value: ^71$
                formulaid: B
              -
                macro: '{#IFADMINSTATUS}'
                value: ^1$
                formulaid: A
          description: 'MIKROTIK-MIB::mtxrWlAp'
          item_prototypes:
            -
              uuid: 6e320401044041cda2c048b4af73fb8e
              name: 'Interface {#IFNAME}({#IFALIAS}): AP authenticated clients'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.1.3.1.11.{#SNMPINDEX}'
              key: 'ssid.authclient[mtxrWlApAuthClientCount.{#SNMPINDEX}]'
              history: 7d
              description: |
                MIB: MIKROTIK-MIB
                mtxrWlApAuthClientCount Number of authentication clients.
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: ad811b6b140844e59dd6ac2618e1b9bb
              name: 'Interface {#IFNAME}({#IFALIAS}): AP band'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.1.3.1.8.{#SNMPINDEX}'
              key: 'ssid.band[mtxrWlApBand.{#SNMPINDEX}]'
              history: 7d
              trends: '0'
              value_type: CHAR
              description: |
                MIB: MIKROTIK-MIB
                mtxrWlApBand
              preprocessing:
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 9e3847a985c14de59faf61670478b6bf
              name: 'Interface {#IFNAME}({#IFALIAS}): SSID'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.1.3.1.4.{#SNMPINDEX}'
              key: 'ssid.name[mtxrWlApSsid.{#SNMPINDEX}]'
              history: 7d
              trends: '0'
              value_type: CHAR
              description: |
                MIB: MIKROTIK-MIB
                mtxrWlApSsid Service Set Identifier.
              preprocessing:
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 51174e5e7d41479fab6b9077ef5d40d9
              name: 'Interface {#IFNAME}({#IFALIAS}): AP noise floor'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.1.3.1.9.{#SNMPINDEX}'
              key: 'ssid.noise[mtxrWlApNoiseFloor.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              description: |
                MIB: MIKROTIK-MIB
                mtxrWlApNoiseFloor
              preprocessing:
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 15m
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: bd2ece0be43f48b1a390d6f44c796f4a
              name: 'Interface {#IFNAME}({#IFALIAS}): AP registered clients'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.1.3.1.6.{#SNMPINDEX}'
              key: 'ssid.regclient[mtxrWlApClientCount.{#SNMPINDEX}]'
              history: 7d
              description: |
                MIB: MIKROTIK-MIB
                mtxrWlApClientCount Client established connection to AP, but didn't finish all authentication procedures for full connection.
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
        -
          uuid: edb9c0ee0f4e4de2819919ddb2a88a99
          name: 'CAPsMAN AP channel discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFNAME},1.3.6.1.4.1.14988.1.1.14.1.1.2,{#IFALIAS},1.3.6.1.2.1.31.1.1.1.18,{#IFTYPE},1.3.6.1.2.1.2.2.1.3]'
          key: mtxrWlCMChannel.discovery
          delay: 1h
          filter:
            evaltype: AND
            conditions:
              -
                macro: '{#IFTYPE}'
                value: ^1$
                formulaid: B
              -
                macro: '{#IFNAME}'
                value: '{$IFNAME.WIFI.MATCHES}'
                formulaid: A
          description: 'MIKROTIK-MIB::mtxrWlCMChannel'
          item_prototypes:
            -
              uuid: b867fd906472452ba9c503fe7f82f680
              name: 'Interface {#IFNAME}({#IFALIAS}): AP authenticated clients'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.1.7.1.3.{#SNMPINDEX}'
              key: 'ssid.authclient[mtxrWlCMAuthClientCount.{#SNMPINDEX}]'
              history: 7d
              description: |
                MIB: MIKROTIK-MIB
                mtxrWlCMAuthClientCount Number of authentication clients.
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: e96e64d9fe5944b4b5bb1324fb2845b0
              name: 'Interface {#IFNAME}({#IFALIAS}): AP channel'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.1.7.1.5.{#SNMPINDEX}'
              key: 'ssid.channel[mtxrWlCMChannel.{#SNMPINDEX}]'
              history: 7d
              trends: '0'
              value_type: CHAR
              description: |
                MIB: MIKROTIK-MIB
                mtxrWlCMChannel
              preprocessing:
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 720d95d0ef294d019fc91b2ed2debb14
              name: 'Interface {#IFNAME}({#IFALIAS}): AP registered clients'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.1.7.1.2.{#SNMPINDEX}'
              key: 'ssid.regclient[mtxrWlCMRegClientCount.{#SNMPINDEX}]'
              history: 7d
              description: |
                MIB: MIKROTIK-MIB
                mtxrWlCMRegClientCount Client established connection to AP, but didn't finish all authentication procedures for full connection.
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
            -
              uuid: 4d8828d7d008441fa7497dbc88d6d065
              name: 'Interface {#IFNAME}({#IFALIAS}): AP state'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.14988.1.1.1.7.1.4.{#SNMPINDEX}'
              key: 'ssid.state[mtxrWlCMState.{#SNMPINDEX}]'
              history: 7d
              trends: '0'
              value_type: CHAR
              description: |
                MIB: MIKROTIK-MIB
                mtxrWlCMState Wireless interface state.
              preprocessing:
                -
                  type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                -
                  tag: Application
                  value: 'Interface {#IFNAME}({#IFALIAS})'
              trigger_prototypes:
                -
                  uuid: de36b7b78e8b4bea936347995a0eaeb1
                  expression: 'last(/MikroTik hEX S SNMP/ssid.state[mtxrWlCMState.{#SNMPINDEX}])<>"running-ap"'
                  name: 'Interface {#IFNAME}({#IFALIAS}): AP interface {#IFNAME}({#IFALIAS}) is not running'
                  priority: WARNING
                  description: 'Access point interface can be not running by different reasons - disabled interface, power off, network link down.'
        -
          uuid: 63c54ef0b1a54c2a9cce978a5923d83f
          name: 'Storage discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.2.1.25.2.3.1.3,{#ALLOC_UNITS},1.3.6.1.2.1.25.2.3.1.4,{#STORAGE_TYPE},1.3.6.1.2.1.25.2.3.1.2]'
          key: storage.discovery
          delay: 1h
          filter:
            evaltype: OR
            conditions:
              -
                macro: '{#STORAGE_TYPE}'
                value: .+4$
                formulaid: A
              -
                macro: '{#STORAGE_TYPE}'
                value: .+hrStorageFixedDisk
                formulaid: B
          description: 'HOST-RESOURCES-MIB::hrStorage discovery with storage filter'
          item_prototypes:
            -
              uuid: 6cddae4271784cc5bb19102f2f8f44a0
              name: 'Disk-{#SNMPINDEX}: Space utilization'
              type: CALCULATED
              key: 'vfs.fs.pused[hrStorageSize.{#SNMPINDEX}]'
              history: 7d
              value_type: FLOAT
              units: '%'
              params: '(last(//vfs.fs.used[hrStorageSize.{#SNMPINDEX}])/last(//vfs.fs.total[hrStorageSize.{#SNMPINDEX}]))*100'
              description: 'Space utilization in % for Disk-{#SNMPINDEX}'
              tags:
                -
                  tag: Application
                  value: Storage
            -
              uuid: abea1d8e522a48fcb35d3b05b41cd576
              name: 'Disk-{#SNMPINDEX}: Total space'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.5.{#SNMPINDEX}'
              key: 'vfs.fs.total[hrStorageSize.{#SNMPINDEX}]'
              history: 7d
              units: B
              description: |
                MIB: HOST-RESOURCES-MIB
                The size of the storage represented by this entry, in
                units of hrStorageAllocationUnits. This object is
                writable to allow remote configuration of the size of
                the storage area in those cases where such an
                operation makes sense and is possible on the
                underlying system. For example, the amount of main
                memory allocated to a buffer pool might be modified or
                the amount of disk space allocated to virtual memory
                might be modified.
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '1024'
              tags:
                -
                  tag: Application
                  value: Storage
            -
              uuid: ed5fce36f7904eb7bf5929b90fd5b535
              name: 'Disk-{#SNMPINDEX}: Used space'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.25.2.3.1.6.{#SNMPINDEX}'
              key: 'vfs.fs.used[hrStorageSize.{#SNMPINDEX}]'
              history: 7d
              units: B
              description: |
                MIB: HOST-RESOURCES-MIB
                The amount of the storage represented by this entry that is allocated, in units of hrStorageAllocationUnits.
              preprocessing:
                -
                  type: MULTIPLIER
                  parameters:
                    - '1024'
              tags:
                -
                  tag: Application
                  value: Storage
          trigger_prototypes:
            -
              uuid: f303b6ce2be34c8ca0f51e5c73e47715
              expression: |
                last(/MikroTik hEX S SNMP/vfs.fs.pused[hrStorageSize.{#SNMPINDEX}])>{$VFS.FS.PUSED.MAX.CRIT:"Disk-{#SNMPINDEX}"} and
                ((last(/MikroTik hEX S SNMP/vfs.fs.total[hrStorageSize.{#SNMPINDEX}])-last(/MikroTik hEX S SNMP/vfs.fs.used[hrStorageSize.{#SNMPINDEX}]))<5G or timeleft(/MikroTik hEX S SNMP/vfs.fs.pused[hrStorageSize.{#SNMPINDEX}],1h,100)<1d)
              name: 'Disk-{#SNMPINDEX}: Disk space is critically low (used > {$VFS.FS.PUSED.MAX.CRIT:"Disk-{#SNMPINDEX}"}%)'
              opdata: 'Space used: {ITEM.LASTVALUE3} of {ITEM.LASTVALUE2} ({ITEM.LASTVALUE1})'
              priority: AVERAGE
              description: |
                Two conditions should match: First, space utilization should be above {$VFS.FS.PUSED.MAX.CRIT:"Disk-{#SNMPINDEX}"}.
                 Second condition should be one of the following:
                 - The disk free space is less than 5G.
                 - The disk will be full in less than 24 hours.
              manual_close: 'YES'
            -
              uuid: cdef153d2e914c12ba3303c938489359
              expression: |
                last(/MikroTik hEX S SNMP/vfs.fs.pused[hrStorageSize.{#SNMPINDEX}])>{$VFS.FS.PUSED.MAX.WARN:"Disk-{#SNMPINDEX}"} and
                ((last(/MikroTik hEX S SNMP/vfs.fs.total[hrStorageSize.{#SNMPINDEX}])-last(/MikroTik hEX S SNMP/vfs.fs.used[hrStorageSize.{#SNMPINDEX}]))<10G or timeleft(/MikroTik hEX S SNMP/vfs.fs.pused[hrStorageSize.{#SNMPINDEX}],1h,100)<1d)
              name: 'Disk-{#SNMPINDEX}: Disk space is low (used > {$VFS.FS.PUSED.MAX.WARN:"Disk-{#SNMPINDEX}"}%)'
              opdata: 'Space used: {ITEM.LASTVALUE3} of {ITEM.LASTVALUE2} ({ITEM.LASTVALUE1})'
              priority: WARNING
              description: |
                Two conditions should match: First, space utilization should be above {$VFS.FS.PUSED.MAX.WARN:"Disk-{#SNMPINDEX}"}.
                 Second condition should be one of the following:
                 - The disk free space is less than 10G.
                 - The disk will be full in less than 24 hours.
              manual_close: 'YES'
              dependencies:
                -
                  name: 'Disk-{#SNMPINDEX}: Disk space is critically low (used > {$VFS.FS.PUSED.MAX.CRIT:"Disk-{#SNMPINDEX}"}%)'
                  expression: |
                    last(/MikroTik hEX S SNMP/vfs.fs.pused[hrStorageSize.{#SNMPINDEX}])>{$VFS.FS.PUSED.MAX.CRIT:"Disk-{#SNMPINDEX}"} and
                    ((last(/MikroTik hEX S SNMP/vfs.fs.total[hrStorageSize.{#SNMPINDEX}])-last(/MikroTik hEX S SNMP/vfs.fs.used[hrStorageSize.{#SNMPINDEX}]))<5G or timeleft(/MikroTik hEX S SNMP/vfs.fs.pused[hrStorageSize.{#SNMPINDEX}],1h,100)<1d)
          graph_prototypes:
            -
              uuid: b5b0436352614bf1ab0f84731dc4f627
              name: 'Disk-{#SNMPINDEX}: Disk space usage'
              width: '600'
              height: '340'
              type: PIE
              show_3d: 'YES'
              graph_items:
                -
                  color: '969696'
                  calc_fnc: LAST
                  type: GRAPH_SUM
                  item:
                    host: 'MikroTik hEX S SNMP'
                    key: 'vfs.fs.total[hrStorageSize.{#SNMPINDEX}]'
                -
                  sortorder: '1'
                  color: C80000
                  calc_fnc: LAST
                  item:
                    host: 'MikroTik hEX S SNMP'
                    key: 'vfs.fs.used[hrStorageSize.{#SNMPINDEX}]'
      macros:
        -
          macro: '{$CPU.UTIL.CRIT}'
          value: '90'
        -
          macro: '{$IFNAME.LTEMODEM.MATCHES}'
          value: ^lte
          description: 'This macro is used in LTE modem discovery. It can be overridden on the host.'
        -
          macro: '{$IFNAME.WIFI.MATCHES}'
          value: WIFI
          description: 'This macro is used in CAPsMAN AP channel discovery. It can be overridden on the host level.'
        -
          macro: '{$LTEMODEM.RSRP.MIN.WARN}'
          value: '-100'
          description: 'The LTE modem RSRP minimum value for warning trigger expression.'
        -
          macro: '{$LTEMODEM.RSRQ.MIN.WARN}'
          value: '-20'
          description: 'The LTE modem RSRQ minimum value for warning trigger expression.'
        -
          macro: '{$LTEMODEM.RSSI.MIN.WARN}'
          value: '-100'
          description: 'The LTE modem RSSI minimum value for warning trigger expression.'
        -
          macro: '{$LTEMODEM.SINR.MIN.WARN}'
          value: '0'
          description: 'The LTE modem SINR minimum value for warning trigger expression.'
        -
          macro: '{$MEMORY.UTIL.MAX}'
          value: '90'
        -
          macro: '{$TEMP_CRIT}'
          value: '60'
        -
          macro: '{$TEMP_CRIT:"CPU"}'
          value: '75'
        -
          macro: '{$TEMP_CRIT_LOW}'
          value: '5'
        -
          macro: '{$TEMP_WARN}'
          value: '50'
        -
          macro: '{$TEMP_WARN:"CPU"}'
          value: '70'
        -
          macro: '{$VFS.FS.PUSED.MAX.CRIT}'
          value: '90'
        -
          macro: '{$VFS.FS.PUSED.MAX.WARN}'
          value: '80'
  graphs:
    -
      uuid: 1df82d3644a941869ea2fe632982e2aa
      name: 'Memory utilization'
      ymin_type_1: FIXED
      ymax_type_1: FIXED
      graph_items:
        -
          drawtype: GRADIENT_LINE
          color: 1A7C11
          item:
            host: 'MikroTik hEX S SNMP'
            key: 'vm.memory.util[memoryUsedPercentage.Memory]'
